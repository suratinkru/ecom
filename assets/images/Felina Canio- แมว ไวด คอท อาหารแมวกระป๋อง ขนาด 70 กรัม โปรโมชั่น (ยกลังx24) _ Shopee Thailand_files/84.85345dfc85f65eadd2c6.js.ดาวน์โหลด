(self.wpJsonpPcmallRating=self.wpJsonpPcmallRating||[]).push([[84],{3072:(e,t,i)=>{"use strict";i.d(t,{tD:()=>l,mx:()=>r,wl:()=>f,ge:()=>h,wr:()=>m,aJ:()=>c,e5:()=>E,h4:()=>u,te:()=>p,SQ:()=>g,wc:()=>d,N5:()=>_});var a=i(6704),n=i(3804);const s=`{{${Date.now()}}}`;function r(e,t){if(!t)return{comments:"",tmpTagsComments:{}};if(!e||!e.length)return{comments:t,tmpTagsComments:{}};const i=t.indexOf("\n\n"),a=Object.create(null);let n="",r="";if(i<0)n=t;else{const e=t.replace(/\n\n/,s).split(s);n=e[0]||"",r=e[1]||""}return n&&n.split("\n").forEach((t=>{const i=t.replace(":",s).split(s),n=i[0],r=i[1];n&&r&&e.includes(n)&&Object.assign(a,{[n]:r.replace(/\n/g,"")})})),{comments:r,tmpTagsComments:a}}function o(e){return e/16+"rem"}const l=function({isDeleted:e,isHidden:t,comment:i,templateTags:s,hasTemplateTag:l}){if(!i)return null;let c;if(e)c=a.I18n.t("pr_review_deleted");else{if(t)return null;if(l){const{tmpTagsComments:e,comments:t}=r(s,i),a=[];s.forEach(((t,i)=>{const s=e[t];s&&a.push(n.createElement("div",{key:i,style:{marginTop:i?o(6):0}},n.createElement("span",{className:"XgpZlY"},t,": "),s))})),t&&a.push(n.createElement("div",{key:100,style:{marginTop:o(12)}},t)),c=a}else c=i}return n.createElement("div",{className:"Rk6V+3"},c)},c="5ae7a873244d8d6bc7b1fb4a452a5043660c6ea86718c7c2295b0a0862dcdd22",d="240250d341f7bbe8d81c08c6997ccc34765823b371e4962942f42699317415b6",m="b75ec9bfd0d07f044edb0f896d6b6d1804058e4aac11ca49cd9c7c68ad47e286",h="2384644a6b18e635dc58a2ba51c0ffced0f61bfafb5ae8aa841323ec1ddb8929",u="884b6e0ddffd87cf9bee32011bf8f6a69beefe31fc227a145d136bad8f2a25c5",p="0a771b5912c20216eb22922338eef601bb23d3a5b9adf84e82e97010e11eed22",_={my:"Malaysia",sg:"Singapore",tw:"Taiwan",th:"Thailand",br:"Brazil",mx:"Mexico",id:"Indonesia",co:"Colombia",cl:"Chile",vn:"Vietnam",ph:"Philippines"},g="70ea67ac6c484880784e7fed2e6037f98ce4151cb0e00ebc20855fada94ddead",E="afd10421c1cc0f5bd6336078f9ead3bdba5dcd8818e3c95da9f546f33d1b4bed";function f(e){return a.I18n.withI18nCollections([178])(e)}},2883:(e,t,i)=>{"use strict";i.d(t,{Z:()=>k});var a=i(3804),n=i.n(a),s=i(7234),r=i.n(s),o=i(8139),l=i(5266);function c({url:e,needThumb:t,className:i,isVideoCover:a}){return n().createElement("div",{className:r()("shopee-rating-media-list-image__wrapper",i)},n().createElement("div",{className:"shopee-rating-media-list-image__place-holder"},n().createElement(l.Z,null)),n().createElement("div",{className:"shopee-rating-media-list-image__content",style:e&&e.length>0?{backgroundImage:a?`url("${e}")`:`url("${((e="",t=!1)=>/^https?:\/\/.*/.test(e)?t?`${e}_tn`:e:(0,o.Jn)(e,t))(e,t)}")`}:{}},n().createElement("div",{className:"shopee-rating-media-list-image__content--blur"}," ")))}var d=i(7550),m=i(2085);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},h.apply(this,arguments)}function u({direction:e,showArrowOnHover:t,isShown:i,handleClick:n,showArrowHint:s,isVisible:o,padding:l,IconArrow:c,style:u}){const p=t&&s&&!i;return l=l||"0px",a.createElement("div",{className:r()("rating-media-list-carousel-arrow rating-media-list-carousel-arrow--"+(e<0?"prev":"next"),p&&"rating-media-list-carousel-arrow--hint",!o&&"rating-media-list-carousel-arrow--hidden"),role:"button",tabIndex:0,style:h({opacity:!t||i||p?"1":"0",visibility:o?"visible":"hidden",transform:`translateX(calc(${e<0?"-50% + "+l:"50% - "+l}))`},u),onClick:n},c?a.createElement(c,null):e<0?a.createElement(d.Z,null):a.createElement(m.Z,null))}var p=i(4930);function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},_.apply(this,arguments)}class g extends a.Component{constructor(e){super(e),this._carousel=null,this.handlePrevArrowClick=()=>{const e=this.state.position;let t=0;this.props.keepPreviousItemOnSlide&&(t=1);const i=this.props.slidesByOne?Math.max(e-1,0):Math.max(e-Math.ceil(this.props.numItemsPerRow)+t,0);this.slideTo(i)},this.handleNextArrowClick=()=>{const{items:e,numItemsPerRow:t,slidesByOne:i}=this.props,a=e.length-Math.floor(t),n=this.state.position;let s=0;this.props.keepPreviousItemOnSlide&&(s=1);const r=i?Math.min(n+1,a):Math.min(n+Math.ceil(t)-s,a);this.slideTo(r)},this.slideTo=e=>{if(this.state.isSliding&&!this.props.isOverrideSliding)return;this._finishSlidingTimeout&&window.clearTimeout(this._finishSlidingTimeout);const{transitionTime:t}=this.props;this.setState({isSliding:!0});const{_carousel:i}=this;i&&Object.assign(i.style,_({transition:`${t}ms`},this.getCurrentCarouselTransform(e))),"function"==typeof this.props.onSlide&&this.props.onSlide(e),this.props.isOverrideSliding&&this.setState({position:e}),this._finishSlidingTimeout=window.setTimeout((()=>{this.finishSliding(e)}),t)},this.finishSliding=e=>{this.setState({isSliding:!1,position:e}),this._finishSlidingTimeout&&window.clearTimeout(this._finishSlidingTimeout)},this.showArrows=()=>{this.setState({isShowArrows:!0})},this.hideArrows=()=>{this.setState({isShowArrows:!1})},this.state={position:0,isSliding:!1,isShowArrows:!1},this._carouselItems=[]}componentWillUnmount(){this._carousel=null,this._carouselItems=[]}componentDidMount(){const{numItemsPerRow:e,focusIndex:t}=this.props,i=this.props.items?this.props.items.length:0;if("number"==typeof t){const a=Math.floor(t/e)*e,n=Math.min(a,Math.max(i-Math.floor(e),0));this.setState({position:n},(()=>{const{_carousel:e}=this;e&&Object.assign(e.style,this.getCurrentCarouselTransform(n))}))}}renderDisplayedItems(){const{items:e,isFluid:t,padding:i,distributeCardWidthWhenFewerItems:n,numItemsPerRow:s}=this.props,o=e.length,l=n&&o<s?100/o:100/s;return e.map(((e,n)=>a.createElement("li",{key:n,className:r()("rating-media-list-image-carousel__item",t&&"rating-media-list-image-carousel__item--fluid"),style:{padding:`0 ${i}`,width:t?void 0:`${l}%`},ref:e=>{e&&(this._carouselItems[n]=e)}},e)))}render(){const{items:e,numItemsPerRow:t,showArrowOnHover:i,showArrowHint:n,isFluid:s,distributeCardWidthWhenFewerItems:o,itemPadding:l,className:c,IconArrowLeft:d,IconArrowRight:m,arrowStyle:h}=this.props,{isShowArrows:p,position:g}=this.state,E=e.length,f=E>t?(o&&E<t?100/E:100/t)*E:100,y=this._carouselItems&&this._carouselItems[this.state.position]?`${this._carouselItems[this.state.position].getBoundingClientRect().width}px`:void 0;return a.createElement("div",{className:r()("rating-media-list-image-carousel",c),onMouseEnter:this.showArrows,onMouseLeave:this.hideArrows,style:s?{width:y,transition:`${this.props.transitionTime}ms`}:{}},a.createElement("div",{className:"rating-media-list-image-carousel__item-list-wrapper"},a.createElement("ul",{className:"rating-media-list-image-carousel__item-list",style:_({width:s?void 0:`${f}%`},this.getCurrentCarouselTransform(g)),ref:e=>this._carousel=e},this.renderDisplayedItems())),a.createElement(u,{direction:-1,showArrowOnHover:i,isVisible:E>t&&g>0,isShown:p,handleClick:this.handlePrevArrowClick,showArrowHint:n,padding:l,IconArrow:d,style:h}),a.createElement(u,{direction:1,showArrowOnHover:i,isVisible:E>t&&g+t<E,isShown:p,handleClick:this.handleNextArrowClick,showArrowHint:n,padding:l,IconArrow:m,style:h}))}getCurrentCarouselTransform(e){const{_carousel:t,_carouselItems:i}=this;if(!t)return{};let a=0;return this.props.isFluid&&i?(a=i.map(((t,i)=>t&&i<e?t.getBoundingClientRect().width:0)).reduce(((e,t)=>e+t),0),{marginLeft:-a,marginTop:0}):(t.firstElementChild&&(a=t.firstElementChild.getBoundingClientRect().width),{marginLeft:-e*a,marginTop:0})}}function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},E.apply(this,arguments)}g.defaultProps={transitionTime:500,showArrowOnHover:!1,padding:(0,p.Z)(10),keepPreviousItemOnSlide:!0,showArrowHint:!1,isFluid:!1,isOverrideSliding:!1,slidesByOne:!1};const f=function(e){return n().createElement("svg",E({width:"23",height:"18",viewBox:"0 0 23 18",fill:"none"},e),n().createElement("g",{filter:"url(#filter0_d)"},n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 4C4.44772 4 4 4.44772 4 5V13C4 13.5523 4.44772 14 5 14H13C13.5523 14 14 13.5523 14 13V5C14 4.44772 13.5523 4 13 4H5ZM11.5 9C11.5 10.3807 10.3807 11.5 9 11.5C7.61929 11.5 6.5 10.3807 6.5 9C6.5 7.61929 7.61929 6.5 9 6.5C10.3807 6.5 11.5 7.61929 11.5 9ZM9 10.6667C9.92047 10.6667 10.6667 9.92047 10.6667 9C10.6667 8.07952 9.92047 7.33333 9 7.33333C8.07953 7.33333 7.33333 8.07952 7.33333 9C7.33333 9.92047 8.07953 10.6667 9 10.6667ZM18.1667 4.83333L14.8333 7.33306V10.6667L18.1667 13.1667V4.83333Z",fill:"white"})),n().createElement("defs",null,n().createElement("filter",{id:"filter0_d",x:"0",y:"0",width:"22.1667",height:"18",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n().createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),n().createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),n().createElement("feOffset",null),n().createElement("feGaussianBlur",{stdDeviation:"2"}),n().createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.26 0"}),n().createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}),n().createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"}))))};var y=i(2541),C=i(4099);const v=["className","cover"];function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},w.apply(this,arguments)}class R extends a.PureComponent{constructor(...e){super(...e),this.state={pausing:!1,ended:!1},this.player=null,this.handleEnded=()=>{this.setState({ended:!0,pausing:!1})},this.handlePlay=()=>{this.setState({ended:!1,pausing:!1})},this.handlePause=()=>{this.setState({pausing:!0})},this.setVideoDomRef=e=>{e&&(this.player=e,this.player.addEventListener("ended",this.handleEnded,!1),this.player.addEventListener("play",this.handlePlay,!1),this.player.addEventListener("pause",this.handlePause,!1))}}UNSAFE_componentWillReceiveProps(e){this.player&&(!this.props.autoPlay&&e.autoPlay?this.player.play():this.props.autoPlay&&!e.autoPlay&&this.player.pause())}render(){const e=this.props,{className:t,cover:i}=e,n=function(e,t){if(null==e)return{};var i,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,v);return a.createElement("div",{className:"_7vELmB"},a.createElement("video",w({},n,{poster:i,className:r()("FUfYhl",t),ref:this.setVideoDomRef,controlsList:"nodownload"})),this.state.pausing?a.createElement(y.Z,{className:"CPwWRk"}):this.state.ended&&a.createElement(C.Z,{className:"m38bzp"}))}}class k extends a.Component{constructor(e){super(e),this._carousel=null,this.onCarouselSlide=e=>{e>=0&&e<this.props.urlList.length&&this.setState({zoomedIndex:e})},this.state={zoomedIndex:-1,carouselTransitionTime:0,expanded:!1}}handleImageClick(e){const{zoomedIndex:t,expanded:i}=this.state;i&&t===e?this.setState({expanded:!1,zoomedIndex:0,carouselTransitionTime:0}):this.setState({expanded:!0,zoomedIndex:e,carouselTransitionTime:500},(()=>{this._carousel&&this._carousel.slideTo(e)}))}render(){const{urlList:e}=this.props;if(!e||!e.length)return null;const{zoomedIndex:t,expanded:i}=this.state,n=e.map(((e,i)=>"string"==typeof e?a.createElement("img",{key:i,className:"rating-media-list__zoomed-image-item",src:e.includes("://")?e:(0,o.Jn)(e)}):a.createElement(R,{src:e.url,key:i,className:"rating-media-list__zoomed-video-item",controls:!0,muted:!0,autoPlay:t===i})));return a.createElement("div",{className:"rating-media-list"},a.createElement("div",{className:"rating-media-list__container"},e.map(((e,n)=>a.createElement("div",{key:n,className:r()("rating-media-list__image-wrapper",i&&t===n?"rating-media-list__image-wrapper--active":"rating-media-list__image-wrapper--inactive"),onClick:this.handleImageClick.bind(this,n)},"string"==typeof e?a.createElement(c,{url:e,needThumb:!0}):a.createElement(a.Fragment,null,a.createElement(c,{url:e.cover,needThumb:!1,isVideoCover:!0}),a.createElement("div",{className:"rating-media-list__video-cover"},a.createElement(f,null),a.createElement("span",null,((e=0,t="m:ss")=>{const i=Math.ceil(e/1e3),a=Math.floor(i/60),n=i%60,s={mm:`0${a}`.substr(-2),m:a,ss:`0${n}`.substr(-2),s:n};return Object.keys(s).reduce(((e,t)=>e.replace(t,`${s[t]}`)),t)})(e.duration||0)))))))),a.createElement("div",{className:r()("rating-media-list__zoomed-image",i&&"rating-media-list__zoomed-image--active")},a.createElement(g,{items:n,showArrowOnHover:!0,numItemsPerRow:1,showArrowHint:!0,ref:e=>this._carousel=e,onSlide:this.onCarouselSlide,keepPreviousItemOnSlide:!1,transitionTime:this.state.carouselTransitionTime,isFluid:!0,isOverrideSliding:!0})))}}},2971:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var a=i(3804),n=i.n(a),s=i(7234),r=i.n(s),o=i(6704);const{t:l}=o.I18n;function c({response:e,titleText:t,className:i,isHidden:a}){return n().createElement("div",{className:r()("fwJamt",i)},n().createElement("div",{className:"CaoTou"},t||l("label_seller_response")),n().createElement("div",{className:"_2kece8"},a?`***${l("seller_reply_hidden")}***`:e))}},4510:(e,t,i)=>{"use strict";i.d(t,{DU:()=>b,kG:()=>v,TE:()=>f});var a=i(3804),n=i.n(a),s=i(6535),r=i(2482),o=i(7234),l=i.n(o);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},c.apply(this,arguments)}const d=function(e){return a.createElement("svg",c({viewBox:"0 0 30 30"},e),a.createElement("defs",null,a.createElement("linearGradient",{id:"star__solid",x1:"50%",x2:"50%",y1:"0%",y2:"100%"},a.createElement("stop",{offset:"0%",stopColor:"#FFCA11"}),a.createElement("stop",{offset:"100%",stopColor:"#FFAD27"}))),a.createElement("path",{fill:"url(#star__solid)",fillRule:"evenodd",d:"M14.9988798 25.032153l-8.522024 4.7551739c-.4785069.2670004-.7939037.0347448-.7072938-.5012115l1.6339124-10.1109185-6.8944622-7.1327607c-.3871203-.4005006-.2499178-.7947292.2865507-.8774654l9.5090982-1.46652789L14.5740199.51703028c.2346436-.50460972.6146928-.50543408.8497197 0l4.2693588 9.18141263 9.5090986 1.46652789c.545377.0841102.680337.4700675.28655.8774654l-6.894462 7.1327607 1.633912 10.1109185c.08788.5438118-.232337.7662309-.707293.5012115l-8.5220242-4.7551739z"}))};function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},m.apply(this,arguments)}const h=function(e){return a.createElement("svg",m({viewBox:"0 0 30 30"},e),a.createElement("defs",null,a.createElement("linearGradient",{id:"star__hollow",x1:"50%",x2:"50%",y1:"0%",y2:"99.0177926%"},a.createElement("stop",{offset:"0%",stopColor:"#FFD211"}),a.createElement("stop",{offset:"100%",stopColor:"#FFAD27"}))),a.createElement("path",{fill:"none",fillRule:"evenodd",stroke:"url(#star__hollow)",strokeWidth:"2",d:"M23.226809 28.390899l-1.543364-9.5505903 6.600997-6.8291523-9.116272-1.4059447-4.01304-8.63019038-4.013041 8.63019038-9.116271 1.4059447 6.600997 6.8291523-1.543364 9.5505903 8.071679-4.5038874 8.071679 4.5038874z"}))},u="Q3JZ62";function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},p.apply(this,arguments)}const _=({onClick:e,value:t,size:i,classNames:a})=>n().createElement("div",{className:l()(a,"Hdwpes"),style:{width:i,height:i},onClick:e},n().createElement(h,{className:u}),n().createElement(d,{className:u,style:{width:100*t+"%"}}));function g(e){return n().createElement(_,p({},e,{value:1}))}function E(e){return n().createElement(_,p({},e,{value:0}))}function f({rating:e=5,maxRating:t=5,onRatingChange:i,StarUIHollow:a=E,StarUISolid:o=g,size:l}){const c=t=>{t!==e&&i&&i(t)},d=["rating-stars__star"];i&&d.push("rating-stars__star--clickable");const m=[];for(let n=1;n<=t;n++)m.push(e>=n?"icon-rating-solid":"icon-rating");return n().createElement("div",{className:"rating-stars__container"},m.map(((t,i)=>i<=e-1?o?n().createElement(o,{key:i,size:l,classNames:d,onClick:c.bind(null,i+1)}):n().createElement(s.Z,{key:i,classNames:d,onClick:c.bind(null,i+1)}):a?n().createElement(a,{key:i,classNames:d,onClick:c.bind(null,i+1),size:l}):n().createElement(r.Z,{key:i,classNames:d,onClick:c.bind(null,i+1)}))))}_.defaultProps={size:"1.875rem"};var y=i(6704);const{t:C}=y.I18n;function v({title:e,rating:t=5,maxRating:i=5,onRatingChange:a,StarUIHollow:s=E,StarUISolid:r=g,size:o=26,space:l=5}){const c=e=>{e!==t&&a&&a(e)},d=["rating-stars__star"];a&&d.push("rating-stars__star--clickable");const m=[];for(let n=1;n<=i;n++)m.push(t>=n?"icon-rating-solid":"icon-rating");return n().createElement("div",{className:"dmvG7c"},n().createElement("div",{className:"jcQ0KT"},n().createElement("span",null,e)),m.map(((e,i)=>{const a=i<t?r:s;return n().createElement("div",{key:i,style:{paddingLeft:`${l}px`}},n().createElement(a,{size:o,classNames:d,onClick:c.bind(null,i+1)}))})),n().createElement("span",{className:"_6m3yfK",style:{color:t>=4?"#eda500":"rgba(0, 0, 0, 0.54)"}},t>0?C(`star_definition_${t}`):""))}function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},w.apply(this,arguments)}const R=function(e){return a.createElement("svg",w({width:"22",height:"21",viewBox:"0 0 22 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e,{style:{color:"#ffffff",display:"block",stroke:"currentcolor"}}),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 16.9084L6.17879 19.5663C5.44805 19.9691 4.57443 19.3526 4.70912 18.5291L5.6419 12.8262L1.64766 8.74345C1.0779 8.16107 1.4064 7.17827 2.21184 7.05554L7.68852 6.22104L10.0952 1.1074C10.4555 0.341849 11.5445 0.341848 11.9048 1.1074L14.3115 6.22104L19.7882 7.05554C20.5937 7.17827 20.9222 8.16107 20.3524 8.74345L16.3582 12.8262L17.2909 18.5291C17.4256 19.3526 16.552 19.9691 15.8213 19.5663L11 16.9084Z",stroke:"#FFA727"}))};function k(){return k=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},k.apply(this,arguments)}const M=function(e){const t=`${Math.random()}_linear_gradient`;return a.createElement("svg",k({width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 16.9084L5.17879 19.5663C4.44805 19.9691 3.57443 19.3526 3.70912 18.5291L4.6419 12.8262L0.647663 8.74345C0.077903 8.16107 0.406397 7.17827 1.21184 7.05554L6.68852 6.22104L9.09523 1.1074C9.45553 0.341849 10.5445 0.341848 10.9048 1.1074L13.3115 6.22104L18.7882 7.05554C19.5937 7.17827 19.9222 8.16107 19.3524 8.74345L15.3582 12.8262L16.2909 18.5291C16.4256 19.3526 15.552 19.9691 14.8213 19.5663L10 16.9084Z",fill:`url(#${t})`}),a.createElement("defs",null,a.createElement("linearGradient",{id:t,x1:"0",y1:"0",x2:"0",y2:"20",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#FFCA11"}),a.createElement("stop",{offset:"1",stopColor:"#FFAD27"}))))};function b({rating:e,className:t,useNew:i}){return n().createElement("div",{className:l()("shopee-rating-stars",t)},n().createElement("div",{className:"shopee-rating-stars__stars"},[1,2,3,4,5].map((t=>{const a=Math.max(0,Math.min(100*(e-t+1),100));return n().createElement("div",{className:"shopee-rating-stars__star-wrapper",key:t},n().createElement("div",{className:"shopee-rating-stars__lit",style:{width:`${a}%`}},i?n().createElement(M,null):n().createElement(s.Z,{classNames:["shopee-rating-stars__primary-star"]})),i?n().createElement(R,null):n().createElement(r.Z,{classNames:["shopee-rating-stars__hollow-star"]}))}))))}},7250:()=>{},6911:(e,t,i)=>{"use strict";i.d(t,{Z:()=>fe});var a=i(3804),n=i.n(a),s=i(2150),r=i.n(s),o=i(4857),l=i(5325),c=i(6775),d=i(7234),m=i.n(d),h=i(9168),u=i(3955),p=i(5958),_=i(3007),g=i(9543),E=i(7897),f=i(3072),y=i(331),C=i(312),v=i(2971),w=i(4474),R=i(45),k=i(6704),M=i(2385);const{t:b}=k.I18n,S=({productItem:e})=>n().createElement(c.Link,{to:R.Z.getUrl({seoName:e.name,shopId:e.shopid,itemId:e.itemid})},n().createElement("div",{className:"oFG+oZ"},n().createElement("img",{alt:"product-image",src:(0,M.Jn)(e.image,!0)}),n().createElement("div",{className:"hLxEXM"},n().createElement("span",{className:"XbiK0O"},e.name),e.model_name&&n().createElement("span",{className:"uhRlT5"},b("label_variation"),": ",e.model_name)))),{t:I}=k.I18n;function O({isProductRatingPage:e=!1}){const t=I(e?"low_rating_reminder_product":"low_rating_reminder_shop");return n().createElement(n().Fragment,null,n().createElement("span",{className:"rating-tips-icon"},n().createElement("div",{className:"shopee-product-rating__tips"},n().createElement("span",{className:"shopee-product-rating__tipsText"},t))))}var L=i(890);function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},T.apply(this,arguments)}const N=e=>n().createElement("svg",T({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n().createElement("g",{filter:"url(#filter0_i)"},n().createElement("rect",{width:"18",height:"18",rx:"9",fill:"white"})),n().createElement("rect",{x:"0.5",y:"0.5",width:"17",height:"17",rx:"8.5",stroke:"black",strokeOpacity:"0.14"}),n().createElement("defs",null,n().createElement("filter",{id:"filter0_i",x:"0",y:"0",width:"18",height:"19",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n().createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),n().createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),n().createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),n().createElement("feOffset",{dy:"2"}),n().createElement("feGaussianBlur",{stdDeviation:"0.5"}),n().createElement("feComposite",{in2:"hardAlpha",operator:"arithmetic",k2:"-1",k3:"1"}),n().createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.09 0"}),n().createElement("feBlend",{mode:"normal",in2:"shape",result:"effect1_innerShadow"})))),x=e=>n().createElement("svg",T({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n().createElement("g",{filter:"url(#filter0_i)"},n().createElement("rect",{width:"18",height:"18",rx:"9",fill:"white"})),n().createElement("rect",{x:"0.5",y:"0.5",width:"17",height:"17",rx:"8.5",stroke:"black",strokeOpacity:"0.14"}),n().createElement("rect",{width:"18",height:"18",rx:"9",fill:"#FF5722"}),n().createElement("g",{filter:"url(#filter1_d)"},n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 13C11.2091 13 13 11.2091 13 9C13 6.79086 11.2091 5 9 5C6.79086 5 5 6.79086 5 9C5 11.2091 6.79086 13 9 13Z",fill:"white"})),n().createElement("defs",null,n().createElement("filter",{id:"filter0_i",x:"0",y:"0",width:"18",height:"19",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n().createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),n().createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"BackgroundImageFix",result:"shape"}),n().createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0",result:"hardAlpha"}),n().createElement("feOffset",{dy:"2"}),n().createElement("feGaussianBlur",{stdDeviation:"0.5"}),n().createElement("feComposite",{in2:"hardAlpha",operator:"arithmetic",k2:"-1",k3:"1"}),n().createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.09 0"}),n().createElement("feBlend",{mode:"normal",in2:"shape",result:"effect1_innerShadow"})),n().createElement("filter",{id:"filter1_d",x:"3",y:"5",width:"12",height:"12",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n().createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),n().createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),n().createElement("feOffset",{dy:"2"}),n().createElement("feGaussianBlur",{stdDeviation:"1"}),n().createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.02 0"}),n().createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}),n().createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"})))),A=e=>n().createElement("svg",T({width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 15C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1C4.13401 1 1 4.13401 1 8C1 11.866 4.13401 15 8 15Z",stroke:"#FF424F"}),n().createElement("rect",{x:"6.06055",y:"5",width:"7",height:"1.5",rx:"0.75",transform:"rotate(45 6.06055 5)",fill:"#FF424F"}),n().createElement("rect",{width:"7",height:"1.5",rx:"0.75",transform:"matrix(-0.707107 0.707107 0.707107 0.707107 9.94971 5)",fill:"#FF424F"})),D=e=>n().createElement("svg",T({width:"12",height:"12",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.9938 11.4383L11.996 11.438L10.996 3.438L10.9938 3.43825C10.9634 3.18844 10.7516 3.00044 10.5 3H8.7685L8.74475 2.64275H8.7445C8.6875 1.17625 7.48025 0 6 0C4.51975 0 3.3125 1.17625 3.2555 2.64275H3.255L3.23125 3H1.5C1.245 3 1.037 3.1915 1.00625 3.43825L1.004 3.438L0.004 11.438L0.00625 11.4383L0.00420502 11.4537C0.00210023 11.4689 0 11.4841 0 11.5C0 11.7761 0.223858 12 0.5 12H11.5C11.7761 12 12 11.7761 12 11.5C12 11.4841 11.9979 11.4689 11.9958 11.4537L11.9958 11.4537L11.9938 11.4383ZM4.25274 2.71122H4.25199C4.27424 1.76547 5.04899 1.00247 5.99999 1.00247C6.95099 1.00247 7.72574 1.76547 7.74799 2.71122H7.74724L7.76649 3.00247H4.23349L4.25274 2.71122ZM3.00324 6.46947L3.00099 6.46922L3.16474 4.00247H1.94124L1.06624 11.0025H10.9335L10.0585 4.00247H8.83499L8.99899 6.46922L8.99674 6.46947C8.99705 6.47398 8.99765 6.47845 8.99825 6.48293C8.99912 6.48937 8.99999 6.49584 8.99999 6.50247C8.99715 6.7697 8.78438 6.9873 8.51728 6.99614C8.25019 7.00498 8.02349 6.80193 8.00299 6.53547L8.00099 6.53572L7.83274 4.00247H4.16699L3.99899 6.53572L3.99674 6.53547C3.99441 6.71605 3.89466 6.88126 3.73594 6.9674C3.57722 7.05355 3.38433 7.04716 3.23165 6.95071C3.07898 6.85426 2.99037 6.68281 2.99999 6.50247C2.99999 6.49584 3.00086 6.48937 3.00173 6.48293C3.00233 6.47845 3.00293 6.47398 3.00324 6.46947Z",fill:"#E79911"}));var q=i(443),B=i(8500);const W="ID"===k.Env.getLocale(),U=["rating_report_reason_rude","rating_report_reason_pornographic","rating_report_reason_spam","rating_report_reason_exposing","rating_report_reason_advertisement","rating_report_reason_misleading","rating_report_reason_other"],F="RPcYO0",$="_7CsrBy";function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},j.apply(this,arguments)}const{t:P}=k.I18n,V=27000006;let H=[];const G=function(e){const t=n().useRef(null),[i,s]=n().useState(-1),[r,o]=n().useState(""),[l,c]=n().useState(""),[d,m]=n().useState({code:0,message:"",submitting:void 0}),h=(0,q.Z)(e.trackingType,e),u=(0,B.Z)(e.trackingType,{});n().useEffect((()=>(h(t.current),()=>{H.forEach((e=>window.clearTimeout(e))),H=[]})),[]);const p=n().useMemo((()=>void 0!==d.submitting?!!d.submitting:-1===i||!!(i===U.length-1&&!r||W&&i===U.length-2&&!l)),[i,r,d.submitting,l]),_=n().useCallback((e=>{s(e)}),[]),g=n().useCallback((e=>{o(e)}),[]),E=n().useCallback((e=>{c(e)}),[]),f=n().useCallback((()=>{const e=window.setTimeout((()=>{m({code:0,message:"",submitting:void 0})}),3e3);H.push(e)}),[]),y=n().useCallback((async()=>{if(p)return;if(u({targetData:j({},e)}),!window.navigator.onLine)return m({message:P("rating_submit_network_abnormal"),code:2,submitting:!0}),void f();m({code:0,message:"",submitting:!0});const{cmtId:t,shopId:a,itemId:n}=e,s=P(U[i]),{error:o,error_response:c={}}=await e.reportRating(t,a,n,function(e,t,i){return e===U.length-1||e===U.length-2&&W&&t?`${i}:${t}`:i}(i,i===U.length-1?r:l,s));if(o)return c.be_error===V?m({submitting:!0,message:P("rating_report_frequently_toast"),code:V}):27000007===c.be_error?m({submitting:!0,message:P("rating_report_restriction_toast"),code:V}):m({submitting:!0,message:P("rating_submit_network_abnormal"),code:1}),void f();e.closePopupForm(!0)}),[p,i,r,l]);return n().createElement(L.Z,{title:P("rating_report_page_title"),showCancelButton:!0,showSubmitButton:!0,showOKButton:!1,textSubmit:P("rating_report_page_submit"),cancelButtonText:P("rating_report_page_cancel"),disableSubmit:p,formExtraClassNames:"QHH7NX",onSubmit:y,onCancel:()=>e.closePopupForm(!1)},n().createElement("div",{className:"Lh0O7a",ref:t},n().createElement("div",{className:"sjkGEj"},P("rating_report_page_text")),0!==d.code&&n().createElement("div",{className:"Ji6Rzz"},n().createElement(A,{className:"hQ+DFe"}),d.message),n().createElement("ul",{className:"NZ-eWK"},U.map(((e,t)=>n().createElement(a.Fragment,{key:t},n().createElement("li",{onClick:()=>_(t),className:"lkbU3B"},i===t?n().createElement(x,{className:F}):n().createElement(N,{className:F}),n().createElement("div",{style:{flex:1}},P(e))),W&&t===U.length-2&&i===U.length-2?n().createElement("div",{className:$},n().createElement("input",{type:"text",placeholder:P("rating_report_reason_other_prompt"),onChange:e=>E(e.target.value),value:l,maxLength:300})):null,t===U.length-1&&i===U.length-1?n().createElement("div",{className:$},n().createElement("input",{type:"text",placeholder:P("rating_report_reason_other_prompt"),onChange:e=>g(e.target.value),value:r,maxLength:300})):null))))))};var Z=i(2094),X=i(2883),Q=i(2535),z=i(6607),Y=i(2181);const{t:K}=k.I18n,J=({isAnonymous:e,authorPic:t,shopId:i})=>{const n=a.createElement(Z.Z,{imgSrc:(0,M.Jn)(t,!0)});if(e)return a.createElement("div",{className:"shopee-product-rating__avatar"},n);{const e=Y.Ri.getUrl({shopId:i});return a.createElement(c.Link,{to:e,className:"shopee-product-rating__avatar"},n)}},ee=({isAnonymous:e,authorName:t,shopId:i})=>{const n=null==t?K("text_shopee_user"):t;if(e)return a.createElement("div",{className:"shopee-product-rating__author-name"},n);{const e=Y.Ri.getUrl({shopId:i});return a.createElement(c.Link,{className:"shopee-product-rating__author-name",to:e},n)}},te=({star:e})=>a.createElement("div",{className:"shopee-product-rating__rating"},[1,2,3,4,5].map(((t,i)=>i<e?a.createElement(Q.Z,{key:i,classNames:["icon-rating-solid--active"]}):a.createElement(z.Z,{key:i})))),ie=({content:e,isHidden:t})=>t?null:a.createElement("div",{className:"shopee-product-rating__content"},e),ae=({images:e})=>a.createElement("div",{className:"shopee-product-rating__image-list-wrapper"},a.createElement(X.Z,{urlList:e})),ne=({modelName:e,commentTime:t,region:i,isUserRating:n})=>{const s=i?` ${i} | `:"";return a.createElement("div",{className:"shopee-product-rating__time"},s?a.createElement("svg",{width:"8",height:"10",viewBox:"0 0 8 10",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M4.36872 8.81893C4.28492 8.93416 4.15084 9 4 9C3.84916 9 3.71508 8.93416 3.63128 8.81893C2.82682 7.76543 1 5.23045 1 3.9465C1 2.31687 2.34078 1 4 1C5.65922 1 7 2.31687 7 3.9465C7 5.21399 5.17318 7.76543 4.36872 8.81893Z",stroke:"black",strokeOpacity:"0.54",strokeWidth:"0.8"}),a.createElement("path",{d:"M5 4C5 3.44186 4.55814 3 4 3C3.44186 3 3 3.44186 3 4C3 4.55814 3.44186 5 4 5C4.55814 5 5 4.55814 5 4Z",fill:"black",fillOpacity:"0.26"})):null,e&&!n?`${s}${t} | ${K("label_variation")}: ${e}`:`${s}${t}`)},se=()=>a.createElement("svg",{width:"14px",height:"13px",viewBox:"0 0 14 13",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},a.createElement("defs",null),a.createElement("g",{stroke:"none",strokeWidth:"1",fillRule:"evenodd"},a.createElement("g",{id:"Product-Ratings-Working",transform:"translate(-245.000000, -855.000000)",fillRule:"nonzero"},a.createElement("g",{transform:"translate(155.000000, 92.000000)"},a.createElement("g",{transform:"translate(40.000000, 184.000000)"},a.createElement("g",{transform:"translate(0.000000, 326.000000)"},a.createElement("g",{transform:"translate(50.000000, 253.000000)"},a.createElement("g",null,a.createElement("path",{d:"M0,12.7272727 L2.54545455,12.7272727 L2.54545455,5.09090909 L0,5.09090909 L0,12.7272727 Z M14,5.72727273 C14,5.02727273 13.4272727,4.45454545 12.7272727,4.45454545 L8.71818182,4.45454545 L9.35454545,1.52727273 L9.35454545,1.33636364 C9.35454545,1.08181818 9.22727273,0.827272727 9.1,0.636363636 L8.4,0 L4.2,4.2 C3.94545455,4.39090909 3.81818182,4.70909091 3.81818182,5.09090909 L3.81818182,11.4545455 C3.81818182,12.1545455 4.39090909,12.7272727 5.09090909,12.7272727 L10.8181818,12.7272727 C11.3272727,12.7272727 11.7727273,12.4090909 11.9636364,11.9636364 L13.8727273,7.44545455 C13.9363636,7.31818182 13.9363636,7.12727273 13.9363636,7 L13.9363636,5.72727273 L14,5.72727273 C14,5.79090909 14,5.72727273 14,5.72727273 Z"}))))))))),re=()=>a.createElement("svg",{width:"4px",height:"16px",viewBox:"0 0 4 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},a.createElement("defs",null),a.createElement("g",{stroke:"none",strokeWidth:"1",fillRule:"evenodd"},a.createElement("g",{transform:"translate(-1301.000000, -550.000000)",fill:"#CCCCCC"},a.createElement("g",{transform:"translate(155.000000, 92.000000)"},a.createElement("g",{transform:"translate(40.000000, 184.000000)"},a.createElement("g",{transform:"translate(0.000000, 161.000000)"},a.createElement("g",null,a.createElement("g",{transform:"translate(50.000000, 2.000000)"},a.createElement("path",{d:"M1058,122.2 C1056.895,122.2 1056,123.096 1056,124.2 C1056,125.306 1056.895,126.202 1058,126.202 C1059.104,126.202 1060,125.306 1060,124.2 C1060,123.096 1059.104,122.2 1058,122.2 M1058,116.6 C1056.895,116.6 1056,117.496 1056,118.6 C1056,119.706 1056.895,120.602 1058,120.602 C1059.104,120.602 1060,119.706 1060,118.6 C1060,117.496 1059.104,116.6 1058,116.6 M1058,111 C1056.895,111 1056,111.896 1056,113 C1056,114.106 1056.895,115.002 1058,115.002 C1059.104,115.002 1060,114.106 1060,113 C1060,111.896 1059.104,111 1058,111"}))))))))),oe=()=>a.createElement("svg",{width:"16",height:"11",viewBox:"0 0 16 11",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.24241 8.8C6.4909 8.8 5.04847 7.26 5.04847 5.39C5.04847 3.52 6.4909 1.98 8.24241 1.98C9.99393 1.98 11.4364 3.52 11.4364 5.39C11.4364 7.26 9.99393 8.8 8.24241 8.8ZM8.24241 3.08C7.00605 3.08 6.07878 4.18 6.07878 5.39C6.07878 6.6 7.00605 7.7 8.24241 7.7C9.47878 7.7 10.406 6.6 10.406 5.39C10.406 4.18 9.47878 3.08 8.24241 3.08ZM8.24241 10.78C5.1515 10.78 2.26665 8.91 0.61817 5.72L0.412109 5.39L0.51514 5.06C2.26665 1.87 5.1515 0 8.24241 0C11.3333 0 14.2182 1.87 15.8667 5.06L15.9697 5.39L15.8667 5.72C14.2182 8.8 11.3333 10.78 8.24241 10.78Z",fill:"black",fillOpacity:"0.26"})),le=()=>a.createElement("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},a.createElement("path",{d:"M12.6538 13.3316V10.3335H13.6353V13.4992C13.6353 14.1384 13.1171 14.6668 12.4779 14.6668H2.49076C1.85155 14.6668 1.33337 14.1384 1.33337 13.4992V2.50112C1.33337 1.86193 1.85157 1.3335 2.49076 1.3335H9.27574V2.33541H2.64814C2.46404 2.33541 2.31481 2.48465 2.31481 2.66875V13.3316C2.31481 13.5157 2.46404 13.6649 2.64814 13.6649H12.3205C12.5046 13.6649 12.6538 13.5157 12.6538 13.3316Z",fill:"#EE4D2D"}),a.createElement("path",{d:"M13.7042 2.47157C13.4438 2.21122 13.0217 2.21122 12.7614 2.47157L5.30439 9.92856C5.24787 9.98508 5.20197 10.0513 5.16889 10.1241L4.40823 11.7976C4.28077 12.0779 4.56922 12.3664 4.84961 12.2389L6.52307 11.4783C6.59585 11.4452 6.66208 11.3993 6.71861 11.3428L14.1756 3.88578C14.4359 3.62543 14.4359 3.20332 14.1756 2.94297L13.7042 2.47157Z",fill:"#EE4D2D"}));var ce=i(9908),de=i(6867),me=i(7663),he=i(2108),ue=i(2214),pe=i(951);const{t:_e}=k.I18n,{localizeCompactNumber:ge}=(0,h.getUtilsByCountry)((0,u.Kd)(),(0,u.of)());class Ee extends a.Component{constructor(e){super(e),this._nodeReportMenuButton=null,this.handleLikeRating=()=>{if(this.props.accountInfoProgress!==ue.Z.INIT&&this.props.accountInfoProgress!==ue.Z.REQ)if(this.props.accountStatus!==E.d.LOGGED_IN)this.props.history.push((0,me.FK)(de.D_.getUrl(),{next:location.href}));else{const{rating:e,shopId:t,itemId:i,accountInfo:a}=this.props;e&&t&&i&&(e.liked?this.props.unlikeRating(e.cmtid,e.shopid,e.itemid,e.like_count||0,a.userId):this.props.likeRating(e.cmtid,e.shopid,e.itemid,e.like_count||0,a.userId))}},this.handleEdit=()=>{(0,pe.S7)({commentId:this.props.rating.cmtid,orderId:this.props.rating.orderid,userId:this.props.accountInfo.userId,shopId:this.props.shopId,isSeller:!1,showPopup:this.context.showPopup,dismissPopup:this.context.dismissPopup,fromSource:"myRating",callback:e=>{this.props.updateMyReview(this.props.rating.cmtid,e,this.props.accountInfo.userId)}})},this.closePopupForm=e=>{this.context.dismissPopup(),e&&this.onReported()},this.onReported=()=>{this.toastAbuseReportSuccess(!0)},this.showReportForm=()=>{const{rating:e,showProducts:t}=this.props;this.context.showPopup(a.createElement(G,{closePopupForm:this.closePopupForm,reportRating:this.props.reportRating,cmtId:e.cmtid,shopId:e.shopid,itemId:e.itemid,trackingType:t?"ShopRating.ReportModal":"ProductRating.ReportModal"}))},this.handleReportRating=()=>{if(this.props.accountInfoProgress!==ue.Z.INIT&&this.props.accountInfoProgress!==ue.Z.REQ)if(this.props.accountStatus!==E.d.LOGGED_IN)this.props.history.push((0,me.FK)(de.D_.getUrl(),{next:location.href}));else{const{rating:e,shopId:t,itemId:i}=this.props;if(e&&t&&i){if(this.setState({reportAbuseToggle:!1}),e.is_hidden)return void this.toastAbuseReportSuccess(!0);this.showReportForm()}}},this.toastAbuseReportSuccess=e=>{this.setState({reportAbuseToast:e})},this.clickOutsideToCloseReportMenu=e=>{this._nodeReportMenuButton&&!this._nodeReportMenuButton.contains(e.target)&&this.setState({reportAbuseToggle:!1})},this.openReportAbuseMenu=()=>{this.setState({reportAbuseToggle:!0})},this.state={reportAbuseToggle:!1,reportAbuseToast:!1}}componentDidMount(){window.document.addEventListener("click",this.clickOutsideToCloseReportMenu)}componentWillUnmount(){window.document.removeEventListener("click",this.clickOutsideToCloseReportMenu)}render(){const{rating:e,noAction:t,productItems:i,itemId:n,isUserRating:s,defaultRatingReviewTemplate:r,accountInfo:o,isMyRating:l}=this.props,{ItemRatingReply:c,UserRatingReply:d,author_portrait:h,author_username:u,anonymous:p,rating_star:_,comment:g,images:E,videos:R,ctime:k,liked:M,like_count:b,is_hidden:I,author_shopid:L,sip_info:T,is_repeated_purchase:N,editable:x}=e,q=T&&T.origin_region&&T.is_oversea?f.N5[T.origin_region.toLowerCase()]||T.origin_region:null,B=s?d:c,W=!!B&&B.comment,U=[...R||[],...E||[]],F=i&&i.find((e=>e.itemid===n)),$=!!o&&!!e&&!!e.author_username&&o.userId===e.userid;return a.createElement("div",{className:"shopee-product-rating"},a.createElement(J,{isAnonymous:p,authorPic:h,shopId:L}),a.createElement("div",{className:"shopee-product-rating__main"},a.createElement(ee,{isAnonymous:p,authorName:u,shopId:L}),a.createElement("div",{className:"repeat-purchase-con"},a.createElement(te,{star:_}),N?a.createElement("div",{className:"repeat-purchase-area"},a.createElement("div",{className:"delimiter"},"|"),a.createElement(D,null),a.createElement("div",{className:"writing"},_e("label_repeat_purchase"))):null),a.createElement(ne,{modelName:null==F?void 0:F.model_name,region:q,commentTime:(0,ce.mr)(k,"yyyy-MM-dd hh:mm"),isUserRating:this.props.isUserRating}),r?a.createElement(f.tD,{isHidden:I,comment:g,templateTags:e.template_tags||[],hasTemplateTag:!!e.has_template_tag}):a.createElement(ie,{isHidden:I,content:g}),U.length&&!I?a.createElement(ae,{images:U}):null,this.props.showProducts&&this.props.productItems&&this.props.productItems.map((e=>a.createElement(S,{key:e.modelid,productItem:e}))),this.props.defaultRatingLowLogistic&&e.exclude_scoring_due_low_logistic&&a.createElement(O,{isProductRatingPage:!this.props.showProducts}),W&&a.createElement(v.Z,{isHidden:B.is_hidden,response:B.comment,titleText:_e(s?"label_buyer_response":"label_seller_response")}),T&&T.is_oversea&&a.createElement("div",{className:"shopee-product-rating__time"},_e("label_auto_translated")),!t&&a.createElement("div",{className:"shopee-product-rating__actions",style:{justifyContent:"space-between"}},a.createElement("div",{style:{display:"flex"}},l&&e.show_view&&a.createElement(a.Fragment,null,a.createElement("div",{className:"shopee-product-rating__view-button"},a.createElement(oe,null)),a.createElement("div",{className:"shopee-product-rating__view-count"},e.viewed?ge(e.viewed):0)),a.createElement("div",{className:m()("shopee-product-rating__like-button",M&&"shopee-product-rating__like-button--liked"),onClick:this.handleLikeRating},a.createElement(se,null)),a.createElement("div",{className:"shopee-product-rating__like-count"},b?ge(b):_e("label_helpful_questionmark"))),a.createElement("div",{style:{display:"flex"}},l&&1===x&&a.createElement("div",{onClick:this.handleEdit,className:"shopee-product-rating__action-button-con"},a.createElement(le,null),a.createElement("div",{className:"shopee-product-rating__action-button-con--text"},_e("pr_order_purchase_label_edit"))),$?null:a.createElement("div",{className:"shopee-product-rating__report-menu-button",ref:e=>{this._nodeReportMenuButton=e}},a.createElement(y.Z,{body:a.createElement("div",{className:"shopee-product-rating__report-menu-dropdown",onClick:this.handleReportRating},_e("label_report_abuse")),header:a.createElement("div",{onClick:this.openReportAbuseMenu},a.createElement(re,null)),open:this.state.reportAbuseToggle}),this.state.reportAbuseToast&&a.createElement(C.ZP,{showToast:!0,onToastDismiss:()=>{this.toastAbuseReportSuccess(!1)}},a.createElement("div",{className:m()("shopee-product-rating__report-success-toast",I&&"shopee-product-rating__report-error-toast")},a.createElement("div",{className:m()(!I&&"shopee-product-rating__report-success-icon",I&&"shopee-product-rating__report-error-icon")},I?a.createElement(A,null):a.createElement(w.Z,null)),_e(I?"hidden_rating_report_toast":"rating_report_successful_toast"))))))))}}Ee.contextTypes={dismissPopup:r().func,showPopup:r().func};const fe=(0,o.compose)(c.withRouter,(0,g.u)({fetchOnMount:!0}),(0,l.connect)((e=>({defaultRatingLowLogistic:(0,_.Au)(e.featureToggles,he.__7,!1),defaultRatingReviewTemplate:(0,_.Au)(e.featureToggles,f.aJ,!1)})),((e,t)=>({likeRating:t.likeRating||((...t)=>e((0,p.nt)(...t))),unlikeRating:t.unlikeRating||((...t)=>e((0,p.kB)(...t))),reportRating:(t,i,a,n)=>e((0,p.IY)(t,i,a,n)),updateMyReview:(t,i,a)=>e((0,p._X)(t,i,a))}))))(Ee)},951:(e,t,i)=>{"use strict";i.d(t,{S7:()=>aa,mW:()=>ia});var a=i(3804),n=i.n(a),s=i(2150),r=i.n(s),o=i(5325),l=i(4857),c=i(182),d=i(6556),m=i(7762),h=i(6704),u=i(5958),p=i(2108),_=i(6955);function g(e,t,i=!1){const a=(0,c.Z)(e,["toggles"],{});return void 0===a[t]?i:a[t]}var E=i(103),f=i(1630),y=i(8461),C=i(9230),v=i(6158);const{t:w}=h.I18n;function R({onSubmit:e,onCancel:t,title:i,message:a,showCancel:s=!0,cancelText:r,submitText:o}){return n().createElement("div",{className:"BaIeN9"},n().createElement("div",{className:"aMAwlX"},n().createElement("div",{className:"vBuus2"},i||null),n().createElement("div",{className:"UetFbs"},a),n().createElement("div",{className:"N3bkxH"},n().createElement("div",{style:{display:s?"block":"none"}},n().createElement(v.Lw,{onClick:t,label:r||w("pr_order_purchase_label_cancel"),targetType:"CancelButton"})),n().createElement(C.nQ,{onClick:e,targetType:"SubmitButton"},o||w("pr_order_purchase_label_submit")))))}var k=i(257);const{t:M}=h.I18n;function b({onSubmit:e,onCancel:t}){return n().createElement("div",{className:"jW4jOJ"},n().createElement("div",{className:"bxWXu+"},n().createElement("div",{className:"v4qqSy"},M("pr_alert_submit_rating")),n().createElement("div",{className:"zLzy6L"},M("pr_alert_submit_rating_description")),n().createElement("div",{className:"FTcnQU"},n().createElement(v.Lw,{onClick:t,label:M("pr_order_purchase_label_cancel"),targetType:"CancelButton"}),n().createElement(C.nQ,{onClick:e,targetType:"SubmitButton"},M("pr_order_purchase_label_submit")))))}const{t:S}=h.I18n;function I({goRating:e,warningState:t}){return n().createElement("div",{className:"VYgq+l"},n().createElement("div",{className:"XU4TUf"},n().createElement("div",{className:"rNISq8"},S("label_please_enter_rating","seller_service"===t?{label:S("low_rating_detail_seller_service")}:"delivery_service"===t?{label:S("low_rating_detail_logistic_service")}:{label:`${S("low_rating_detail_seller_service")} & ${S("low_rating_detail_logistic_service")}`})),n().createElement("div",{className:"rjYgch"},n().createElement(C.nQ,{onClick:e,targetType:"SubmitButton"},S("label_go_rating")))))}var O=i(5580),L=i(4510),T=i(2971),N=i(2883),x=i(3072),A=i(7234),D=i.n(A),q=i(1542),B=i(9323);const{t:W}=h.I18n;function U({item:e,className:t}){if(!e)return null;const i=e.model_name||e.model_names&&e.model_names.join(" , ");return n().createElement("a",{className:D()("eLHmOc",t),href:(a=e.shopid,s=e.itemid,r=e.name,r?B.Z.getUrl({seoName:r,shopId:a,itemId:s}):B.O.getUrl({shopId:a,itemId:s})),target:"_blank",rel:"noopener noreferrer"},n().createElement(q.Ee,{url:e.image,needThumb:!0,className:"mPj0Fq"}),n().createElement("div",{className:"_28f7b5"},n().createElement("div",{className:"Mhz5Q+"},e.name),i&&n().createElement("div",{className:"n8hMuk"},`${W("pr_order_purchase_label_variation")}: ${i}`)));var a,s,r}function F({tags:e}){return a.createElement("div",{className:"ZefziV"},e.map((e=>a.createElement("span",{key:e.tag_id,className:"HmeaP+"},e.tag_description))))}var $=i(331);function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},j.apply(this,arguments)}const P=function(e){return n().createElement("svg",j({width:"16",height:"16",viewBox:"0 0 16 16",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 15C11.866 15 15 11.866 15 8C15 4.13401 11.866 1 8 1C4.13401 1 1 4.13401 1 8C1 11.866 4.13401 15 8 15Z",stroke:"#66CC00"}),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.6208 6.40579L7.64139 10.4646C7.37512 10.7308 6.92183 10.7093 6.62894 10.4164C6.33605 10.1235 6.31446 9.67018 6.58073 9.40391L10.5601 5.34513C10.8264 5.07887 11.2797 5.10045 11.5725 5.39335C11.8654 5.68624 11.887 6.13953 11.6208 6.40579Z",fill:"#66CC00"}),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.80292 7.99725L6.61371 10.5292C6.87998 10.7955 7.33327 10.7739 7.62616 10.481C7.91905 10.1881 7.94064 9.73484 7.67437 9.46858L4.86358 6.93659C4.59731 6.67033 4.14402 6.69191 3.85113 6.98481C3.55824 7.2777 3.53665 7.73099 3.80292 7.99725Z",fill:"#66CC00"}))},V="Dv8K2B",{t:H}=h.I18n,{jsonPost:G}=h.FetchUtils;class Z extends a.Component{constructor(e){var t;super(e),t=this,this._nodeReportMenuButton=null,this.canClick=!0,this.clickOutsideToCloseReportMenu=e=>{this._nodeReportMenuButton&&!this._nodeReportMenuButton.contains(e.target)&&this.setState({toggle:!1})},this.handleSetAnonymous=async function(){if(t.setState({toggle:!1}),!t.canClick)return;t.canClick=!1;const e=await G("/api/v2/item/set_rating_anonymous",{cmtid:t.props.cmtid,shopid:t.props.shopid,anonymous:!t.props.anonymous});if(t.canClick=!0,e.error){const e=H("oops_content").replace(/\\n/g,"\n");window.alert(e)}else t.props.updateRatingAfterSetAnonymous(),t.setState({shownTips:!0}),t.timer=window.setTimeout((()=>{t.setState({shownTips:!1})}),2e3)},this.openAnonymousMenu=()=>{this.setState({toggle:!0})},this.state={toggle:!1,shownTips:!1}}componentDidMount(){window.document.addEventListener("click",this.clickOutsideToCloseReportMenu)}componentWillUnmount(){window.clearTimeout(this.timer),window.document.removeEventListener("click",this.clickOutsideToCloseReportMenu)}render(){const{anonymous:e}=this.props;return a.createElement(a.Fragment,null,a.createElement("div",{className:"pWcVQe",ref:e=>{this._nodeReportMenuButton=e}},a.createElement($.Z,{body:a.createElement("div",{className:"BZOzc2",onClick:this.handleSetAnonymous},H("old_rating_anonymous_toggle_"+(e?"off":"on"))),header:a.createElement("div",{className:"GTc4xs",onClick:this.openAnonymousMenu},a.createElement(X,null)),open:this.state.toggle})),this.state.shownTips&&a.createElement("div",{className:"hWPz5H"},a.createElement(P,null),a.createElement("span",{className:"+7cwTV"},H(`old_rating_anonymous_toggle_${e?"on":"off"}_toast`))))}}const X=()=>a.createElement("svg",{width:"4px",height:"16px",viewBox:"0 0 4 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},a.createElement("defs",null),a.createElement("g",{stroke:"none",strokeWidth:"1",fillRule:"evenodd"},a.createElement("g",{transform:"translate(-1301.000000, -550.000000)",fill:"#CCCCCC"},a.createElement("g",{transform:"translate(155.000000, 92.000000)"},a.createElement("g",{transform:"translate(40.000000, 184.000000)"},a.createElement("g",{transform:"translate(0.000000, 161.000000)"},a.createElement("g",null,a.createElement("g",{transform:"translate(50.000000, 2.000000)"},a.createElement("path",{d:"M1058,122.2 C1056.895,122.2 1056,123.096 1056,124.2 C1056,125.306 1056.895,126.202 1058,126.202 C1059.104,126.202 1060,125.306 1060,124.2 C1060,123.096 1059.104,122.2 1058,122.2 M1058,116.6 C1056.895,116.6 1056,117.496 1056,118.6 C1056,119.706 1056.895,120.602 1058,120.602 C1059.104,120.602 1060,119.706 1060,118.6 C1060,117.496 1059.104,116.6 1058,116.6 M1058,111 C1056.895,111 1056,111.896 1056,113 C1056,114.106 1056.895,115.002 1058,115.002 C1059.104,115.002 1060,114.106 1060,113 C1060,111.896 1059.104,111 1058,111"})))))))));var Q=i(2385),z=i(9908),Y=i(4365),K=i.n(Y),J=i(3955);function ee(){return ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},ee.apply(this,arguments)}const te=self.__LOCALE__||"SG",ie=self.__ENV__||"test",ae=K().mall,ne=K().env,se=ne[ie]+ae[te],re=e=>`${e[0]}*****${e[e.length-1]}`,oe=e=>{const t={};return e.forEach((e=>{const i=e.itemid;if(t[i]){const a=`${t[i].model_name||""} , ${e.model_name||""}`;t[i].model_name=a}else t[i]=ee({},e)})),Object.keys(t).map((e=>t[e]))};var le;!function(e){e[e.EX_LOW=-2]="EX_LOW",e[e.LOW=-1]="LOW",e[e.NORMAL=0]="NORMAL"}(le||(le={}));const{t:ce}=h.I18n,{jsonPost:de}=h.FetchUtils;function me(e){const{type:t=0,videos:i=0,photos:a=0}=e;let n="";if(t===le.EX_LOW||t===le.LOW){const{collectObj:s}=e,{blur:r,blank:o,dark:l}=s;let c=[r?"blur":void 0,o?"blank":void 0,l?"dark":void 0];c=c.filter((e=>void 0!==e)),i&&a?1===c.length?c.includes("blur")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_1"):ce("tips_medias_quality_low_3_1"):c.includes("blank")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_2"):ce("tips_medias_quality_low_3_2"):c.includes("dark")&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_3"):ce("tips_medias_quality_low_3_3")):2===c.length?c.includes("blur")&&c.includes("blank")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_4"):ce("tips_medias_quality_low_3_4"):c.includes("blur")&&c.includes("dark")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_5"):ce("tips_medias_quality_low_3_5"):c.includes("blank")&&c.includes("dark")&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_6"):ce("tips_medias_quality_low_3_6")):3===c.length&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_3_7"):ce("tips_medias_quality_low_3_7")):i&&!a?1===c.length?c.includes("blur")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_1"):ce("tips_medias_quality_low_2_1"):c.includes("blank")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_2"):ce("tips_medias_quality_low_2_2"):c.includes("dark")&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_3"):ce("tips_medias_quality_low_2_3")):2===c.length?c.includes("blur")&&c.includes("blank")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_4"):ce("tips_medias_quality_low_2_4"):c.includes("blur")&&c.includes("dark")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_5"):ce("tips_medias_quality_low_2_5"):c.includes("blank")&&c.includes("dark")&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_6"):ce("tips_medias_quality_low_2_6")):3===c.length&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_2_7"):ce("tips_medias_quality_low_2_7")):!i&&a&&(1===c.length?c.includes("blur")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_1"):ce("tips_medias_quality_low_1_1"):c.includes("blank")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_2"):ce("tips_medias_quality_low_1_2"):c.includes("dark")&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_3"):ce("tips_medias_quality_low_1_3")):2===c.length?c.includes("blur")&&c.includes("blank")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_4"):ce("tips_medias_quality_low_1_4"):c.includes("blur")&&c.includes("dark")?n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_5"):ce("tips_medias_quality_low_1_5"):c.includes("blank")&&c.includes("dark")&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_6"):ce("tips_medias_quality_low_1_6")):3===c.length&&(n=t===le.EX_LOW?ce("tips_medias_quality_ex_1_7"):ce("tips_medias_quality_low_1_7")))}return n}async function he(e){return await de("/api/v4/comment/text_quality_detection",e)}function ue(e,t,i){const a=[];let n="";return e.includes("blur")&&a.push("blur"),e.includes("blank")&&a.push("blank"),e.includes("dark")&&a.push("dark"),i||t!==le.LOW?(1===a.length?a.includes("blank")?n=ce("tips_media_check_new_1_"+(t===le.EX_LOW?"exlow":"low")):a.includes("blur")?n=ce("tips_media_check_new_2_"+(t===le.EX_LOW?"exlow":"low")):a.includes("dark")&&(n=ce("tips_media_check_new_3_"+(t===le.EX_LOW?"exlow":"low"))):2===a.length?a.includes("blank")&&a.includes("blur")?n=ce("tips_media_check_new_4_"+(t===le.EX_LOW?"exlow":"low")):a.includes("blank")&&a.includes("dark")?n=ce("tips_media_check_new_5_"+(t===le.EX_LOW?"exlow":"low")):a.includes("blur")&&a.includes("dark")&&(n=ce("tips_media_check_new_6_"+(t===le.EX_LOW?"exlow":"low"))):n=ce("tips_media_check_new_7_"+(t===le.EX_LOW?"exlow":"low")),n):ce("tips_media_content_7_edit_low")}const pe=(e,t,i)=>{let a=0,n=0;t&&(i&&i.length>0&&Object.keys(t).forEach((e=>{i.includes(e)||delete t[e]})),Object.values(t).forEach((e=>{a=Math.max((null==e?void 0:e.coins_earned_with_pictures_and_videos)||0,a),n=Math.max(e.coins_earned_with_pictures_or_videos||0,n)})));const s=a||0,r=n||0;return{show_pic_and_video:s>0,show_pic_or_video:r>0,pic_and_video:s,pic_or_video:r}},{t:_e}=h.I18n,ge=({ratings:e,handleOpenEditRating:t,updateRatingAfterSetAnonymous:i,defaultRatingReviewTemplate:n,defaultRatingShowEditButton:s})=>{if(!e)return null;const r=e.filter((e=>0!==e.status));if(0===r.length)return a.createElement("div",null,a.createElement("p",{className:V},_e("pr_review_deleted")));const o=r.map(((e,r)=>{var o;const l=[...e.videos||[],...e.images||[]],c=e.ItemRatingReply?e.ItemRatingReply.comment:null,d=(0,z.mr)(e.ctime);return a.createElement(a.Fragment,{key:r},a.createElement("div",{className:"dskqD7"},a.createElement(U,{item:oe(e.product_items||[])[0],className:"c4pOPk"}),!e.is_hidden&&0!==e.status&&(0,u.y9)(e)&&s?a.createElement(v.Ig,{onClick:()=>t(r)},a.createElement("span",null," ",_e("pr_order_purchase_label_edit")," ")):a.createElement(Z,{anonymous:e.anonymous,updateRatingAfterSetAnonymous:()=>i(r),cmtid:e.cmtid,shopid:e.shopid})),a.createElement("div",{className:"yyFGbY"},a.createElement("div",{className:"CgtV6Z"},a.createElement(O.Z,{className:"ciwbpX",imgSrc:(0,Q.Jn)(e.author_portrait,!0)})),a.createElement("div",{className:"U72Kmv"},a.createElement("div",{className:"-ZNN+S"},e.author_username),a.createElement(L.TE,{rating:null==(o=e.detailed_rating)?void 0:o.product_quality,size:14}),a.createElement("div",{className:"Vkt-za"},n?a.createElement(x.tD,{isDeleted:0===e.status,isHidden:e.is_hidden,comment:e.comment,templateTags:e.template_tags||[],hasTemplateTag:!!e.has_template_tag}):e.comment?e.is_hidden?null:a.createElement("p",{className:V},0===e.status?_e("pr_review_deleted"):e.comment):null,e.tags&&a.createElement(F,{tags:e.tags})),l.length&&!e.is_hidden?a.createElement("div",{className:"nJGOWA"},a.createElement("div",{className:"rating-modal__image-list-wrapper"},a.createElement(N.Z,{urlList:l}))):null,a.createElement("div",{className:"_15y39D"},d),c&&a.createElement(T.Z,{className:"nQoMN2",titleText:_e("pr_order_purchase_label_seller_response"),response:c,isHidden:e.ItemRatingReply&&e.ItemRatingReply.is_hidden}))))}));return a.createElement(a.Fragment,null,o)};var Ee=i(5349);const{t:fe}=h.I18n;class ye extends n().Component{constructor(e){super(e),this.state={reply:""}}onChange(e){this.setState({reply:e})}render(){const{placeholder:e=fe("label_seller_response"),memo:t=fe("label_seller_can_only_reply_once"),onClickSave:i,onClickCancel:a,error:s,textSave:r,textCancel:o}=this.props;return n().createElement("div",{className:"product-rating-reply"},n().createElement("div",{className:D()("product-rating-reply__input",{"product-rating-reply__input--error":s})},n().createElement(Ee.Z,{maxLength:500,placeholder:e,onChange:this.onChange.bind(this),errorT:fe})),s&&n().createElement("div",{className:"product-rating-reply__error"},fe(s)),n().createElement("div",{className:"product-rating-reply__actions"},n().createElement(v.oe,{modifiers:["primary"],classnames:["product-rating-reply__button","product-rating-reply__button--save"],onClick:i&&i.bind(this,this.state.reply)},r||fe("label_save")),n().createElement(v.Ig,{classnames:["product-rating-reply__button","product-rating-reply__button--cancel"],onClick:a},o||fe("label_cancel")),n().createElement("div",{className:"product-rating-reply__fatty"}),n().createElement("div",{className:"product-rating-reply__memo"},t)))}}const Ce=ye,ve="K43ZVh",we="yWw-8o",{t:Re}=h.I18n;class ke extends n().Component{constructor(e){var t;super(e),t=this,this.onClickReplyButton=()=>{this.setState({inReplyMode:!0})},this.onClickCancelReplyButton=()=>{this.setState({inReplyMode:!1})},this.onClickSaveReplyButton=async function(e){const i=t.props.rating,{orderid:a,cmtid:n,shopid:s}=i;await t.props.replyBuyerRating(n,a,s,e)},this.onSaveReplyError=e=>{this.setState({replyError:e})},this.onSaveReplySuccess=e=>{this.setState({responseText:e})},this.state={inReplyMode:!1,responseText:"",replyError:"",rating:e.rating}}render(){const{rating:e}=this.state;if(0===Object.keys(e).length)return n().createElement("div",null,n().createElement("p",{className:ve},Re("pr_review_deleted")));const t=[...e.videos||[],...e.images||[]],i=e.UserRatingReply,a=i&&i.comment||this.props.replyText||this.state.responseText,s=(0,z.mr)(e.ctime);return n().createElement(n().Fragment,null,n().createElement("div",{className:"TGL58F"},n().createElement(O.Z,{imgSrc:(0,Q.Jn)(e.author_pic,!0)}),n().createElement("div",{className:"HzV7cA"},e.author_name),!a&&!this.state.inReplyMode&&n().createElement("div",{onClick:this.onClickReplyButton,className:"k-wx4q"},Re("pr_label_reply"))),n().createElement("div",{className:"Z+5dA3"},n().createElement(L.TE,{rating:e.rating_star,size:14}),e.comment&&n().createElement("div",{className:ve},e.comment),t.length?n().createElement("div",{className:"_9T4O6F"},n().createElement("div",{className:"rating-modal__image-list-wrapper"},n().createElement(N.Z,{urlList:t}))):null,n().createElement("div",{className:"_31dT-a"},s),!a&&this.state.inReplyMode&&n().createElement("div",{className:we},n().createElement(Ce,{placeholder:Re("pr_order_purchase_label_buyer_response"),memo:Re("pr_text_you_can_only_reply_rating_once"),onClickSave:this.onClickSaveReplyButton,onClickCancel:this.onClickCancelReplyButton,textSave:Re("pr_order_purchase_label_save"),textCancel:Re("pr_order_purchase_label_cancel"),error:this.state.replyError})),a&&n().createElement("div",{className:we},n().createElement(T.Z,{titleText:Re("pr_label_your_response"),response:a}))))}}const Me=(0,o.connect)(((e,t)=>({replyText:e.rating&&e.rating.ratingReplies[t.rating.cmtid]})),{replyBuyerRating:u.YA})(ke);var be=i(8002),Se=i(1874);const{t:Ie,tNode:Oe}=h.I18n;class Le extends a.PureComponent{constructor(...e){super(...e),this.renderText=(e,t)=>{const{requirement:i}=this.props,a=e||t?["pr_label_rating_hint",e>0&&"X_word"+(e>1?"s":""),t>0&&"Y_picture"+(t>1?"s":""),"Z_coin"].filter(Boolean).join("_"):"pr_label_rating_hint_submit_to_win";return i.coins_earned?Ie(a,{word:e,picture:t,coins_earned:i.coins_earned}):""},this.keywordColorful=e=>{const{enableRatingCreationUIRevamp:t}=this.props,i="en"===(0,J.of)();return t?a.createElement("span",{className:"NKG8UH"},`${e} ${Ie("coins")}`):i?`${e} ${Ie("coins")}`:e},this.renderReviewText=({wordOk:e,imageOK:t,videoOk:i,imageToGo:a,videoToGo:n,wordToGo:s})=>{const{categoryCoin:r,enableRatingCreationUIRevamp:o}=this.props,l=o?Oe:Ie;let c;const d=(null==r?void 0:r.coins_earned_with_pictures_and_videos)||0,m=(null==r?void 0:r.coins_earned_with_pictures_or_videos)||0;if(!m&&!d)return"";if(!d)return c;const h=this.keywordColorful(m),u=this.keywordColorful(d);return c=e&&t&&i?l("new_msg_submit_rating_to_earn_coins",{coins_earned:u}):e&&t?!m&&d?l("msg_add_video_to_earn_coins_two",{needed_video:n,coins_earned_with_video:u}):l("msg_add_video_to_earn_coins",{coins_earned:h,needed_video:n,coins_earned_with_video:u}):e&&i?!m&&d?l("msg_add_pics_to_earn_coins_two",{needed_pictures:a,coins_earned_with_pics:u}):l("msg_add_pics_to_earn_coins",{coins_earned:h,needed_pictures:a,coins_earned_with_pics:u}):e?l("msg_add_pics_and_video_to_earn_coins",{needed_video:n,needed_pictures:a,coins_earned_with_pics_and_videos:u}):t&&i?l("msg_add_words_to_earn_coins",{needed_characters:s,coins_earned_with_pics_and_videos:u}):t?l("msg_add_words_and_video_to_earn_coins",{needed_characters:s,needed_video:n,coins_earned_with_pics_and_videos:u}):i?l("msg_add_words_and_pics_to_earn_coins",{needed_characters:s,needed_pictures:a,coins_earned_with_pics_and_videos:u}):l("msg_add_words_and_medias_to_earn_coins",{needed_characters:s,needed_pictures:a,needed_video:n,coins_earned_with_pics_and_videos:u}),c}}render(){const{requirement:e,characterCount:t,imageCount:i,videoCount:n=0,defaultVideoReview:s}=this.props,r=Math.max(0,e.minimum_characters-t),o=Math.max(0,e.minimum_pictures-i),l=Math.max(0,(e.minimum_videos||0)-n),c=!r,d=!o,m=!l;let h;return h=s?this.renderReviewText({wordOk:c,imageOK:d,videoOk:m,imageToGo:o,videoToGo:l,wordToGo:r}):this.renderText(r,o),a.createElement("div",{className:"uidlKc"},h)}}function Te(){return Te=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Te.apply(this,arguments)}const Ne=function(e){return n().createElement("svg",Te({width:"20",height:"15",viewBox:"0 0 20 15",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1 0.0769043C0.447715 0.0769043 0 0.524619 0 1.0769V13.1945C0 13.7468 0.447715 14.1945 1 14.1945H13.1176C13.6699 14.1945 14.1176 13.7468 14.1176 13.1945V1.0769C14.1176 0.52462 13.6699 0.0769043 13.1176 0.0769043H1ZM10.5883 7.1356C10.5883 9.08484 9.00811 10.665 7.05887 10.665C5.10963 10.665 3.52946 9.08484 3.52946 7.1356C3.52946 5.18636 5.10963 3.60619 7.05887 3.60619C9.00811 3.60619 10.5883 5.18636 10.5883 7.1356ZM7.05916 9.48862C8.35865 9.48862 9.4121 8.43517 9.4121 7.13568C9.4121 5.83619 8.35865 4.78274 7.05916 4.78274C5.75966 4.78274 4.70622 5.83619 4.70622 7.13568C4.70622 8.43517 5.75966 9.48862 7.05916 9.48862ZM20.0003 1.25341L15.2944 4.78244V9.4887L20.0003 13.0181V1.25341Z",fill:"#EE4D2D"}))};function xe(){return xe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},xe.apply(this,arguments)}const Ae=function(e){return n().createElement("svg",xe({width:"20",height:"15",viewBox:"0 0 20 15",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1 0.0769348C0.447715 0.0769348 0 0.52465 0 1.07693V13.1946C0 13.7469 0.447715 14.1946 1 14.1946H13.1176C13.6699 14.1946 14.1176 13.7469 14.1176 13.1946V1.07693C14.1176 0.52465 13.6699 0.0769348 13.1176 0.0769348H1ZM10.5883 7.13563C10.5883 9.08487 9.00811 10.665 7.05887 10.665C5.10963 10.665 3.52946 9.08487 3.52946 7.13563C3.52946 5.18639 5.10963 3.60622 7.05887 3.60622C9.00811 3.60622 10.5883 5.18639 10.5883 7.13563ZM7.05916 9.48865C8.35865 9.48865 9.4121 8.4352 9.4121 7.13571C9.4121 5.83622 8.35865 4.78277 7.05916 4.78277C5.75966 4.78277 4.70622 5.83622 4.70622 7.13571C4.70622 8.4352 5.75966 9.48865 7.05916 9.48865ZM20.0003 1.25344L15.2944 4.78247V9.48873L20.0003 13.0181V1.25344Z",fill:"black",fillOpacity:"0.26"}))};function De(){return De=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},De.apply(this,arguments)}const qe=function(e){return n().createElement("svg",De({width:"20",height:"18",viewBox:"0 0 20 18",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.15377 9.76895C6.15377 11.8927 7.87492 13.6151 9.99992 13.6151C12.1236 13.6151 13.8461 11.8927 13.8461 9.76895C13.8461 7.6446 12.1236 5.9228 9.99992 5.9228C7.87492 5.9228 6.15377 7.6446 6.15377 9.76895ZM5 9.76896C5 7.00771 7.23813 4.76896 10 4.76896C12.7613 4.76896 15 7.00771 15 9.76896C15 12.5296 12.7613 14.769 10 14.769C7.23813 14.769 5 12.5296 5 9.76896ZM1.15385 17.2606C0.489784 17.2606 0 16.7249 0 16.0662V4.12218C0 3.46224 0.489784 2.8459 1.15385 2.8459H4.61538L5.21635 1.73267C5.21635 1.73267 5.75421 0.538208 6.41827 0.538208H13.5817C14.2452 0.538208 14.7837 1.73267 14.7837 1.73267L15.3846 2.8459H18.8462C19.5096 2.8459 20 3.46224 20 4.12218V16.0662C20 16.7249 19.5096 17.2606 18.8462 17.2606H1.15385Z",fill:"#EE4D2D"}))};function Be(){return Be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Be.apply(this,arguments)}const We=function(e){return n().createElement("svg",Be({width:"20",height:"18",viewBox:"0 0 20 18",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.15377 9.76902C6.15377 11.8927 7.87492 13.6152 9.99992 13.6152C12.1236 13.6152 13.8461 11.8927 13.8461 9.76902C13.8461 7.64466 12.1236 5.92286 9.99992 5.92286C7.87492 5.92286 6.15377 7.64466 6.15377 9.76902ZM5 9.76902C5 7.00777 7.23813 4.76902 10 4.76902C12.7613 4.76902 15 7.00777 15 9.76902C15 12.5296 12.7613 14.769 10 14.769C7.23813 14.769 5 12.5296 5 9.76902ZM1.15385 17.2607C0.489784 17.2607 0 16.725 0 16.0662V4.12224C0 3.4623 0.489784 2.84596 1.15385 2.84596H4.61538L5.21635 1.73273C5.21635 1.73273 5.75421 0.538269 6.41827 0.538269H13.5817C14.2452 0.538269 14.7837 1.73273 14.7837 1.73273L15.3846 2.84596H18.8462C19.5096 2.84596 20 3.4623 20 4.12224V16.0662C20 16.725 19.5096 17.2607 18.8462 17.2607H1.15385Z",fill:"black",fillOpacity:"0.26"}))};function Ue(){return Ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Ue.apply(this,arguments)}const Fe=function(e){return n().createElement("svg",Ue({width:"10",height:"10",viewBox:"0 0 10 10",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.28268 0.908882C8.47794 0.71362 8.79452 0.71362 8.98978 0.908882L9.0908 1.0099C9.28606 1.20516 9.28606 1.52174 9.0908 1.717L1.71669 9.09112C1.52142 9.28638 1.20484 9.28638 1.00958 9.09112L0.908564 8.9901C0.713301 8.79484 0.713301 8.47826 0.908563 8.283L8.28268 0.908882Z",fill:"#F6F6F6"}),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M1.00973 0.908882C1.20499 0.71362 1.52157 0.71362 1.71683 0.908882L9.09095 8.28299C9.28621 8.47826 9.28621 8.79484 9.09095 8.9901L8.98993 9.09112C8.79467 9.28638 8.47809 9.28638 8.28283 9.09112L0.908713 1.717C0.713451 1.52174 0.71345 1.20516 0.908713 1.0099L1.00973 0.908882Z",fill:"#F6F6F6"}))};function $e(){return $e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},$e.apply(this,arguments)}const je=function(e){return n().createElement("svg",$e({width:"18",height:"18",viewBox:"0 0 18 18",fill:"none"},e),n().createElement("g",{filter:"url(#filter0_d)"},n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5 4C4.44772 4 4 4.44772 4 5V13C4 13.5523 4.44772 14 5 14H13C13.5523 14 14 13.5523 14 13V5C14 4.44772 13.5523 4 13 4H5ZM11.5 9C11.5 10.3807 10.3807 11.5 9 11.5C7.61929 11.5 6.5 10.3807 6.5 9C6.5 7.61929 7.61929 6.5 9 6.5C10.3807 6.5 11.5 7.61929 11.5 9ZM9 10.6667C9.92047 10.6667 10.6667 9.92047 10.6667 9C10.6667 8.07952 9.92047 7.33333 9 7.33333C8.07953 7.33333 7.33333 8.07952 7.33333 9C7.33333 9.92047 8.07953 10.6667 9 10.6667ZM18.1667 4.83333L14.8333 7.33306V10.6667L18.1667 13.1667V4.83333Z",fill:"white"})),n().createElement("defs",null,n().createElement("filter",{id:"filter0_d",x:"0",y:"0",width:"22.1667",height:"18",filterUnits:"userSpaceOnUse",colorInterpolationFilters:"sRGB"},n().createElement("feFlood",{floodOpacity:"0",result:"BackgroundImageFix"}),n().createElement("feColorMatrix",{in:"SourceAlpha",type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"}),n().createElement("feOffset",null),n().createElement("feGaussianBlur",{stdDeviation:"2"}),n().createElement("feColorMatrix",{type:"matrix",values:"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.26 0"}),n().createElement("feBlend",{mode:"normal",in2:"BackgroundImageFix",result:"effect1_dropShadow"}),n().createElement("feBlend",{mode:"normal",in:"SourceGraphic",in2:"effect1_dropShadow",result:"shape"}))))},Pe="xR+F1t",Ve=({width:e,height:t,duration:i=1e3})=>{const[a,s]=n().useState(0),r=Math.sqrt(e*e+t*t);return n().useEffect((()=>{const e=Math.max(1e3,i/6);let t=0;const a=setInterval((()=>{t+=20,t>e-50&&clearInterval(a),s(Math.floor(100*t/e))}),20);return()=>clearInterval(a)}),[i]),n().createElement("div",{className:"mSxY+U"},a<100?n().createElement("div",{style:{width:r,height:r,top:(t-r)/2},className:D()(Pe,"nBRRDA")},n().createElement("div",{style:a>50?{transform:`rotate(${Math.PI*((a-50)/50)}rad)`}:{}})):null,a<50?n().createElement("div",{style:{width:r,height:r,top:(t-r)/2},className:D()(Pe,"qX+D47")},n().createElement("div",{style:{transform:`rotate(${Math.PI*(a/50)}rad)`}})):null,n().createElement("div",null,a,"%"))};i(8971);var He=i(5082),Ge=i.n(He);function Ze(){return Ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Ze.apply(this,arguments)}const Xe=self.__LOCALE__||"SG",Qe=self.__ENV__||"test",ze=132.5,Ye=1080,Ke=K().mall,Je=K().env,et=Je[Qe]+Ke[Xe];function tt(e,t,i){const a={};e<i||t<i?e/t>1?(a.height=t,a.width=1*t):(a.width=e,a.height=e/1):(a.width=i,a.height=i);const n=Math.min(e/a.width,t/a.height);return a.srcHeight=t/n,a.srcWidth=e/n,a.y=(a.srcHeight-a.width)/2,a.x=(a.srcWidth-a.height)/2,a}function it(e,t,i){const a=Math.max(e,t);if(a>i){const n=a/i;e/=n,t/=n}return{width:e,height:t,x:0,y:0,srcWidth:e,srcHeight:t}}function at(e){return new Promise((function(t){const i=document.createElement("canvas"),a=new FileReader;a.onload=e=>{const a=new Image,n=e.target.result;a.onload=()=>{const e=[ze,Ye].map(((e,t)=>{const n=(0===t?tt:it)(a.width,a.height,e);i.width=n.width,i.height=n.height;const s=i.getContext("2d");return s&&s.drawImage(a,-n.x,-n.y,n.srcWidth,n.srcHeight),i.toDataURL("image/jpeg",.6)}));var n;t({key:(n=e[0],n.substr(20+Math.floor(80*Math.random()),50)),thumbnail:e[0],image:e[1]})},a.src=n},a.readAsDataURL(e)}))}const nt=(e="")=>/^https?:\/\/.*/.test(e)?e:(0,Q.Jn)(e),st=e=>new Promise(((t,i)=>{const a=document.createElement("video"),n=URL.createObjectURL(e),s={url:n,size:e.size},r=()=>{s.cover&&s.duration&&t(s)};a.addEventListener("timeupdate",(e=>{s.cover||(s.cover=((e,t)=>{const i=document.createElement("canvas"),a=i.getContext("2d");i.width=e.videoWidth,i.height=e.videoHeight,a&&a.drawImage(e,0,0),i.toBlob((e=>{if(!e)return;const t=e;t.lastModifiedDate=new Date,t.name="cover.jpg",(({cover:e,coverFile:t})=>{s.cover=e,s.coverFile=t,r()})({cover:URL.createObjectURL(e),coverFile:t})}),"image/jpeg"),e.pause()})(e.target))}),!1),a.addEventListener("error",(()=>{i(Ze({type:"VIDEO_PLAY_ERROR"},a.error))})),a.addEventListener("loadedmetadata",(e=>{s.duration=Math.ceil(1e3*e.target.duration),r()}),!1),a.src=n,a.muted=!0,a.play()})),rt=async({file:e,coverFile:t,duration:i})=>{var a,n;const s=await fetch(`https://rating.${"AR"!==Xe?et:Je[Qe]+"shopee.com.ar"}/api/v1/video/video_preupload`,{method:"POST",credentials:"include"}).then((e=>e.json())).catch((e=>Promise.reject(e)));if(!s)return Promise.reject("service is empty");const{vid:r,services:o}=s.data,{serviceid:l,token:c,upload_domain:d,bucket:m,domain:h,slicesize:u}=o[0],p=new(Ge())([{serviceID:l,authorization:c,sliceSize:u,uploadDomain:d.replace(/^https?/,"https"),domain:h.replace(/^https?/,"https"),bucket:m,vid:r,env:Qe,country:Xe,serviceIndex:0,biz:103}]),_=(new Date).getTime(),g=await p.upload({mediaFile:e,coverFile:t,mediaType:He.MediaType.video}),E=await g.done().catch((e=>Promise.reject(e))),f={vid:r,serviceid:l,extendid:null==E||null==(a=E.video)?void 0:a.extendId,fsize:e.size,md5:null==E||null==(n=E.video)?void 0:n.md5,videourl:null==E?void 0:E.video.url,cover:null==E?void 0:E.cover.url,code:0,reportdata:{cost:Date.now()-_},fileinfos:{duration:i}};return await fetch(`https://rating.${"AR"!==Xe?et:Je[Qe]+"shopee.com.ar"}/api/v1/video/video_reportupload`,{method:"POST",credentials:"include",headers:{"content-type":"application/json; charset=utf-8"},body:JSON.stringify(f)}),Promise.resolve({id:r,url:null==E?void 0:E.video.url,cover:null==E?void 0:E.cover.url,duration:i,upload_time:Date.now()-_})},ot=async(e,t)=>{const i={image_ids:e,video_ids:t},a=await fetch(`https://rating.${"AR"!==Xe?et:Je[Qe]+"shopee.com.ar"}/api/v1/comment/media_quality_detection`,{method:"POST",credentials:"include",headers:{"content-type":"application/json; charset=utf-8"},body:JSON.stringify(i)});return await a.json()},lt="QwLC-D",ct="u3qmpx",dt="kYFUTE",mt="JvQtB0",ht=["type","key"];function ut(){return ut=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},ut.apply(this,arguments)}const{t:pt}=h.I18n;let _t;!function(e){e[e.IMAGE=0]="IMAGE",e[e.VIDEO=1]="VIDEO"}(_t||(_t={}));const gt=({type:e,onChange:t,fileKey:i})=>{const a=e===_t.IMAGE?"image/*":"video/mp4";return n().createElement("label",{className:"cJpFhi"},e===_t.IMAGE?n().createElement(qe,null):n().createElement(Ne,null),n().createElement("span",{className:lt},e===_t.IMAGE?pt("label_add_photo"):pt("rating_entrance_name_video")),n().createElement("input",{key:i,className:ct,type:"file",onChange:t,accept:a}))},Et=({type:e,onChange:t,currentLength:i,fileKey:a})=>{const s=e===_t.IMAGE?ft:yt,r=s-i;if(!r)return null;const o=e===_t.IMAGE?"image/*":"video/mp4";return n().createElement("label",{className:"lNICD2"},e===_t.IMAGE?n().createElement(We,null):n().createElement(Ae,null),n().createElement("span",{className:lt},r,"/",s),n().createElement("input",{key:a,className:ct,type:"file",onChange:t,accept:o}))};let ft=6;const yt=1,Ct=(0,o.connect)(null,{})((({images:e=[],videos:t=[],pendingImagesLength:i=0,pendingVideosLength:s=0,orderId:r,onMediaChange:o,onUploadSuccess:l,defaultVideoReview:c})=>{const d=e.length+i,m=t.length+s,[h,u]=n().useState(Math.random());if(d>=ft&&m>=yt)return null;const p=e=>t=>{u(Math.random());const i=`${Date.now()}`,a=t.target.files[0];if(e===_t.IMAGE)at(a).then((t=>{o({type:e,key:i,media:t.image},1),(async(t,a,n)=>{const s={};try{const e=new He.MMSImg({env:Qe,country:Xe,biz:4103});e.base64Upload([t]);const i=await e.done();s.response=i[0]}catch(r){s.error=r}var r,c;r=s.error,c=s.response,o({type:e,key:i},-1),c&&!r&&l(e,i,c.img_id)})(t.image,a.name)}));else{const a=t.target.files[0];st(a).then((t=>{if(!(t.duration>=3e3&&t.duration<=6e4))throw new Error("duration");if(t.size>1e7)throw new Error("filesize");return o({type:e,key:i,media:t.cover,duration:t.duration},1),ut({file:a,orderid:r},t)})).then(rt).then((t=>{o({type:e,key:i},-1),l(e,i,t)})).catch((t=>{"VIDEO_PLAY_ERROR"===t.type?window.alert(pt("rating_upload_video_fail_toast")):"filesize"===t.message?window.alert(pt("rating_toast_video_upload_size_limit")):"duration"===t.message?window.alert(pt("rating_toast_video_uploadlimit",{min:3,max:60})):o({type:e,key:i},-1)}))}};return d||m?n().createElement(a.Fragment,null,n().createElement(Et,{type:_t.IMAGE,onChange:p(_t.IMAGE),fileKey:`${_t.IMAGE}_${h}`,currentLength:d}),c?n().createElement(Et,{type:_t.VIDEO,onChange:p(_t.VIDEO),fileKey:`${_t.VIDEO}_${h}`,currentLength:m}):null):n().createElement(a.Fragment,null,n().createElement(gt,{type:_t.IMAGE,onChange:p(_t.IMAGE),fileKey:`${_t.IMAGE}_${h}`}),c?n().createElement(gt,{type:_t.VIDEO,onChange:p(_t.VIDEO),fileKey:`${_t.IMAGE}_${h}`}):null)})),vt=e=>({media:e,type:_t.IMAGE,key:e}),wt=e=>({media:e,type:_t.VIDEO,key:e.url}),Rt=({videos:e=[],images:t=[],onRemove:i,pendingVideos:s,pendingImages:r,cannotRedShow:o})=>n().createElement(a.Fragment,null,e.map((({media:e,key:t,type:a,quality:s})=>n().createElement("div",{key:t,className:dt,style:{backgroundImage:`url(${e.cover})`,border:o?"none":s?"string"==typeof s?"none":Object.values(s).includes(-2)||Object.values(s).includes(-1)?"2px solid #EE2C4A":"none":"none"}},n().createElement("button",{onClick:()=>i({type:a,key:t})},n().createElement(Fe,null)),n().createElement("div",{className:"HzPSps"},n().createElement(je,null),n().createElement("span",null,e.duration?((e=0,t="m:ss")=>{const i=Math.ceil(e/1e3),a=Math.floor(i/60),n=i%60,s={mm:`0${a}`.substr(-2),m:a,ss:`0${n}`.substr(-2),s:n};return Object.keys(s).reduce(((e,t)=>e.replace(t,`${s[t]}`)),t)})(e.duration):null))))),s.map(((e,t)=>n().createElement("div",{key:t,className:D()(dt,mt)},n().createElement("img",{src:e.media}),n().createElement(Ve,{width:54,height:54,duration:e.duration})))),t.map((({media:e,key:t,type:a,quality:s})=>n().createElement("div",{key:t,className:dt,style:{backgroundImage:`url(${nt(e)})`,border:o?"none":s?"string"==typeof s?"none":Object.values(s).includes(-2)||Object.values(s).includes(-1)?"2px solid #EE2C4A":"none":"none"}},n().createElement("button",{onClick:()=>i({type:a,key:t})},n().createElement(Fe,null))))),r.map(((e,t)=>n().createElement("div",{key:t,className:D()(dt,mt)},n().createElement("img",{src:e.media}),n().createElement(Ve,{width:54,height:54})))));class kt extends n().Component{constructor(e){var t;super(e),t=this,this.timeoutTag=!1,this.currentImages=[],this.currentVideos=[],this.currentPendingImages=[],this.currentPendingVideos=[],this.handleRemoveMedia=({type:e,key:t})=>{const{defaultRatingMediaQualityCheck:i}=this.props,{images:a,videos:n}=this.state;e===_t.IMAGE?this.setState({images:a.filter((e=>e.key!==t))},(()=>{this.handleMediasChange(),i&&this.reportMediaCheck()})):this.setState({videos:n.filter((e=>e.key!==t))},(()=>{this.handleMediasChange(),i&&this.reportMediaCheck()}))},this.handleUploadSuccess=(e,t,i)=>{const{images:a,videos:n}=this.state,{defaultRatingMediaQualityCheck:s}=this.props;e===_t.IMAGE?this.setState({images:[...a,{key:t,type:e,media:i}]},(()=>{this.handleMediasChange(),s&&(this.timeoutTag=!1,this.uploadCheck(e,t,i))})):this.setState({videos:[...n,{key:t,type:e,media:i}]},(()=>{this.handleMediasChange(),s&&(this.timeoutTag=!1,this.uploadCheck(e,t,i))}))},this.clearMediaTimeout=()=>{},this.uploadCheck=async function(e,i,a,n=1){let s;const r=[],o=[],{collectAllMedia:l,itemId:c,cancelCollectMedia:d}=t.props;if(e===_t.IMAGE?(s=a,r.push(s)):(s=a.id,o.push(s)),n>10){if(e===_t.IMAGE){const e=t.state.images;e.forEach((e=>{e.media===a&&(e.quality={blur:0,blank:0,dark:0})})),t.setState({images:e},(()=>{clearTimeout(t.timeoutCheckMedia),d&&d(`${c}_${s}`),t.reportMediaCheck()}))}else if(e===_t.VIDEO){const e=t.state.videos;e.forEach((e=>{e.media.id===a.id&&(e.quality={blur:0,blank:0,dark:0})})),t.setState({videos:e},(()=>{clearTimeout(t.timeoutVideo),d&&d(`${c}_${s}`),t.reportMediaCheck()}))}return}if(t.timeoutTag)return;let m;l&&l(`${c}_${s}`);try{m=await ot(r,o)}catch(h){m={code:1e4}}if(0!==m.code)if(e===_t.VIDEO){const s=t.state.videos;t.setState({videos:s},(()=>{clearTimeout(t.timeoutVideo),t.timeoutVideo=setTimeout((()=>{t.uploadCheck(e,i,a,n+1)}),1e3)}))}else{const s=t.state.images;t.setState({images:s},(()=>{clearTimeout(t.timeoutCheckMedia),t.timeoutCheckMedia=setTimeout((()=>{t.uploadCheck(e,i,a,n+1)}),1e3)}))}else if(0===m.code)if(e===_t.IMAGE){const e=t.state.images;e.forEach((e=>{e.media===a&&(e.quality=m.data.image[0].quality)})),t.setState({images:e},(()=>{clearTimeout(t.timeoutCheckMedia),d&&d(`${c}_${s}`),t.reportMediaCheck()}))}else if(e===_t.VIDEO){const e=t.state.videos;e.forEach((e=>{e.media.id===a.id&&(e.quality=m.data.video[0].quality)})),t.setState({videos:e},(()=>{clearTimeout(t.timeoutVideo),d&&d(`${c}_${s}`),t.reportMediaCheck()}))}},this.reportMediaCheck=()=>{const{images:e,videos:t}=this.state,{isShowMediaCheckErr:i,itemId:a,collectMediaCheck:n}=this.props,s=[],r=[],o=[],l=[],c=[];let d;if(e.forEach((e=>{if(e.quality){const{blur:t,blank:i,dark:a}=e.quality,n=[],o=[];-2===t?n.push("blur"):-1===t&&o.push("blur"),-2===i?n.push("blank"):-1===i&&o.push("blank"),-2===a?n.push("dark"):-1===a&&o.push("dark"),n.length&&s.push(n),o.length&&r.push(o)}})),t.forEach((e=>{if(e.quality)if("string"==typeof e.quality)c.push(e.media.id);else{const{blur:t,blank:i,dark:a}=e.quality,n=[],s=[];-2===t?n.push("blur"):-1===t&&s.push("blur"),-2===i?n.push("blank"):-1===i&&s.push("blank"),-2===a?n.push("dark"):-1===a&&s.push("dark"),n.length&&o.push(n),s.length&&l.push(s)}})),c.length)if(s.length+o.length>0){let e=[];s.forEach((t=>{e=e.concat(t)})),o.forEach((t=>{e=e.concat(t)})),e=Array.from(new Set(e));const t={blur:e.includes("blur"),blank:e.includes("blank"),dark:e.includes("dark")};d={type:-3,videos:o.length,photos:s.length,collectObj:t}}else if(r.length+l.length>0){let e=[];r.forEach((t=>{e=e.concat(t)})),l.forEach((t=>{e=e.concat(t)})),e=Array.from(new Set(e));const t={blur:e.includes("blur"),blank:e.includes("blank"),dark:e.includes("dark")};d={type:-3,videos:l.length,photos:r.length,collectObj:t}}else d={type:-3,videos:0,photos:0,collectObj:{blur:!1,blank:!1,dark:!1}};else if(s.length+o.length>0){let e=[];s.forEach((t=>{e=e.concat(t)})),o.forEach((t=>{e=e.concat(t)})),e=Array.from(new Set(e));const t={blur:e.includes("blur"),blank:e.includes("blank"),dark:e.includes("dark")};d={type:-2,videos:o.length,photos:s.length,collectObj:t}}else if(r.length+l.length>0){let e=[];r.forEach((t=>{e=e.concat(t)})),l.forEach((t=>{e=e.concat(t)})),e=Array.from(new Set(e));const t={blur:e.includes("blur"),blank:e.includes("blank"),dark:e.includes("dark")};d={type:-1,videos:l.length,photos:r.length,collectObj:t}}else d={type:0,videos:0,photos:0,collectObj:{blur:!1,blank:!1,dark:!1}};i&&i(d),n&&n(a,d)},this.handleMediasChange=()=>{const{images:e,videos:t}=this.state;this.props.onMediasChange({images:e.map((({media:e})=>e)),videos:t.map((({media:e})=>e))})},this.isWebUrl=(e="")=>!!e.startsWith("http://")||!!e.startsWith("https://"),this.getValue=()=>{const{images:e,videos:t}=this.state;return[void 0,{photos:e.map((({media:e})=>e)),videos:t.map((({media:e})=>({url:e.url,id:e.id,cover:e.cover,duration:e.duration,upload_time:e.upload_time})))}]},this.handleMediaChange=(e,t=0)=>{let{type:i,key:a}=e,n=function(e,t){if(null==e)return{};var i,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)i=s[a],t.indexOf(i)>=0||(n[i]=e[i]);return n}(e,ht);const s=i===_t.IMAGE?"pendingImages":"pendingVideos",r=this.state[s];t>0?this.setState(ut({},this.state,{[s]:[...r,ut({key:a},n)]}),this.handleReadyStateChange):t<0&&this.setState(ut({},this.state,{[s]:r.filter((e=>e.key!==a))}),this.handleReadyStateChange)},this.handleReadyStateChange=()=>{const{pendingImages:e,pendingVideos:t}=this.state;this.props.onStateChange({ready:!(e.length||t.length)})},this.initCheckMedia=async function(e=1){if(e>10)return;if(t.timeoutTag)return;const{images:i,videos:a}=t.state;if(i.length+a.length===0)return;const n=[],s=[];let r;i.forEach((e=>n.push(e.media))),a.forEach((e=>s.push(e.media.id)));try{r=await ot(n,s)}catch(o){r={code:1e4}}0===r.code?(r.data&&r.data.image.forEach((e=>{i.forEach((t=>{t.media===e.image_id&&(t.quality=e.quality)}))})),r.data&&r.data.video.forEach((e=>{a.forEach((t=>{t.media.id===e.video_id&&(t.quality=e.quality)}))})),t.setState({images:i,videos:a},(()=>{t.reportMediaCheck()}))):(clearTimeout(t.initTimeoutCheck),t.initTimeoutCheck=setTimeout((()=>{t.initCheckMedia(e+1)}),1e3))},this.UNSAFE_componentWillReceiveProps=e=>{const{showDialogNow:t,cannotRedShow:i}=this.props;e.showDialogNow!==t&&this.setState({showDialogNow:e.showDialogNow}),(null==e?void 0:e.cannotRedShow)!==i&&this.setState({})},this.state={images:(e.images||[]).map(vt),videos:(e.videos||[]).map(wt),pendingImages:[],pendingVideos:[],showDialogNow:!1},e.defaultVideoReview&&(ft=5)}componentDidMount(){const{defaultRatingMediaQualityCheck:e}=this.props;e&&(this.timeoutTag=!1,this.initCheckMedia())}componentWillUnmount(){this.clearMediaTimeout()}render(){const{images:e,videos:t,pendingImages:i,pendingVideos:a,showDialogNow:s}=this.state,{defaultRatingCommentCheck:r,cannotRedShow:o}=this.props;return s||(this.currentImages=e,this.currentVideos=t,this.currentPendingImages=i,this.currentPendingVideos=a),n().createElement("div",{className:"P9VoSN"},r?n().createElement(n().Fragment,null,n().createElement(Rt,{pendingImages:i,pendingVideos:a,images:e,videos:t,onRemove:this.handleRemoveMedia,cannotRedShow:o}),n().createElement(Ct,{images:e,videos:t,pendingImagesLength:i.length,pendingVideosLength:a.length,orderId:this.props.orderId,onMediaChange:this.handleMediaChange,onUploadSuccess:this.handleUploadSuccess,defaultVideoReview:this.props.defaultVideoReview,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck})):n().createElement(n().Fragment,null,n().createElement(Rt,{pendingImages:this.currentPendingImages,pendingVideos:this.currentPendingVideos,images:this.currentImages,videos:this.currentVideos,onRemove:this.handleRemoveMedia,cannotRedShow:o}),n().createElement(Ct,{images:this.currentImages,videos:this.currentVideos,pendingImagesLength:this.currentPendingImages.length,pendingVideosLength:this.currentPendingVideos.length,orderId:this.props.orderId,onMediaChange:this.handleMediaChange,onUploadSuccess:this.handleUploadSuccess,defaultVideoReview:this.props.defaultVideoReview,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck})))}}const Mt="_2+GbxN",{t:bt}=h.I18n;function St(e){return e/16+"rem"}const It=/(\r\n)|\r|\n/g;class Ot extends a.Component{constructor(e){super(e),this.textareaRef=null,this.handleChange=e=>{this.textareaRef&&(this.textareaRef.style.height="auto",this.textareaRef.style.height=St(this.textareaRef.scrollHeight)),this.setState({value:e}),this.props.onTemplateChange(this.props.template,e.replace(It," "))},this.handleKeydown=e=>{13===e.keyCode&&e.preventDefault()},this.handleSelect=e=>{e.preventDefault();const{template:t}=this.state;if(this.textareaRef){const e=this.textareaRef.selectionStart,i=this.textareaRef.selectionEnd;e<=t.length&&this.textareaRef.setSelectionRange(t.length,i)}},this.handleMouseMove=e=>{e.preventDefault()};const{value:t,index:i}=e;this.holderText=0===i?`${bt("label_review_template_hint")}`:"",this.state={template:"",value:`${t||""}`}}shouldComponentUpdate(e,t){return t!==this.state}componentDidMount(){this.props.onTemplateChange(this.props.template,this.state.value),window.document.body.style.userSelect="none",this.textareaRef&&this.state.value&&(this.textareaRef.style.height="auto",this.textareaRef.style.height=St(this.textareaRef.scrollHeight))}render(){const{value:e}=this.state;return a.createElement("div",{className:"ypcgk-"},a.createElement("div",{className:"lTln84",style:{fontWeight:e?600:"normal"}},this.props.template.trim(),":"),a.createElement("textarea",{className:Mt,value:e,onChange:e=>{let t=e.target.value;this.handleChange(t)},onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,rows:1,placeholder:this.holderText,ref:e=>{this.textareaRef=e}}))}componentWillUnmount(){window.document.body.style.userSelect="auto"}}const Lt=Ot;function Tt(){return Tt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Tt.apply(this,arguments)}const{t:Nt}=h.I18n;var xt;!function(e){e[e.normal=0]="normal",e[e.low=-1]="low",e[e.exLow=-2]="exLow"}(xt||(xt={}));class At extends a.Component{constructor(e){super(e),this.textareaRef=null,this.text=`${Nt("label_review_template_newhint")}`,this.onChangeTemplateText=(e,t)=>{const{value:i,templateMap:a}=this.state,{onTemplateChange:n}=this.props,s=Tt({},a,{[e]:t});this.setState({templateMap:s,ratingComments:Object.values(s).join("")+i}),"function"==typeof n&&n(e,t)},this.handleChange=e=>{const{templateMap:t}=this.state;this.textareaRef&&(this.textareaRef.style.height="auto",this.textareaRef.style.height=this.textareaRef.scrollHeight/16+"rem"),this.setState({value:e,ratingComments:Object.values(t).join("")+e}),this.props.onCommentChange(e)},this.handleFocus=()=>{},this.handleBlur=()=>{},this.handleMouseMove=e=>{e.preventDefault()},this.state={value:e.value||"",placeholder:this.text,templateMap:{},ratingComments:""}}shouldComponentUpdate(e,t){return t!==this.state||e!==this.props}render(){const{value:e,placeholder:t,ratingComments:i}=this.state,{templateTags:n,templateTagComments:s,commentQuality:r,canGetCoin:o,mediaQuantity:l,minimum_characters:c}=this.props;return a.createElement("div",{className:r===xt.exLow||l===Ht.EX_LOW&&r!==xt.normal||r!==xt.normal&&o?"h7PxI8":"x1-Ftz"},n.map(((e,t)=>a.createElement(Lt,{template:e,onTemplateChange:this.onChangeTemplateText,key:e,value:s[e],index:t}))),a.createElement("div",{className:"mbAyaM"}),a.createElement("div",{style:{position:"relative"}},a.createElement("textarea",{className:Mt,value:e,onChange:e=>{let t=e.target.value;this.handleChange(t)},onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseMove:this.handleMouseMove,style:{minHeight:"100px",color:"rgba(0, 0, 0, 0.87)"},rows:3,placeholder:t,ref:e=>{this.textareaRef=e}})))}}At.defaultProps={templateTagComments:{}};const Dt=At;function qt(e){if(!e)return 0;const t=e.replace(/[\u0009-\u000D\u0020\u0085\u00A0\u1680\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]/g,"");return Array.from(t).length}var Bt,Wt;!function(e){e[e.normal=0]="normal",e[e.elow=-2]="elow",e[e.low=-1]="low",e[e.notready=-3]="notready"}(Bt||(Bt={})),function(e){e[e.normal=0]="normal",e[e.low=-1]="low",e[e.exLow=-2]="exLow"}(Wt||(Wt={}));const{t:Ut}=h.I18n;function Ft(e,t,i,a,n,s,r){let o="",l=0,c=0;return!t&&i?l=1:t&&!i?l=2:t&&i&&(l=3),s===n&&r!==n?c=1:s!==n&&r===n?c=2:s===n&&r===n&&(c=3),n===Wt.normal?1===a.length?a.includes("blur")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_1`):Ut(`tips_medias_quality_low_${l}_1`):a.includes("blank")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_2`):Ut(`tips_medias_quality_low_${l}_2`):a.includes("dark")&&(o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_3`):Ut(`tips_medias_quality_low_${l}_3`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_4`):Ut(`tips_medias_quality_low_${l}_4`):a.includes("blur")&&a.includes("dark")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_5`):Ut(`tips_medias_quality_low_${l}_5`):a.includes("blank")&&a.includes("dark")&&(o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_6`):Ut(`tips_medias_quality_low_${l}_6`)):3===a.length&&(o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_7`):Ut(`tips_medias_quality_low_${l}_7`)):n===Wt.low?e===Bt.normal||e===Bt.notready?o=Ut(`tips_comment_check_low_1_${c}`):e===Bt.low?1===a.length?a.includes("blur")?o=Ut(`tips_media_comment_check_low_${l}_1_${c}`):a.includes("blank")?o=Ut(`tips_media_comment_check_low_${l}_2_${c}`):a.includes("dark")&&(o=Ut(`tips_media_comment_check_low_${l}_3_${c}`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=Ut(`tips_media_comment_check_low_${l}_4_${c}`):a.includes("blur")&&a.includes("dark")?o=Ut(`tips_media_comment_check_low_${l}_5_${c}`):a.includes("blank")&&a.includes("dark")&&(o=Ut(`tips_media_comment_check_low_${l}_6_${c}`)):3===a.length&&(o=Ut(`tips_media_comment_check_low_${l}_7_${c}`)):e===Bt.elow&&(1===a.length?a.includes("blur")?o=Ut(`tips_media_comment_check_ex_${l}_1_${c}`):a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_2_${c}`):a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_3_${c}`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_4_${c}`):a.includes("blur")&&a.includes("dark")?o=Ut(`tips_media_comment_check_ex_${l}_5_${c}`):a.includes("blank")&&a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_6_${c}`)):3===a.length&&(o=Ut(`tips_media_comment_check_ex_${l}_7_${c}`))):n===Wt.exLow&&(e===Bt.elow||e===Bt.low?1===a.length?a.includes("blur")?o=Ut(`tips_media_comment_check_ex_${l}_1_${c}`):a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_2_${c}`):a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_3_${c}`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_4_${c}`):a.includes("blur")&&a.includes("dark")?o=Ut(`tips_media_comment_check_ex_${l}_5_${c}`):a.includes("blank")&&a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_6_${c}`)):3===a.length&&(o=Ut(`tips_media_comment_check_ex_${l}_7_${c}`)):o=Ut("tips_comment_check_dialog_exlow")),o}function $t(e,t,i,a,n,s,r){let o="",l=0,c=0;return!t&&i?l=1:t&&!i?l=2:t&&i&&(l=3),s===n&&r!==n?c=1:s!==n&&r===n?c=2:s===n&&r===n&&(c=3),n===Wt.normal?1===a.length?a.includes("blur")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_1`):Ut(`tips_medias_quality_low_edit_${l}_1`):a.includes("blank")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_2`):Ut(`tips_medias_quality_low_edit_${l}_2`):a.includes("dark")&&(o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_3`):Ut(`tips_medias_quality_low_edit_${l}_3`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_4`):Ut(`tips_medias_quality_low_edit_${l}_4`):a.includes("blur")&&a.includes("dark")?o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_5`):Ut(`tips_medias_quality_low_edit_${l}_5`):a.includes("blank")&&a.includes("dark")&&(o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_6`):Ut(`tips_medias_quality_low_edit_${l}_6`)):3===a.length&&(o=e===Bt.elow?Ut(`tips_medias_quality_ex_${l}_7`):Ut(`tips_medias_quality_low_edit_${l}_7`)):n===Wt.low?e===Bt.normal||e===Bt.notready?o=Ut(`tips_comment_check_low_edit_1_${c}`):e===Bt.low?1===a.length?a.includes("blur")?o=Ut(`tips_media_comment_check_low_edit_${l}_1_${c}`):a.includes("blank")?o=Ut(`tips_media_comment_check_low_edit_${l}_2_${c}`):a.includes("dark")&&(o=Ut(`tips_media_comment_check_low_edit_${l}_3_${c}`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=Ut(`tips_media_comment_check_low_edit_${l}_4_${c}`):a.includes("blur")&&a.includes("dark")?o=Ut(`tips_media_comment_check_low_edit_${l}_5_${c}`):a.includes("blank")&&a.includes("dark")&&(o=Ut(`tips_media_comment_check_low_edit_${l}_6_${c}`)):3===a.length&&(o=Ut(`tips_media_comment_check_low_edit_${l}_7_${c}`)):e===Bt.elow&&(1===a.length?a.includes("blur")?o=Ut(`tips_media_comment_check_ex_${l}_1_${c}`):a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_2_${c}`):a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_3_${c}`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_4_${c}`):a.includes("blur")&&a.includes("dark")?o=Ut(`tips_media_comment_check_ex_${l}_5_${c}`):a.includes("blank")&&a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_6_${c}`)):3===a.length&&(o=Ut(`tips_media_comment_check_ex_${l}_7_${c}`))):n===Wt.exLow&&(e===Bt.elow||e===Bt.low?1===a.length?a.includes("blur")?o=Ut(`tips_media_comment_check_ex_${l}_1_${c}`):a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_2_${c}`):a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_3_${c}`)):2===a.length?a.includes("blur")&&a.includes("blank")?o=Ut(`tips_media_comment_check_ex_${l}_4_${c}`):a.includes("blur")&&a.includes("dark")?o=Ut(`tips_media_comment_check_ex_${l}_5_${c}`):a.includes("blank")&&a.includes("dark")&&(o=Ut(`tips_media_comment_check_ex_${l}_6_${c}`)):3===a.length&&(o=Ut(`tips_media_comment_check_ex_${l}_7_${c}`)):o=Ut("tips_comment_check_dialog_exlow")),o}function jt(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function Pt(){return Pt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Pt.apply(this,arguments)}const{t:Vt}=h.I18n;let Ht;var Gt;!function(e){e[e.NO_READY=-3]="NO_READY",e[e.EX_LOW=-2]="EX_LOW",e[e.LOW=-1]="LOW",e[e.NORMAL=0]="NORMAL"}(Ht||(Ht={})),function(e){e[e.normal=0]="normal",e[e.low=-1]="low",e[e.exLow=-2]="exLow"}(Gt||(Gt={}));const Zt=[];class Xt extends a.Component{constructor(e){var t,i;super(e),this.mediaRef=null,this.useReviewTemplate=!1,this.templateTagComments={},this.commentQuality=Gt.normal,this.showErrContentForCheckResult=!1,this.showErrMsgForCheckResult="",this.canGetCoin=!1,this.initComments=()=>{const{isUpdating:e,rating:t,originTemplateTags:i}=this.props,a=t?t.comment:"",n=!!t&&!!t.has_template_tag;if(!e||!this.useReviewTemplate||!n)return{comment:a};const{tmpTagsComments:s,comments:r}=(0,x.mx)(i||[],a);return this.templateTagComments=Pt({},s),{comment:r}},this.toggleRatingAnonymous=()=>{this.setState({ratingAnonymous:!this.state.ratingAnonymous},(()=>{this.handleReadyStateChange()}))},this.handleMediasChange=({images:e,videos:t})=>{this.setState({images:e,videos:t},(()=>{this.canGetCoins(),this.handleReadyStateChange()}))},this.onCommentChange=e=>{const{deleteCommentCheckItemId:t,item:i}=this.props;this.setState({comment:e},(()=>{this.canGetCoins(),this.handleReadyStateChange()})),t&&t(i.itemid)},this.onTemplateChange=(e,t)=>{const{deleteCommentCheckItemId:i,item:a}=this.props;this.templateTagComments=Pt({},this.templateTagComments,{[e]:t}),Object.keys(this.templateTagComments).forEach((e=>{this.templateTagComments[e]=jt(this.templateTagComments[e])})),this.setState({},(()=>{this.handleReadyStateChange()})),this.canGetCoins(),i&&i(a.itemid)},this.getRatingComments=()=>{if(!this.useReviewTemplate)return this.state.comment;let e=this.state.comment;return Object.values(this.templateTagComments).forEach((t=>{e+=t})),e},this.isShowMediaCheckErr=e=>{const{type:t=0,videos:i=0,photos:a=0}=e,{isUpdating:n,isItemValidationCheckPass:s}=this.props;let r="";if(t===Ht.EX_LOW||t===Ht.LOW||t===Ht.NO_READY){const{defaultRatingCommentCheck:o}=this.props,{collectObj:l}=e,{blur:c,blank:d,dark:m}=l;let h=[c?"blur":void 0,d?"blank":void 0,m?"dark":void 0];h=h.filter((e=>void 0!==e)),o?1===h.length?h.includes("blank")?r=Vt("tips_media_content_1_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low")):h.includes("blur")?r=Vt("tips_media_content_2_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low")):h.includes("dark")&&(r=Vt("tips_media_content_3_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low"))):2===h.length?h.includes("blank")&&h.includes("blur")?r=Vt("tips_media_content_4_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low")):h.includes("blank")&&h.includes("dark")?r=Vt("tips_media_content_5_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low")):h.includes("blur")&&h.includes("dark")&&(r=Vt("tips_media_content_6_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low"))):r=Vt("tips_media_content_7_"+(t===Ht.EX_LOW?"exlow":n||!s?"edit_low":"low")):i&&a?1===h.length?h.includes("blur")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_1"):Vt(n||!s?"tips_medias_quality_low_edit_3_1":"tips_medias_quality_low_3_1"):h.includes("blank")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_2"):Vt(n||!s?"tips_medias_quality_low_edit_3_2":"tips_medias_quality_low_3_2"):h.includes("dark")&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_3"):Vt(n||!s?"tips_medias_quality_low_edit_3_3":"tips_medias_quality_low_3_3")):2===h.length?h.includes("blur")&&h.includes("blank")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_4"):Vt(n||!s?"tips_medias_quality_low_edit_3_4":"tips_medias_quality_low_3_4"):h.includes("blur")&&h.includes("dark")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_5"):Vt(n||!s?"tips_medias_quality_low_edit_3_5":"tips_medias_quality_low_3_5"):h.includes("blank")&&h.includes("dark")&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_6"):Vt(n||!s?"tips_medias_quality_low_edit_3_6":"tips_medias_quality_low_3_6")):3===h.length&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_3_7"):Vt(n||!s?"tips_medias_quality_low_edit_3_7":"tips_medias_quality_low_3_7")):i&&!a?1===h.length?h.includes("blur")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_1"):Vt(n||!s?"tips_medias_quality_low_edit_2_1":"tips_medias_quality_low_2_1"):h.includes("blank")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_2"):Vt(n||!s?"tips_medias_quality_low_edit_2_2":"tips_medias_quality_low_2_2"):h.includes("dark")&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_3"):Vt(n||!s?"tips_medias_quality_low_edit_2_3":"tips_medias_quality_low_2_3")):2===h.length?h.includes("blur")&&h.includes("blank")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_4"):Vt(n||!s?"tips_medias_quality_low_edit_2_4":"tips_medias_quality_low_2_4"):h.includes("blur")&&h.includes("dark")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_5"):Vt(n||!s?"tips_medias_quality_low_edit_2_5":"tips_medias_quality_low_2_5"):h.includes("blank")&&h.includes("dark")&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_6"):Vt(n||!s?"tips_medias_quality_low_edit_2_6":"tips_medias_quality_low_2_6")):3===h.length&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_2_7"):Vt(n||!s?"tips_medias_quality_low_edit_2_7":"tips_medias_quality_low_2_7")):!i&&a&&(1===h.length?h.includes("blur")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_1"):Vt(n||!s?"tips_medias_quality_low_edit_1_1":"tips_medias_quality_low_1_1"):h.includes("blank")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_2"):Vt(n||!s?"tips_medias_quality_low_edit_1_2":"tips_medias_quality_low_1_2"):h.includes("dark")&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_3"):Vt(n||!s?"tips_medias_quality_low_edit_1_3":"tips_medias_quality_low_1_3")):2===h.length?h.includes("blur")&&h.includes("blank")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_4"):Vt(n||!s?"tips_medias_quality_low_edit_1_4":"tips_medias_quality_low_1_4"):h.includes("blur")&&h.includes("dark")?r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_5"):Vt(n||!s?"tips_medias_quality_low_edit_1_5":"tips_medias_quality_low_1_5"):h.includes("blank")&&h.includes("dark")&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_6"):Vt(n||!s?"tips_medias_quality_low_edit_1_6":"tips_medias_quality_low_1_6")):3===h.length&&(r=t===Ht.EX_LOW?Vt("tips_medias_quality_ex_1_7"):Vt(n||!s?"tips_medias_quality_low_edit_1_7":"tips_medias_quality_low_1_7"))),this.setState({showMediaCheckErrContent:!!r,showMediaErrContent:r,mediaQualityType:t,photosCheckLength:a,videosCheckLength:i,badTypeArr:h},(()=>{const{defaultRatingCommentCheck:e}=this.props;e&&this.controlContent(),this.canGetCoins()}))}else this.setState({showMediaCheckErrContent:!1,mediaQualityType:Ht.NORMAL,photosCheckLength:0,videosCheckLength:0,badTypeArr:[]},(()=>{const{defaultRatingCommentCheck:e}=this.props;e&&this.controlContent(),this.canGetCoins()}))},this.canGetCoins=()=>{const{ratingMeta:e,defaultVideoReview:t,categoryCoin:i,isUpdating:a,collectCoinItem:n,item:s}=this.props,{videos:r,images:o}=this.state,l=qt(this.getRatingComments());if(!a)if(e&&e.coins_earned>=0){const a=Math.max(0,(null==e?void 0:e.minimum_characters)-l),c=Math.max(0,(null==e?void 0:e.minimum_pictures)-o.length),d=!a,m=!c,h=!Math.max(0,((null==e?void 0:e.minimum_videos)||0)-r.length);if(t){const t=(null==i?void 0:i.coins_earned_with_pictures_and_videos)||(null==e?void 0:e.coins_earned_with_pics_and_videos)||0,a=(null==i?void 0:i.coins_earned_with_pictures_or_videos)||(null==e?void 0:e.coins_earned)||0;if(!t&&!a)return n&&n(s.itemid,!1),void(this.canGetCoin=!1);d&&m&&h?t||a?(n&&n(s.itemid,!0),this.canGetCoin=!0):(n&&n(s.itemid,!1),this.canGetCoin=!1):d&&m?a?(n&&n(s.itemid,!0),this.canGetCoin=!0):(n&&n(s.itemid,!1),this.canGetCoin=!1):d&&h&&a?(n&&n(s.itemid,!0),this.canGetCoin=!0):(n&&n(s.itemid,!1),this.canGetCoin=!1)}else null!=e&&e.coins_earned?a||c?(n&&n(s.itemid,!1),this.canGetCoin=!1):(n&&n(s.itemid,!0),this.canGetCoin=!0):(n&&n(s.itemid,!1),this.canGetCoin=!1)}else n&&n(s.itemid,!1),this.canGetCoin=!0},this.clearMediaTimeout=()=>{var e;null==(e=this.mediaRef)||e.clearMediaTimeout()},this.getCommentCheck=()=>{const{commentCheckMap:e,item:t}=this.props,{itemid:i}=t,a=e&&e[Number(i)]?e[Number(i)]:{text:0,emoji:0,total:0};return this.commentQuality=a.total,a},this.renderTipsForComment=()=>{const{isUpdating:e,isItemValidationCheckPass:t}=this.props;this.getCommentCheck(),this.commentQuality===Gt.normal?(this.showErrContentForCheckResult=!1,this.showErrMsgForCheckResult=""):this.commentQuality===Gt.low?(this.showErrContentForCheckResult=!0,this.showErrMsgForCheckResult=Vt(e||!t?"tips_comment_content_edit_low":"tips_comment_content_low")):this.commentQuality===Gt.exLow&&(this.showErrContentForCheckResult=!0,this.showErrMsgForCheckResult=Vt("tips_comment_content_exlow"))},this.renderTipsForMediaCheckAndComment=()=>{const{mediaQualityType:e,photosCheckLength:t,videosCheckLength:i,badTypeArr:a}=this.state,{isUpdating:n}=this.props,s=this.getCommentCheck();this.commentQuality===Gt.normal?e===Ht.NORMAL||e===Ht.NO_READY?(this.showErrContentForCheckResult=!1,this.showErrMsgForCheckResult=""):(this.showErrContentForCheckResult=!0,this.showErrMsgForCheckResult=n?$t(e,i,t,a,this.commentQuality,(null==s?void 0:s.text)||0,(null==s?void 0:s.emoji)||0):Ft(e,i,t,a,this.commentQuality,(null==s?void 0:s.text)||0,(null==s?void 0:s.emoji)||0)):(this.commentQuality===Gt.low||this.commentQuality===Gt.exLow)&&(this.showErrContentForCheckResult=!0,this.showErrMsgForCheckResult=n?$t(e,i,t,a,this.commentQuality,(null==s?void 0:s.text)||0,(null==s?void 0:s.emoji)||0):Ft(e,i,t,a,this.commentQuality,(null==s?void 0:s.text)||0,(null==s?void 0:s.emoji)||0))},this.getHeight=()=>{var e;this.ratingHandlerDivRef&&(null==(e=this.ratingHandlerDivRef)||e.offsetHeight)},this.controlContent=(e="useTag")=>{if("useTag"===e){const{showDialogNow:e}=this.props;e||this.setState({currentMediaErrStatus:this.state.showMediaCheckErrContent,currentMediaErrContent:this.state.showMediaErrContent})}else e||this.setState({currentMediaErrStatus:this.state.showMediaCheckErrContent,currentMediaErrContent:this.state.showMediaErrContent})},this.handleRatingCommentChange=e=>{const{deleteCommentCheckItemId:t,item:i}=this.props;this.setState({comment:e},(()=>{this.canGetCoins(),this.handleReadyStateChange()})),t&&t(i.itemid)},this.onTagsChanged=e=>{this.setState({tags:e},(()=>{this.handleReadyStateChange()}))},this.handleRatingChange=e=>{if(e!==this.state.ratingStar){let t={ratingStar:e,tags:{},ratingReady:this.state.ratingReady};this.state.ratingReady||(t=Pt({},t,{ratingReady:!0})),this.setState(t,(()=>{this.handleReadyStateChange()}))}},this.handleReadyStateChange=()=>{this.props.onReadyStateChange&&this.props.onReadyStateChange()};const{rating:a,defaultRatingAnonymous:n,defaultRatingReviewTemplate:s,item:r,isUpdating:o,ratingMeta:l}=e;this.templateTags=o?a?a.template_tags:[]:r.template_tags;const c=!(!this.templateTags||!this.templateTags.length);this.useReviewTemplate=s&&c,this.isExclude=["TW","MY","CO","CL"].includes((0,J.Kd)()),this.state=Pt({ratingReady:a?null!=(t=a.detailed_rating)&&t.product_quality?!!a.detailed_rating.product_quality:!!a.rating_star:!(null==l||!l.default_rating_star||null==l||!l.default_rating_star),ratingStar:(null==a||null==(i=a.detailed_rating)?void 0:i.product_quality)||(null==a?void 0:a.rating_star)||(null==l?void 0:l.default_rating_star)||0,ratingAnonymous:n||!1,tags:a&&a.tags?a.tags.reduce(((e,t)=>(e[t.tag_id]=!0,e)),{}):{},images:a&&a.images?a.images:Zt,videos:a&&a.videos?a.videos:Zt},this.initComments(),{showMediaCheckErrContent:!1,showMediaErrContent:"",mediaQualityType:Ht.NORMAL,videosCheckLength:0,photosCheckLength:0,badTypeArr:[],currentMediaErrContent:"",currentMediaErrStatus:!1})}convertUrlsToImageData(e){return e.map((e=>({image:e,thumbnail:e})))}renderName(){const{ratingAnonymous:e}=this.state,{username:t}=this.props,i=e?re(t):t;return a.createElement(a.Fragment,null,a.createElement("div",{className:"rating-modal-handler__rating-anonymous-hint"},Vt(this.isExclude?"pr_label_rate_anonymously":"label_show_username_on_your_review")),a.createElement("div",{className:"rating-modal-handler__rating-anonymous-username"},Vt("pr_label_rate_anonymous_preview",{name:i})))}UNSAFE_componentWillReceiveProps(e){const{showDialogNow:t,defaultRatingCommentCheck:i,isUpdating:a,cannotRedShow:n}=this.props;i&&e.showDialogNow!==t&&this.controlContent(e.showDialogNow),a||(null==e?void 0:e.cannotRedShow)!==n&&this.setState({})}render(){const{ratingMeta:e,isItemValidationCheckPass:t,isUpdating:i,rating:n,defaultVideoReview:s,enableRatingCreationUIRevamp:r,defaultRatingCommentCheck:o,cannotRedShow:l}=this.props,{comment:c,showMediaCheckErrContent:d,showMediaErrContent:m,currentMediaErrContent:h,currentMediaErrStatus:u,mediaQualityType:p}=this.state,_=n||{images:[],videos:[]},g=this.getRatingComments();return o&&this.renderTipsForComment(),a.createElement("div",{className:D()("rating-modal-handler__container",!this.props.showBottomBorder&&"rating-modal-handler__container--last"),ref:e=>{this.ratingHandlerDivRef=e}},a.createElement(U,{item:this.props.item,className:"_2FrKCM"}),a.createElement("div",{style:{margin:"20px 0"}},a.createElement(L.kG,{title:Vt("low_rating_detail_product_quality"),rating:this.state.ratingStar,onRatingChange:this.handleRatingChange})),this.state.ratingReady&&a.createElement(a.Fragment,null,a.createElement("div",{className:"krYSZI"},this.useReviewTemplate?a.createElement(Dt,{templateTags:this.templateTags||[],onCommentChange:this.onCommentChange,onTemplateChange:this.onTemplateChange,value:c,templateTagComments:this.templateTagComments,commentQuality:this.commentQuality,canGetCoin:this.canGetCoin,mediaQuantity:p,minimum_characters:(null==e?void 0:e.minimum_characters)||0}):a.createElement("div",{style:{position:"relative"}},a.createElement(be.Z,{value:c,onChange:e=>{let t=e.target.value;this.handleRatingCommentChange(t)},placeholder:Vt("label_review_template_newhint"),style:this.commentQuality===Gt.exLow||p===Ht.EX_LOW&&this.commentQuality!==Gt.normal||this.commentQuality!==Gt.normal&&this.canGetCoin?{border:"2px solid #EE2C4A",transition:"none"}:{}})),a.createElement(kt,{ref:e=>{this.mediaRef=e},orderId:this.props.orderId,images:_.images||[],videos:_.videos||[],onStateChange:this.props.onImageReadyStateChange,defaultVideoReview:s,onMediasChange:this.handleMediasChange,itemId:this.props.item.itemid,isShowMediaCheckErr:this.isShowMediaCheckErr,collectMediaCheck:this.props.collectMediaCheck,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck,collectAllMedia:this.props.collectAllMedia,cancelCollectMedia:this.props.cancelCollectMedia,showDialogNow:this.props.showDialogNow,defaultRatingCommentCheck:this.props.defaultRatingCommentCheck,cannotRedShow:!i&&l}),l?t?a.createElement(Le,{classname:"rating-hint-text-coin",requirement:e,imageCount:this.state.images.length,videoCount:this.state.videos.length,defaultVideoReview:s,enableRatingCreationUIRevamp:r,categoryCoin:this.props.categoryCoin,characterCount:qt(g)}):null:(o?u:d)||this.showErrContentForCheckResult?a.createElement("div",{className:"rating-modal-handler_media-err-content"},o&&this.showErrContentForCheckResult?a.createElement("div",null,this.showErrMsgForCheckResult):null,o?u?a.createElement("div",{className:this.showErrContentForCheckResult?"rating-comment-check-with-media-check":""},h):null:d?a.createElement("div",{className:this.showErrContentForCheckResult?"rating-comment-check-with-media-check":""},m):null):t?a.createElement(Le,{classname:"rating-hint-text-coin",requirement:e,imageCount:this.state.images.length,videoCount:this.state.videos.length,defaultVideoReview:s,enableRatingCreationUIRevamp:r,categoryCoin:this.props.categoryCoin,characterCount:qt(g)}):null),a.createElement("div",{className:"rating-modal-handler__rating-anonymous-wrapper"},a.createElement(Se.Z,{checked:this.isExclude?this.state.ratingAnonymous:!this.state.ratingAnonymous,onClick:this.toggleRatingAnonymous}),a.createElement("div",{style:{marginLeft:4},onClick:this.toggleRatingAnonymous},this.renderName()))))}getData(){if(!this.mediaRef)return null;const[e,t]=this.mediaRef.getValue();return e?null:Pt({itemid:this.props.item.itemid,product_quality:this.state.ratingStar,comment:this.state.comment},t,{tagids:Object.keys(this.state.tags).map(Number).filter((e=>this.state.tags[e])),anonymous:this.state.ratingAnonymous,template_tag_comments:Pt({},this.templateTagComments)})}getEditData(){if(!this.mediaRef)return null;const[e,t]=this.mediaRef.getValue();return e?null:Pt({itemid:this.props.item.itemid,comment:this.state.comment},t,{tagids:Object.keys(this.state.tags).map(Number).filter((e=>this.state.tags[e])),anonymous:this.state.ratingAnonymous,detailed_rating:{product_quality:this.state.ratingStar,seller_service:this.props.detailedRating.seller_service,delivery_service:this.props.detailedRating.delivery_service},template_tag_comments:Pt({},this.templateTagComments)})}}Xt.defaultProps={showBottomBorder:!1};const Qt=Xt;var zt=i(9122);const Yt="ZAUdXM",Kt="yAFiuH",Jt="z49H8+";var ei=i(4376),ti=i(9197),ii=i(9449),ai=i(6294);const ni="hNrilO",si="_3GPjzj",{t:ri}=h.I18n,oi=e=>{const{direction:t,meta:i,categoryCoinList:s,coinLimitSetting:r}=e,o=(()=>{let e;switch((0,J.Kd)()){case"MX":case"CL":case"CO":e="";break;case"SG":e="https://help.shopee.sg/s/article/How-to-write-a-high-quality-product-review-0222";break;case"ID":e="https://help.shopee.co.id/s/article/Bagaimana-cara-menulis-ulasan-yang-baik";break;case"VN":e="https://help.shopee.vn/s/article/Lam-The-Nao-De-Co-1-Bai-Viet-Danh-Gia-Chat-Luong";break;case"MY":e="https://help.shopee.com.my/my/s/article/How-to-write-a-high-quality-product-review";break;case"TW":e="https://help.shopee.tw/tw/s/article/%E5%A6%82%E4%BD%95%E6%92%B0%E5%AF%AB%E6%9C%89%E5%B9%AB%E5%8A%A9%E7%9A%84%E5%95%86%E5%93%81%E8%A9%95%E5%83%B";break;case"TH":e="https://help.shopee.co.th/s/article/%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B8%A3%E0%B8%B5%E0%B8%A7%E0%B8%B4%E0%B8%A7%E0%B8%AA%E0%B8%B4%E0%B8%99%E0%B8%84%E0%B9%89%E0%B8%B2%E0%B9%83%E0%B8%AB%E0%B9%89%E0%B8%A1%E0%B8%B5%E0%B8%9B%E0%B8%A3%E0%B8%B0%E0%B8%AA%E0%B8%B4%E0%B8%97%E0%B8%98%E0%B8%B4%E0%B8%A0%E0%B8%B2%E0%B8%9E";break;case"BR":e="https://help.shopee.com.br/s/article/Como-ajudar-os-compradores-dando-avalia%C3%A7%C3%B5es-de-qualidade";break;case"PH":e="https://help.shopee.ph/ph/s/article/How-to-write-a-high-quality-product-review-ph";break;case"PL":e="https://help.shopee.pl/portal/article/183";break;case"ES":e="https://help.shopee.es/portal/article/69241-%C2%BFC%C3%B3mo-escribir-una-rese%C3%B1a-de-producto-de-alta-calidad?previousPage=secondary%20category&previousPage=other%20articles";break;case"AR":e="https://help.shopee.com.ar/portal/article/86827 "}return e})(),{show_pic_and_video:l,pic_and_video:c,show_pic_or_video:d,pic_or_video:m}=pe(0,s),h=r&&r.threshold>0,u=r&&r.max_times>0&&r.duration>0,p={shopid:null==i?void 0:i.shopId,orderid:null==i?void 0:i.orderId},_=(0,a.useRef)(null),g=(0,ii.Z)("RATING.imprReviewRewardCriteriaPanel",p),E=(0,ai.Z)("RATING.clickReviewRewardCriteriaPanel",{});return(0,a.useEffect)((()=>{g(_.current)}),[g]),n().createElement(ti.Z,{arrowWidth:28,arrowHeight:10,margin:0,arrowBackgroundColor:"#fff",position:"top"===t?ti.I.BOTTOM_RIGHT:ti.I.TOP_LEFT,fixedPosition:!0,showArrow:!0,showBorder:!0,useSafeMargin:!1,target:n().createElement("span",{onClick:()=>{E({targetData:p})}},"top"===t?n().createElement("span",{className:"l6uo9P"},n().createElement("span",{className:"XFKqlI"})):n().createElement("span",{className:"jq-hy3"},"?")),popover:n().createElement("div",{className:"Argpeg",ref:_},n().createElement("div",{className:"a7PiPO"},n().createElement("div",{className:"_8JuEVe"},ri("coins_panel_title")),n().createElement("div",{className:"A8u0vF"},ri("coins_panel_tip",{minimum_characters:null==i?void 0:i.minimum_characters}))),n().createElement("div",{className:"DH4wkp",style:{display:d||l?void 0:"none"}},n().createElement("div",{className:"RBN68C"},ri("coins_content_title")),d&&n().createElement("div",{className:ni},n().createElement("div",null,ri("coins_review_least_media",{minimum_pictures:(null==i?void 0:i.minimum_pictures)||1,minimum_videos:(null==i?void 0:i.minimum_videos)||1})),n().createElement("div",{className:si},m," ",ri("coins"))),l&&n().createElement("div",{className:ni},n().createElement("div",null,ri("coins_review_media")),n().createElement("div",{className:si},c," ",ri("coins")))),n().createElement("div",{className:"H+K9IM"},n().createElement("div",null,ri("coins_panel_footer_tips_one")),n().createElement("div",null,ri("coins_panel_footer_tips_two")),n().createElement("div",null,ri("coins_panel_footer_tips_three")),n().createElement("div",null,ri("coins_panel_footer_tips_four")),h&&n().createElement("div",null,ri("coins_panel_footer_tips_six",{threshold:(0,ei.JL)((null==r?void 0:r.threshold)||0)})),u&&n().createElement("div",null,ri("coins_panel_footer_tips_seven",{duration:null==r?void 0:r.duration,max_times:null==r?void 0:r.max_times})),n().createElement("div",null,ri("coins_panel_footer_tips_five"),n().createElement("a",{href:o,target:"_blank",rel:"noopener noreferrer",style:o?{color:"#3789f7",marginLeft:(4,"0.25rem")}:{display:"none"}},ri("tips_see_examples"))),"max_coins_varies_depending_on_item"===ri("max_coins_varies_depending_on_item")?null:n().createElement("div",null,ri("max_coins_varies_depending_on_item"))))})},{t:li,tNode:ci}=h.I18n;class di extends n().PureComponent{constructor(e){super(e),this.node=null,this.corner=null,this.renderText=e=>{const{enableRatingCreationUIRevamp:t}=this.props;return t?ci("coins_earned_tip",{coins_earned:n().createElement("span",{className:"rpaMYH"},`${e} ${li("coins")}`)}):li("prev_old_coins_earned_tip",{coins_earned:e})},this.state={shown:!1,top:0}}componentDidMount(){const{getBannerHeight:e}=this.props;e&&e(this.node&&Number(this.node.clientHeight)||0)}render(){const{meta:e,isMultiple:t,defaultVideoReview:i,categoryCoinList:a,coinLimitSetting:s}=this.props,{pic_and_video:r}=pe(0,a);return i?n().createElement("div",{className:Yt,ref:e=>{this.node=e}},n().createElement(zt.Z,{className:Kt}),n().createElement("span",{className:Jt},this.renderText(r)),n().createElement(oi,{direction:"top",meta:e,categoryCoinList:a,coinLimitSetting:s})):n().createElement("div",{className:Yt},n().createElement(zt.Z,{className:Kt}),n().createElement("span",{className:Jt},li(t?"label_rating_banner_multiple_copy":"pr_label_rating_banner",e)))}}const mi="_1x6dwo";function hi(){return hi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},hi.apply(this,arguments)}const{t:ui}=h.I18n,pi={product_quality:0,seller_service:0,delivery_service:0};class _i extends a.Component{constructor(e){super(e),this.handleRatingChange=(e,t)=>{const i=this.props.detailed_rating;switch(e){case"SELLER":this.props.onRatingChange(hi({},i,{seller_service:t}));break;case"DELIVERY":this.props.onRatingChange(hi({},i,{delivery_service:t}))}}}render(){const{detailed_rating:e=pi}=this.props;return a.createElement("div",null,a.createElement("div",{className:"_3AR6ye"},ui("label_about_service")),a.createElement("div",{className:"-mcd4A"},a.createElement("div",{className:mi},a.createElement(L.kG,{title:ui("low_rating_detail_seller_service"),rating:e.seller_service,onRatingChange:this.handleRatingChange.bind(this,"SELLER"),size:26})),a.createElement("div",{className:mi},a.createElement(L.kG,{title:ui("low_rating_detail_logistic_service"),rating:e.delivery_service,onRatingChange:this.handleRatingChange.bind(this,"DELIVERY"),size:26}))))}}const gi=_i,Ei="_15gfNt",fi="mPt1OW",yi="_2IyXvG";function Ci(){return Ci=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Ci.apply(this,arguments)}const{t:vi}=h.I18n,wi=[],Ri={product_quality:0,seller_service:0,delivery_service:0};class ki extends a.PureComponent{constructor(e){super(e),this._ratingHandlers=[],this.bannerHeight=0,this.handleImageReadyStateChange=e=>{this.setState({isImageReady:e.ready},this.props.forceFormUpdate)},this.handleReadyStateChange=()=>{this.props.forceFormUpdate()},this.getFilteredItems=()=>this.props.items||wi,this.getData=()=>{const e=this.props.items.length,t=[];for(let i=0;i<e;i++)if(this._ratingHandlers[i]){const e=this._ratingHandlers[i].getData();e&&t.push(e)}return{seller_service:this.state.detailed_rating.seller_service,delivery_service:this.state.detailed_rating.delivery_service,rate_items_data:t}},this.handleRatingDetailChangeService=e=>{this.props.updateSellerService(e),this.props.forceFormUpdate(),this.setState({detailed_rating:e})},this.isReady=()=>{const{rate_items_data:e}=this.getData();return this.props.items.length===e.length&&this.state.isImageReady},this.clearMediaTimeout=()=>{Object.values(this._ratingHandlers).forEach((e=>{null==e||e.clearMediaTimeout()}))},this.isShowCriteriaBottom=()=>{const{limitValidationMap:e}=this.props,t=e&&Object.values(e)[0].limits_info;return{passItemArray:e&&Object.keys(e).filter((t=>e[t].passed)),coinLimitSetting:t}},this.isShowBanner=()=>{const{ratingMeta:e,categoryCoinList:t}=this.props,{passItemArray:i}=this.isShowCriteriaBottom(),{pic_and_video:a}=pe(0,t,i);return!!((!i||i&&i.length>0)&&a>0)},this.getBannerHeight=e=>{this.bannerHeight=e},this.scrollToBottom=()=>{const e=document.getElementById("wrapper");e&&e.scrollIntoView()};const{ratingMeta:t}=this.props;this.state={isImageReady:!0,detailed_rating:Ci({},null!=t&&t.default_rating_star?{product_quality:t.default_rating_star,seller_service:t.default_rating_star,delivery_service:t.default_rating_star}:Ri)}}componentDidMount(){const{isShowCoinBanner:e}=this.props;this.props.updateSellerService(this.state.detailed_rating),e&&e(this.isShowBanner(),this.bannerHeight)}render(){const{limitValidationMap:e,shopId:t,orderId:i}=this.props,n=this.getFilteredItems(),{commentCheckMap:s,deleteCommentCheckItemId:r,collectLocationMap:o}=this.props,l=n.length,c=this.isShowBanner(),{coinLimitSetting:d}=this.isShowCriteriaBottom(),m=Ci({},this.props.ratingMeta,{shopId:t,orderId:i});return a.createElement(a.Fragment,null,c&&a.createElement(di,{isMultiple:n.length>1,orderLen:n.length,meta:m,categoryCoinList:this.props.categoryCoinList,defaultVideoReview:this.props.defaultVideoReview,getBannerHeight:this.getBannerHeight,coinLimitSetting:d,enableRatingCreationUIRevamp:this.props.enableRatingCreationUIRevamp}),n.map(((t,i)=>{var n,c;return o&&o(t.itemid,i+1),a.createElement(Qt,{key:i,ref:e=>{this._ratingHandlers[i]=e},item:t,rating:null,ratingMeta:this.props.ratingMeta,detailedRating:this.state.detailed_rating,onReadyStateChange:this.handleReadyStateChange,onImageReadyStateChange:this.handleImageReadyStateChange,showBottomBorder:i<l-1,orderId:this.props.orderId,userId:this.props.userId,categoryCoin:null==(n=this.props.categoryCoinList)?void 0:n[t.itemid],isItemValidationCheckPass:(!e||(null==(c=e[t.itemid])?void 0:c.passed))&&this.props.ratingMeta&&this.props.ratingMeta.coins_earned>0,username:this.props.username,defaultRatingAnonymous:this.props.defaultRatingAnonymous,defaultVideoReview:this.props.defaultVideoReview,enableRatingCreationUIRevamp:this.props.enableRatingCreationUIRevamp,defaultRatingReviewTemplate:this.props.defaultRatingReviewTemplate,collectMediaCheck:this.props.collectMediaCheck,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck,collectAllMedia:this.props.collectAllMedia,cancelCollectMedia:this.props.cancelCollectMedia,commentCheckMap:s,deleteCommentCheckItemId:r,defaultRatingCommentCheck:this.props.defaultRatingCommentCheck,showDialogNow:this.props.showDialogNow,collectCoinItem:this.props.collectCoinItem,cannotRedShow:this.props.cannotRedShow})})),a.createElement("div",{id:"wrapper"},a.createElement(gi,{detailed_rating:this.state.detailed_rating,onRatingChange:this.handleRatingDetailChangeService})),!c&&a.createElement("div",{className:"IQEImq"},a.createElement("span",null,vi("coins_panel_title")),a.createElement(oi,{direction:"bottom",meta:m,categoryCoinList:this.props.categoryCoinList,coinLimitSetting:d})))}}function Mi(){return Mi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Mi.apply(this,arguments)}const{t:bi}=h.I18n,{fetchInfo:Si}=h.FetchUtils,Ii={seller_service:0,delivery_service:0};class Oi extends a.Component{constructor(e){var t,i,a,n;super(e),this._ratingHandler=null,this.originTemplateTags=[],this.getLatestTags=()=>{const{rating:e}=this.state;this.props.defaultRatingReviewTemplate&&(this.setState({loading:!0}),Si(`/api/v2/item/get_rating${(0,d.Wc)({cmtid:e.cmtid,is_seller:0,shopid:e.shopid})}`).then((e=>{const t=(0,c.Z)(e,["response","data"],{});this.setState({rating:Mi({},this.state.rating,{template_tags:t.template_tags||[]}),loading:!1,error:!1})})).catch((()=>{this.setState({loading:!1,error:!0})})))},this.handleImageReadyStateChange=e=>{this.setState({isImageReady:e.ready},this.props.forceFormUpdate)},this.handleReadyStateChange=()=>{this.props.forceFormUpdate()},this.handleRatingDetailChange=()=>{this.props.forceFormUpdate()},this.handleRatingDetailChangeService=e=>{this.props.updateSellerService(e),this.props.forceFormUpdate(),this.setState({detailed_rating:e})},this.setRatingHandler=e=>{this._ratingHandler=e},this.getData=()=>this._ratingHandler?this._ratingHandler.getEditData():null,this.getRatingTemplateTags=()=>this.state.rating.template_tags||[],this.isReady=()=>this.state.isImageReady,this.scrollToBottom=()=>{const e=document.getElementById("wrapper");e&&e.scrollIntoView()},this.clearMediaTimeout=()=>{var e;null==(e=this._ratingHandler)||e.clearMediaTimeout()};const{ratingMeta:s}=this.props;this.state={isImageReady:!0,loading:!1,error:!1,rating:Mi({},e.rating),detailed_rating:Mi({},null!=(t=e.rating)&&null!=(i=t.detailed_rating)&&i.delivery_service&&null!=(a=e.rating)&&null!=(n=a.detailed_rating)&&n.seller_service?e.rating.detailed_rating:s?{seller_service:s.default_rating_star,delivery_service:s.default_rating_star}:Ii)},this.originTemplateTags=e.rating.template_tags||[]}componentDidMount(){this.props.forceFormUpdate(),this.getLatestTags(),this.props.updateSellerService(this.state.detailed_rating)}renderNewLoading(){return a.createElement(y.Z,{hideOverlay:!0,show:!0})}renderError(){return a.createElement("div",{className:Ei},a.createElement("span",{className:fi},bi("rating_loading_failed")),a.createElement("div",{className:yi,onClick:this.getLatestTags},bi("rating_btn_name_retry")))}render(){const{rating:e,loading:t,error:i}=this.state,{ratingMeta:n,orderId:s,userId:r}=this.props;return t?this.renderNewLoading():i?this.renderError():a.createElement("div",{className:"rating-modal-edit-item__container"},a.createElement(Qt,{ref:this.setRatingHandler,item:e.product_items&&e.product_items[0],rating:e,ratingMeta:n,originTemplateTags:this.originTemplateTags,onReadyStateChange:this.handleReadyStateChange,onImageReadyStateChange:this.handleImageReadyStateChange,detailedRating:this.state.detailed_rating,orderId:s,userId:r,username:this.props.username,defaultRatingAnonymous:this.props.defaultRatingAnonymous,defaultVideoReview:this.props.defaultVideoReview,enableRatingCreationUIRevamp:this.props.enableRatingCreationUIRevamp,defaultRatingReviewTemplate:this.props.defaultRatingReviewTemplate,isUpdating:!0,collectMediaCheck:this.props.collectMediaCheck,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck,collectAllMedia:this.props.collectAllMedia,cancelCollectMedia:this.props.cancelCollectMedia,commentCheckMap:this.props.commentCheckMap,deleteCommentCheckItemId:this.props.deleteCommentCheckItemId,defaultRatingCommentCheck:this.props.defaultRatingCommentCheck,showDialogNow:this.props.showDialogNow}),a.createElement("div",{id:"wrapper"},a.createElement(gi,{detailed_rating:this.state.detailed_rating,onRatingChange:this.handleRatingDetailChangeService})))}}const{t:Li}=h.I18n;function Ti({coinsAwarded:e}){return n().createElement("div",{className:"_9M+b9w"},n().createElement(zt.Z,{className:"g3J1Uz"}),n().createElement("div",{className:"VOPEAV"},Li("pr_label_rating_coins_awarded",{coins_earned:e})))}function Ni(){return Ni=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Ni.apply(this,arguments)}const xi=function(e){return n().createElement("svg",Ni({width:"54",height:"54",viewBox:"0 0 54 54",fill:"none"},e),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M27 53C41.3594 53 53 41.3594 53 27C53 12.6406 41.3594 1 27 1C12.6406 1 1 12.6406 1 27C1 41.3594 12.6406 53 27 53Z",stroke:"#66CC00",strokeWidth:"2"}),n().createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M26.7985 36.098L40.3628 22.263C41.273 21.3528 41.1992 19.8032 40.198 18.802C39.1968 17.8008 37.6472 17.727 36.737 18.6372L24.7717 30.8413L17.263 24.0774C16.3528 23.1672 14.8032 23.241 13.802 24.2422C12.8008 25.2435 12.727 26.7931 13.6372 27.7033L23.2458 36.3588C24.156 37.269 25.7056 37.1952 26.7069 36.194C26.7383 36.1625 26.7689 36.1305 26.7985 36.098Z",fill:"#66CC00"}))},{t:Ai}=h.I18n;function Di(){return n().createElement("div",{className:"_3IN0SF"},n().createElement(xi,{className:"_7iR6xP"}),n().createElement("div",{className:"plZoR-"},Ai("pr_toast_rating_success")))}const qi=i.p+"a02ade81006a12b6a5c4c2a2002b35bc.png";function Bi(){const e=window.document.documentMode;return n().createElement("div",{className:e?"L5dOS6":"aikazn"},n().createElement("div",{className:"_8zeF0y"},n().createElement("img",{src:qi,width:48,height:48})))}var Wi=i(9102),Ui=i(3662);function Fi(){return Fi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},Fi.apply(this,arguments)}const{fetchInfo:$i}=h.FetchUtils,{t:ji}=h.I18n;let Pi;var Vi,Hi,Gi,Zi;(Zi=Pi||(Pi={}))[Zi.VIEW_MODE=1]="VIEW_MODE",Zi[Zi.RATE_MODE=2]="RATE_MODE",Zi[Zi.EDIT_MODE=3]="EDIT_MODE",Zi[Zi.VIEW_BUYER_RATING_MODE=4]="VIEW_BUYER_RATING_MODE",function(e){e[e.EX_LOW=-2]="EX_LOW",e[e.LOW=-1]="LOW",e[e.NORMAL=0]="NORMAL"}(Vi||(Vi={})),function(e){e[e.EX_LOW=-2]="EX_LOW",e[e.LOW=-1]="LOW",e[e.NORMAL=0]="NORMAL"}(Hi||(Hi={})),function(e){e.SELLER_SERVICE="seller_service",e.DELIVERY_SERVICE="delivery_service",e.BOTH_SERVICE="delivery_service and seller_service"}(Gi||(Gi={}));const Xi=[];class Qi extends a.Component{constructor(e){var t;super(e),t=this,this._contentContainer=null,this._editRatingNewModal=null,this._editRatingUpdateModal=null,this._itemToMediasMap={},this._allMediaCheck={},this.loadingNow=!1,this.commentCheckMap={},this.commentQuality=0,this.waitCommentLoading=!1,this.showCoinBanner=!1,this.showCoinHeight=0,this.itemIdLocationMap={},this.getCoinItemList={},this.scrollToBottom=a.createRef(),this.detailed_rating={delivery_service:0,seller_service:0},this.collectCoinItem=(e,t)=>{this.getCoinItemList[e]=t},this.formattedRatings=e=>(e||[]).map((e=>{const t=e.author_pic||e.user_pic||e.author_portrait||"",i=e.author_name||e.username||e.author_username||"";return Fi({},e,{author_portrait:t,author_username:e.anonymous?re(i):i,author_name:i})})),this.updateDetailedRating=e=>{this.detailed_rating=e,e.delivery_service&&e.seller_service||this.props.isServiceEvaluationCanEmpty?this.setState({scrollBottom:!1}):e.delivery_service&&!e.seller_service?this.setState({warningState:Gi.SELLER_SERVICE}):!e.delivery_service&&e.seller_service?this.setState({warningState:Gi.DELIVERY_SERVICE}):e.delivery_service||e.seller_service||this.setState({warningState:Gi.BOTH_SERVICE})},this.getTime=async function(){const e=await async function(){try{const e=await fetch(`https://rating.${"AR"!==te?se:ne[ie]+"shopee.com.ar"}/api/v1/comment/rating_submit_wait_time`,{credentials:"include"});return await e.json()}catch(e){return{code:-1}}}();0===e.code&&t.setState({mediaCheckWaitTime:e.data.wait_time})},this.setEditRatingNewModal=e=>{this._editRatingNewModal=e},this.setEditRatingUpdateModal=e=>{this._editRatingUpdateModal=e},this.renderViewRating=()=>a.createElement(ge,{ratings:this.state.ratings||[],handleOpenEditRating:this.handleOpenEditRating,updateRatingAfterSetAnonymous:this.updateRatingAfterSetAnonymous,defaultRatingReviewTemplate:this.props.defaultRatingReviewTemplate,defaultRatingShowEditButton:this.props.defaultRatingShowEdit}),this.updateRatingAfterSetAnonymous=e=>{const t=this.state.ratings[e];if(!t)return;this.reloadOrderAfterRating();const i=[...this.state.ratings],a=t.author_name||t.username||t.author_username||"";i[e]=Fi({},t,{anonymous:!t.anonymous,author_username:t.anonymous?a:re(a)}),this.setState({ratings:i})},this.getTitle=()=>{switch(this.props.mode){case Pi.EDIT_MODE:case Pi.RATE_MODE:return ji("pr_label_rate_product");case Pi.VIEW_MODE:return this.state.editing?ji("pr_label_rate_product"):ji("pr_label_shop_rating");case Pi.VIEW_BUYER_RATING_MODE:return ji("pr_label_buyer_rating")}return""},this.getModalBody=()=>{let e=null;switch(this.props.mode){case Pi.EDIT_MODE:e=this.renderEditing();break;case Pi.RATE_MODE:e=this.state.isRatingLoading?this.renderNewLoading():this.state.getEditOrderDetailSucess?this.renderRating():this.renderError();break;case Pi.VIEW_MODE:e=this.state.editing?this.renderEditing():this.renderViewRating();break;case Pi.VIEW_BUYER_RATING_MODE:e=this.renderViewBuyerRating()}return e},this.handleOpenEditRating=e=>{this.setState({editing:!0,editingRatingIndex:e}),this.scrollToTopContentContainer()},this.backToView=()=>{this.setState({editing:!1}),this.clearTimeoutCheck(),this.scrollToTopContentContainer()},this.handleConfirmEditRating=()=>{var e;if(this.state.scrollBottom)return null==(e=this._editRatingUpdateModal)||e.scrollToBottom(),void this.setState({isConfirming:!1,showWaringPop:!0});this.setState({isConfirming:!0})},this.handleConfirmClose=()=>{this.setState({isConfirming:!1})},this.handleGoRating=()=>{this.setState({showWaringPop:!1})},this.getComments=(e,t)=>{const{defaultRatingReviewTemplate:i}=this.props;if(!i)return{comment:e?e.comment:"",template_tags:t};const a=e?e.template_tag_comments:{},n=[],s=e?e.comment:"";let r=!1;t.forEach((e=>{a[e]&&(n.push(`${e}:${a[e]}`),r=!0)}));const o=s?"\n\n":"";return{comment:n.length?[n.join("\n"),s].join(o):s,template_tags:r?t:[],has_template_tag:r}},this.handlePreCommit=()=>(this.setState({isConfirming:!1}),{rating:this.props.mode===Pi.VIEW_MODE||this.props.mode===Pi.EDIT_MODE?this.props.ratings[this.state.editingRatingIndex]:this.props.rating,ratingData:this._editRatingUpdateModal?this._editRatingUpdateModal.getData():null,templateTags:this._editRatingUpdateModal?this._editRatingUpdateModal.getRatingTemplateTags():[]}),this.handleSubmitEditRating=async function(){const{rating:e,ratingData:i,templateTags:a}=t.handlePreCommit();if(i&&i.comment&&"string"==typeof i.comment&&(i.comment=i.comment.trim()),t.setState({isLoading:!0}),(await t.props.editRating(t.props.shopId,t.props.orderId,e.cmtid,i?[i]:[],2)).error||t.props.mode!==Pi.VIEW_MODE&&t.props.mode!==Pi.EDIT_MODE)t.closeRating();else{var n,s,r;t._itemToMediasMap={};const{editingRatingIndex:o,ratings:l}=t.state,c=[...l],d=e.author_pic||e.user_pic||e.author_portrait||"";let m=e.author_name||e.username||e.author_username||"";t.props.mode===Pi.EDIT_MODE&&(m=t.props.accountInfo.username);const h=i?i.anonymous:e.anonymous;c[o]=Fi({},e,t.getComments(i,a),{detailed_rating:{product_quality:null==i||null==(n=i.detailed_rating)?void 0:n.product_quality,seller_service:(null==i||null==(s=i.detailed_rating)?void 0:s.seller_service)||t.detailed_rating.seller_service,delivery_service:(null==i||null==(r=i.detailed_rating)?void 0:r.delivery_service)||t.detailed_rating.delivery_service},images:i?i.photos:[],videos:i?i.videos:[],editable:u.Sc.EDITED_AND_CANT_EDIT,tags:t.getTagsByIds(i?i.tagids:[]),anonymous:h,author_username:h?re(m):m,author_portrait:d}),t.setState({ratings:c}),await t.reloadOrderAfterRating(),t.setState({isLoading:!1}),t.backToView(),"myRating"===t.props.fromSource&&t.props.rateSuccessCallback&&t.props.mode===Pi.EDIT_MODE&&(t.props.rateSuccessCallback(c[o]),t.closeRating())}},this.getTagsByIds=e=>{let t=[];const i=this.props.ratingMeta?this.props.ratingMeta.tags:[];return i&&i.forEach((i=>{t=t.concat(i.tags.filter((t=>-1!==e.indexOf(t.tag_id))))})),t},this.handleSubmitRating=async function(){if(!t._editRatingNewModal)return;const{seller_service:e,delivery_service:i,rate_items_data:n}=t._editRatingNewModal.getData();var s;if(t.state.scrollBottom)return null==(s=t._editRatingNewModal)||s.scrollToBottom(),void t.setState({showWaringPop:!0});n instanceof Array&&n.forEach((e=>{"string"==typeof e.comment&&(e.comment=e.comment.trim())})),t.setState({isLoading:!0});const r=await t.props.rateProduct(t.props.shopId,t.props.orderId,t.props.useDetect,n,t.props.defaultRatingMediaQualityCheck,e,i,2);if(r.error)if(r.error===Ui.Z.EXIST)t.setState({isLoading:!1}),t.closeRating(),t.context.showPopup(a.createElement(k.OK,{text:ji("pr_alert_please_reload_view_rating_page")}),!0,null,null,!0);else{if(18900004===r.error)return window.alert("The template tags are invalid"),void t.closeRating();t.setState({isLoading:!1})}else{if(r.response.data.extra_info&&!1===r.response.data.extra_info.coin_succ)t.setState({isLoading:!1}),t.context.showPopup(a.createElement(k.a$,{message:ji("msg_coins_error"),showCancel:!1,confirmText:"OK"}),!0,null,null,!0);else{t._itemToMediasMap={};const e=r.response.data.coins_earned;await t.reloadOrderAfterRating(),t.setState({isLoading:!1}),t.closeRating();const i=e>0;t.context.showPopup(i?a.createElement(Ti,{coinsAwarded:e}):a.createElement(Di,null),i,null,null,!0)}"myRating"===t.props.fromSource&&t.props.rateSuccessCallback&&t.props.rateSuccessCallback()}},this.reloadOrderAfterRating=async function(){return await t.props.reloadOrderAfterRating(t.props.orderId,t.props.shopId),Promise.resolve()},this.checkSubmit=()=>{this.props.mode===Pi.VIEW_MODE?this.state.isShowMediaErr===Vi.EX_LOW||this.state.isShowMediaErr===Hi.EX_LOW?this.setState({isShowMediaErr:Vi.NORMAL,showDialogNow:!1}):this.state.isShowMediaErr!==Vi.LOW&&this.state.isShowMediaErr!==Hi.LOW||this.setState({isShowMediaErr:Vi.NORMAL,showDialogNow:!1},(()=>{this.state.editing?this.handleSubmitEditRating():this.closeRating()})):this.props.mode===Pi.RATE_MODE&&(this.state.isShowMediaErr===Vi.EX_LOW||this.state.isShowMediaErr===Hi.EX_LOW?this.setState({isShowMediaErr:Vi.NORMAL,showDialogNow:!1}):this.state.isShowMediaErr!==Vi.LOW&&this.state.isShowMediaErr!==Hi.LOW||this.setState({isShowMediaErr:Vi.NORMAL,showDialogNow:!1},(()=>{this.handleSubmitRating()})))},this.collectMediaCheck=(e,t)=>{this._itemToMediasMap[e]=t},this.collectAllMedia=e=>{this._allMediaCheck[e]=!0},this.cancelCollectMedia=e=>{const{defaultRatingCommentCheck:t}=this.props;delete this._allMediaCheck[e];const i=Object.keys(this._allMediaCheck).length,a=Object.keys(this._itemToMediasMap).filter((e=>-3===this._itemToMediasMap[e].type));0===i&&(!t||a.length<=0)&&this.loadingNow&&(this.waitCommentLoading||this.setState({isLoading:!1},(()=>{clearTimeout(this.timeoutCheck),this.loadingNow=!1,t?this.commentMediaCheckShowDialog():this.checkMediaSubmit()})))},this.clearTimeoutCheck=()=>{var e,t;this.props.mode===Pi.VIEW_MODE?null==(e=this._editRatingUpdateModal)||e.clearMediaTimeout():null==(t=this._editRatingNewModal)||t.clearMediaTimeout()},this.preCheck=async function(){Object.keys(t._allMediaCheck).length>0?(t.loadingNow=!0,t.setState({isLoading:!0},(()=>{t.timeoutCheck=setTimeout((()=>{t.setState({isLoading:!1},(()=>{t.loadingNow=!1,t._allMediaCheck={},t.clearTimeoutCheck(),t.checkMediaSubmit()}))}),t.state.mediaCheckWaitTime)}))):(t._allMediaCheck={},t.clearTimeoutCheck(),t.checkMediaSubmit())},this.commentMediaCheckShowDialog=()=>{this.getHeight();const{mode:e}=this.props,{isOrderValidationCheckPass:t}=this.state,i=Object.keys(this._itemToMediasMap),a=i.filter((e=>-2===this._itemToMediasMap[e].type)),n=i.filter((e=>-1===this._itemToMediasMap[e].type)),s=a.length>0?Vi.EX_LOW:n.length>0?Vi.LOW:Vi.NORMAL;this.commentQuality===Hi.EX_LOW?s===Vi.NORMAL?this.setState({isShowMediaErr:Hi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:ji("tips_comment_only_dialog_elow"),showDialogNow:!0}):this.setState({isShowMediaErr:Hi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:ji("tips_comment_media_check_dialog_exlow"),showDialogNow:!0}):this.commentQuality===Hi.LOW?e===Pi.VIEW_MODE?s===Vi.NORMAL||s===Vi.LOW?this.setState({isShowMediaErr:Hi.LOW,mediaCheckTitle:ji("title_check_submit"),mediaCheckMessage:ji("tips_comment_check_dialog_low"),showDialogNow:!0}):s===Vi.EX_LOW&&this.setState({isShowMediaErr:Vi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:ji("tips_comment_media_check_dialog_exlow"),showDialogNow:!0}):s===Vi.NORMAL?Object.values(this.getCoinItemList).filter((e=>!0===e)).length>0?this.setState({isShowMediaErr:Hi.LOW,mediaCheckTitle:ji("title_check_submit"),mediaCheckMessage:ji(t?"tips_comment_only_dialog_low":"tips_comment_content_edit_low"),showDialogNow:!0}):this.setState({cannotRedShow:!0},(()=>{this.handleSubmitRating()})):s===Vi.LOW?Object.values(this.getCoinItemList).filter((e=>!0===e)).length>0?this.setState({isShowMediaErr:Hi.LOW,mediaCheckTitle:ji("title_check_submit"),mediaCheckMessage:ji(t?"tips_comment_media_new_check_dialog_low":"tips_comment_media_check_dialog_exlow"),showDialogNow:!0}):this.setState({cannotRedShow:!0},(()=>{this.handleSubmitRating()})):s===Vi.EX_LOW&&this.setState({isShowMediaErr:Vi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:ji("tips_comment_media_check_dialog_exlow"),showDialogNow:!0}):this.checkMediaSubmitNew()},this.checkMediaSubmit=()=>{const e=Object.keys(this._itemToMediasMap),t=e.filter((e=>-2===this._itemToMediasMap[e].type)),i=e.filter((e=>-1===this._itemToMediasMap[e].type));t.length?t.length>1?this.setState({isShowMediaErr:Vi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:ji("msg_medias_quality_ex_more"),showDialogNow:!0}):this.setState({isShowMediaErr:Vi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:me(this._itemToMediasMap[t[0]]),showDialogNow:!0}):i.length?this.props.mode===Pi.VIEW_MODE?this.setState({isShowMediaErr:Vi.LOW,mediaCheckTitle:ji("pr_alert_submit_rating"),mediaCheckMessage:ji("msg_medias_quality_low_edit"),showDialogNow:!0}):Object.values(this.getCoinItemList).filter((e=>!0===e)).length>0?this.setState({isShowMediaErr:Vi.LOW,mediaCheckTitle:ji("title_check_submit"),mediaCheckMessage:ji("msg_medias_quality_low_more"),showDialogNow:!0}):this.setState({cannotRedShow:!0},(()=>{this.handleSubmitRating()})):this.setState({showDialogNow:!0},(()=>{if(this.props.mode===Pi.VIEW_MODE){if(!this.state.editing)return void this.closeRating();this.handleConfirmEditRating()}else this.props.mode===Pi.RATE_MODE&&this.handleSubmitRating()}))},this.checkMediaSubmitNew=()=>{const e=Object.keys(this._itemToMediasMap),t=e.filter((e=>-2===this._itemToMediasMap[e].type)),i=e.filter((e=>-1===this._itemToMediasMap[e].type));if(t.length>0){const e=[];Object.values(this._itemToMediasMap).forEach((t=>{const i=(null==t?void 0:t.collectObj)||{};-2===(null==t?void 0:t.type)&&Object.keys(i).forEach((t=>{null!=i&&i[t]&&e.push(t)}))})),this.setState({isShowMediaErr:Vi.EX_LOW,mediaCheckTitle:"",mediaCheckMessage:ue(e,-2,this.state.isOrderValidationCheckPass),showDialogNow:!0})}else if(i.length)if(this.props.mode===Pi.VIEW_MODE)this.setState({isShowMediaErr:Vi.LOW,mediaCheckTitle:ji("title_check_submit"),mediaCheckMessage:ji("tips_comment_check_dialog_low"),showDialogNow:!0});else if(Object.values(this.getCoinItemList).filter((e=>!0===e)).length>0){const e=[];Object.values(this._itemToMediasMap).forEach((t=>{const i=(null==t?void 0:t.collectObj)||{};-1===(null==t?void 0:t.type)&&Object.keys(i).forEach((t=>{null!=i&&i[t]&&e.push(t)}))})),this.setState({isShowMediaErr:Vi.LOW,mediaCheckTitle:ji("title_check_submit"),mediaCheckMessage:ue(e,-1,this.state.isOrderValidationCheckPass),showDialogNow:!0})}else this.setState({cannotRedShow:!0},(()=>{this.handleSubmitRating()}));else this.setState({isShowMediaErr:Vi.NORMAL,showDialogNow:!0},(()=>{if(this.props.mode===Pi.VIEW_MODE){if(!this.state.editing)return void this.closeRating();this.handleConfirmEditRating()}else this.props.mode===Pi.RATE_MODE&&this.handleSubmitRating()}))},this.deleteCommentCheckItemId=e=>{this.commentCheckMap[Number(e)]&&delete this.commentCheckMap[Number(e)]},this.getHeight=()=>{const e=[],t=document.getElementsByClassName("rating-modal-handler__container");for(let s=0;s<t.length;s++)e.push(t[s].clientHeight);const i=document.getElementsByClassName("shopee-popup-form__main"),a=this.getFirstLocation();let n=0;a&&a>1&&e.slice(0,a-1).forEach((e=>{n+=e})),i[0].scrollTo({top:this.showCoinBanner?n+this.showCoinHeight:n,behavior:"smooth"})},this.getFirstLocation=()=>{let e=0;return Object.keys(this._itemToMediasMap).forEach((t=>{var i,a;-2!==this._itemToMediasMap[t].type&&-1!==this._itemToMediasMap[t].type||(e=0===e?(null==(i=this.itemIdLocationMap)?void 0:i[t])||0:Math.min(e,(null==(a=this.itemIdLocationMap)?void 0:a[t])||1))})),Object.keys(this.commentCheckMap).forEach((t=>{var i,a,n,s,r,o;(null==(i=this.commentCheckMap)||null==(a=i[Number(t)])?void 0:a.total)!==Hi.EX_LOW&&(null==(n=this.commentCheckMap)||null==(s=n[Number(t)])?void 0:s.total)!==Hi.LOW||(e=0===e?(null==(r=this.itemIdLocationMap)?void 0:r[t])||0:Math.min(e,(null==(o=this.itemIdLocationMap)?void 0:o[t])||1))})),e},this.isShowCoinBanner=(e,t)=>{this.showCoinBanner=e,this.showCoinHeight=t},this.collectLocationMap=(e,t)=>{this.itemIdLocationMap[e]=t},this.commentCheckNoWait=()=>{var e,t;const{orderId:i,mode:a}=this.props,n=[];let s,r=[];a===Pi.VIEW_MODE?this._editRatingUpdateModal&&null!==this._editRatingUpdateModal.getData()?r.push(this._editRatingUpdateModal.getData()):r=[]:r=this._editRatingNewModal&&(null==(e=this._editRatingNewModal)||null==(t=e.getData())?void 0:t.rate_items_data)||[],r.length>0&&r.forEach((e=>{(e.comment||Object.values(e.template_tag_comments).length>0)&&(s={itemid:e.itemid,comments:[]},e.comment&&jt(e.comment)&&s.comments.push(jt(e.comment)),s.comments=s.comments.concat(Object.values(e.template_tag_comments).filter((e=>""!==e))),s.comments.length>0&&n.push(s))}));const o=Object.keys(this._allMediaCheck).length,l=Object.keys(this._itemToMediasMap).filter((e=>-3===this._itemToMediasMap[e].type));if(n.length>0||l.length>0){const e={data:n,orderid:i};this.loadingNow=!0,this.waitCommentLoading=!0,this.setState({isLoading:!0},(()=>{this.timeoutCheck=setTimeout((()=>{this.setState({isLoading:!1},(()=>{this.loadingNow=!1,this._allMediaCheck={},this.clearTimeoutCheck(),this.waitCommentLoading&&(this.waitCommentLoading=!1,this.commentCheckMap={},this.commentQuality=Hi.NORMAL),this.commentMediaCheckShowDialog()}))}),this.state.mediaCheckWaitTime)})),he(e).then((e=>{var t,i;if(this.loadingNow&&this.waitCommentLoading)if(Object.keys(this._allMediaCheck).length>0||l.length>0)if(this.waitCommentLoading=!1,0===(null==e||null==(t=e.response)?void 0:t.error)){var a,n;const t={};let i=0,s=0;null==e||null==(a=e.response)||null==(n=a.data)||n.forEach((e=>{t[Number(e.itemid)]=e.score})),this.commentCheckMap=t,Object.keys(this.commentCheckMap).forEach((e=>{var t,a,n,r;(null==(t=this.commentCheckMap)||null==(a=t[Number(e)])?void 0:a.total)===Hi.EX_LOW?i++:(null==(n=this.commentCheckMap)||null==(r=n[Number(e)])?void 0:r.total)===Hi.LOW&&s++})),this.commentQuality=i>0?Hi.EX_LOW:s>0?Hi.LOW:Hi.NORMAL}else this.commentQuality=Hi.NORMAL,this.commentCheckMap={};else if(this.timeoutCheck&&clearTimeout(this.timeoutCheck),this.waitCommentLoading=!1,0===(null==e||null==(i=e.response)?void 0:i.error)){var s,r;const t={};let i=0,a=0;null==e||null==(s=e.response)||null==(r=s.data)||r.forEach((e=>{t[Number(e.itemid)]=e.score})),this.commentCheckMap=t,Object.keys(this.commentCheckMap).forEach((e=>{var t,n,s,r;(null==(t=this.commentCheckMap)||null==(n=t[Number(e)])?void 0:n.total)===Hi.EX_LOW?i++:(null==(s=this.commentCheckMap)||null==(r=s[Number(e)])?void 0:r.total)===Hi.LOW&&a++})),this.commentQuality=i>0?Hi.EX_LOW:a>0?Hi.LOW:Hi.NORMAL,this.setState({isLoading:!1},(()=>{this.loadingNow=!1,this.clearTimeoutCheck(),this.commentMediaCheckShowDialog()}))}else this.commentQuality=Hi.NORMAL,this.commentCheckMap={},this.setState({isLoading:!1},(()=>{this.clearTimeoutCheck(),this.commentMediaCheckShowDialog()}))})).catch((e=>{this.loadingNow&&this.waitCommentLoading&&(Object.keys(this._allMediaCheck).length>0||l.length>0?(this.waitCommentLoading=!1,this.commentCheckMap={},this.commentQuality=Hi.NORMAL):(this.timeoutCheck&&clearTimeout(this.timeoutCheck),this.waitCommentLoading=!1,this.commentCheckMap={},this.commentQuality=Hi.NORMAL,this.loadingNow=!1,this.setState({isLoading:!1},(()=>{this.clearTimeoutCheck(),this.commentMediaCheckShowDialog()}))))}))}else this.commentCheckMap={},this.commentQuality=Hi.NORMAL,o>0||l.length>0?(this.loadingNow=!0,this.setState({isLoading:!0},(()=>{this.timeoutCheck=setTimeout((()=>{this.loadingNow=!1,this._allMediaCheck={},this.setState({isLoading:!1},(()=>{this.clearTimeoutCheck(),this.commentMediaCheckShowDialog()}))}),this.state.mediaCheckWaitTime)}))):(this.clearTimeoutCheck(),this.commentMediaCheckShowDialog())},this.commentCheck=async function(){var e;const{orderId:i}=t.props,a=t._editRatingNewModal?null==(e=t._editRatingNewModal.getData())?void 0:e.rate_items_data:[],n=[];let s;if(a.length>0&&a.forEach((e=>{(e.comment||Object.values(e.template_tag_comments).length>0)&&(s={order_id:i,item_id:e.itemid,comments:[]},e.comment&&s.comments.push(e.comment),s.comments=s.comments.concat(Object.values(e.template_tag_comments).filter((e=>""!==e))),n.push(s))})),n.length>0){const e=await he({data:n});if(null!=e&&e.error||null==e||!e.response)t.commentQuality=Hi.NORMAL,t.commentCheckMap={};else{const{error:i}=null==e?void 0:e.response;if(0===i){var r,o,l;const i={};let a=0,n=0;(null==e||null==(r=e.response)?void 0:r.data)&&(null==e||null==(o=e.response)||null==(l=o.data)||l.forEach((e=>{i[Number(e.item_id)]=e.score}))),t.commentCheckMap=i,Object.keys(t.commentCheckMap).forEach((e=>{t.commentCheckMap[Number(e)].total===Hi.EX_LOW?a++:Hi.LOW&&n++})),t.commentQuality=a>0?Hi.EX_LOW:n>0?Hi.LOW:Hi.NORMAL}else t.commentCheckMap={},t.commentQuality=Hi.NORMAL}}else t.commentCheckMap={},t.commentQuality=Hi.NORMAL},this.handlePrimaryButtonClicked=()=>{switch(this.props.mode){case Pi.VIEW_MODE:if(this.props.defaultRatingCommentCheck)this.commentCheckNoWait();else if(this.props.defaultRatingMediaQualityCheck)this.preCheck();else{if(!this.state.editing)return void this.closeRating();this.handleConfirmEditRating()}return;case Pi.RATE_MODE:return void(this.props.defaultRatingCommentCheck?this.commentCheckNoWait():this.props.defaultRatingMediaQualityCheck?this.preCheck():this.handleSubmitRating());case Pi.EDIT_MODE:return void this.handleConfirmEditRating();default:this.closeRating()}},this.closeRating=()=>{this.clearTimeoutCheck(),this.context.dismissPopup()},this.getReadyState=()=>{switch(this.props.mode){case Pi.RATE_MODE:return!!this._editRatingNewModal&&this._editRatingNewModal.isReady();case Pi.VIEW_MODE:return!this.state.editing||!this._editRatingUpdateModal||this._editRatingUpdateModal.isReady();case Pi.EDIT_MODE:return!this._editRatingUpdateModal||this._editRatingUpdateModal.isReady();default:return!0}},this.scrollToTopContentContainer=()=>{this._contentContainer&&(this._contentContainer.scrollTop=0)};const i=this.formattedRatings(e.ratings);this.state={editing:!1,editingRatingIndex:0,ratings:i||[],isLoading:!1,isConfirming:!1,items:[],getEditOrderDetailSucess:!0,isRatingLoading:!0,isShowMediaErr:0,isShowCancel:!0,mediaCheckTitle:"",mediaCheckMessage:"",mediaCheckWaitTime:3e3,categoryCoinList:void 0,limitValidationMap:void 0,isOrderValidationCheckPass:!0,showDialogNow:!1,cannotRedShow:!1,scrollBottom:!0,showWaringPop:!1,warningState:""}}getCategroyCoin(){const{orderId:e}=this.props;$i(`/api/v4/order/get_rating_coin_reward_rule_list${(0,d.Wc)({order_id:e,apply_coin_limits_validate:!0})}`).then((({response:e={}})=>{const{error:t,coin_reward_rule_list:i,coin_limits_validate_result:a}=e;if(!t){if(i&&i.length>0){const e={};i.forEach((t=>{e[t.item_id]=t.coin_reward_rule})),this.setState({categoryCoinList:e})}if(a&&a.length>0){const e={};a.forEach((({item_id:t,passed:i,limits_info:a})=>{e[t]={passed:i,limits_info:a}}));const t=Object.keys(e).some((t=>e[t].passed));this.setState({limitValidationMap:e,isOrderValidationCheckPass:t})}}}))}componentDidMount(){this.props.injectAsyncReducer&&this.props.injectAsyncReducer({rating:u.I6}),this.props.getRatingMeta(),this.getTime(),this.getCategroyCoin(),this.props.mode===Pi.RATE_MODE&&this.getRateEditOrderDetail()}getRateEditOrderDetail(){this.setState({isRatingLoading:!0});const{orderId:e,shopId:t}=this.props;$i(`/api/v2/order/get_rate_order_detail${(0,d.Wc)({shopid:t,orderid:e})}`).then((e=>{const t=(0,c.Z)(e,["response","data","items"],[]);this.setState({items:t,isRatingLoading:!1,getEditOrderDetailSucess:t.length>0})})).catch((()=>{this.setState({isRatingLoading:!1,getEditOrderDetailSucess:!1})}))}renderViewBuyerRating(){return a.createElement(Me,{rating:this.props.rating})}renderEditing(){const e=this.state.ratings[this.state.editingRatingIndex],t=this.props.accountInfo.username;return a.createElement(Oi,{rating:e,username:t||"",defaultRatingAnonymous:e.anonymous,defaultVideoReview:this.props.defaultVideoReview,enableRatingCreationUIRevamp:this.props.enableRatingCreationUIRevamp,defaultRatingReviewTemplate:this.props.defaultRatingReviewTemplate,orderId:this.props.orderId,userId:this.props.userId,ref:this.setEditRatingUpdateModal,forceFormUpdate:()=>this.forceUpdate(),ratingMeta:this.props.ratingMeta,collectMediaCheck:this.collectMediaCheck,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck,collectAllMedia:this.collectAllMedia,cancelCollectMedia:this.cancelCollectMedia,commentCheckMap:this.commentCheckMap,deleteCommentCheckItemId:this.deleteCommentCheckItemId,defaultRatingCommentCheck:this.props.defaultRatingCommentCheck,showDialogNow:this.state.showDialogNow,updateSellerService:e=>this.updateDetailedRating(e)})}renderRating(){const e=this.props.accountInfo.username;return a.createElement(ki,{items:this.state.items||Xi,shopId:this.props.shopId,orderId:this.props.orderId,userId:this.props.userId,username:e||"",defaultRatingAnonymous:this.props.defaultRatingAnonymous,defaultVideoReview:this.props.defaultVideoReview,enableRatingCreationUIRevamp:this.props.enableRatingCreationUIRevamp,defaultRatingReviewTemplate:this.props.defaultRatingReviewTemplate,ref:this.setEditRatingNewModal,forceFormUpdate:()=>this.forceUpdate(),ratingMeta:this.props.ratingMeta,collectMediaCheck:this.collectMediaCheck,defaultRatingMediaQualityCheck:this.props.defaultRatingMediaQualityCheck,collectAllMedia:this.collectAllMedia,cancelCollectMedia:this.cancelCollectMedia,categoryCoinList:this.state.categoryCoinList,limitValidationMap:this.state.limitValidationMap,commentCheckMap:this.commentCheckMap,deleteCommentCheckItemId:this.deleteCommentCheckItemId,defaultRatingCommentCheck:this.props.defaultRatingCommentCheck,isShowCoinBanner:this.isShowCoinBanner,collectLocationMap:this.collectLocationMap,showDialogNow:this.state.showDialogNow,collectCoinItem:this.collectCoinItem,cannotRedShow:this.state.cannotRedShow,updateSellerService:e=>this.updateDetailedRating(e)})}renderNewLoading(){return a.createElement(y.Z,{hideOverlay:!0,show:!0})}renderError(){return a.createElement("div",{className:Ei},a.createElement("span",{className:fi},ji("rating_loading_failed")),a.createElement("div",{className:yi,onClick:this.getRateEditOrderDetail.bind(this)},ji("rating_btn_name_retry")))}render(){const e=this.props.mode===Pi.EDIT_MODE||this.props.mode===Pi.RATE_MODE||this.state.editing,t=this.getReadyState();return a.createElement(f.Z,{title:this.getTitle(),textSubmit:ji("pr_order_purchase_label_submit"),textOk:ji("pr_order_purchase_label_ok"),textSubmitting:t?null:ji("label_submit"),cancelButtonText:ji("pr_order_purchase_label_cancel"),isSubmitting:!this.getReadyState(),showSubmitButton:this.props.defaultRatingShowSubmit&&e,showCancelButton:e,showOKButton:!e,onSubmit:this.handlePrimaryButtonClicked,onCancel:this.closeRating,onOK:this.closeRating,formExtraClassNames:"_6NsQFJ",onBackButtonClick:this.state.editing?this.backToView:void 0},this.state.isLoading&&a.createElement(Bi,null),this.state.showWaringPop&&a.createElement(I,{goRating:this.handleGoRating,warningState:this.state.warningState}),this.state.isConfirming&&a.createElement(b,{onSubmit:this.handleSubmitEditRating,onCancel:this.handleConfirmClose}),(this.state.isShowMediaErr===Vi.EX_LOW||this.state.isShowMediaErr===Vi.LOW||this.state.isShowMediaErr===Hi.EX_LOW||this.state.isShowMediaErr===Hi.LOW)&&a.createElement(R,{message:this.state.mediaCheckMessage,title:this.state.mediaCheckTitle,onSubmit:this.checkSubmit,submitText:this.state.isShowMediaErr===Vi.EX_LOW||this.state.isShowMediaErr===Hi.EX_LOW?ji("btn_back_to_edit"):ji("btn_submit_check"),showCancel:this.state.isShowMediaErr!==Vi.EX_LOW&&this.state.isShowMediaErr!==Hi.EX_LOW,cancelText:this.state.isShowMediaErr===Vi.EX_LOW||this.state.isShowMediaErr===Hi.EX_LOW?void 0:ji("btn_back_to_edit"),onCancel:()=>{this.setState({isShowMediaErr:Vi.NORMAL,showDialogNow:!1})}}),this.getModalBody())}}Qi.contextTypes={dismissPopup:r().func,showPopup:r().func};const zi=(0,l.compose)(Wi.Pf,(0,E.u)({fetchOnMount:!0}),(0,o.connect)((e=>({ratingMeta:e.rating&&e.rating.ratingMeta?e.rating.ratingMeta:null,defaultRatingAnonymous:(0,_.Au)(e.featureToggles,p.o0p,!1),defaultVideoReview:(0,_.Au)(e.featureToggles,p.ZXS,!1),defaultRatingReviewTemplate:(0,_.Au)(e.featureToggles,x.aJ,!1),defaultRatingMediaQualityCheck:(0,_.Au)(e.featureToggles,x.wc,!1),defaultRatingShowEdit:g(e.featureToggles,x.h4,!0),defaultRatingShowSubmit:g(e.featureToggles,x.te,!0),useDetect:(0,_.Au)(e.featureToggles,x.wr,!1),defaultRatingCommentCheck:(0,_.Au)(e.featureToggles,x.ge,!1),enableRatingCreationUIRevamp:(0,_.Au)(e.featureToggles,x.SQ,!0),isServiceEvaluationCanEmpty:(0,_.Au)(e.featureToggles,x.e5,!1)})),{editRating:u.QH,rateProduct:u.H1,getRatingMeta:u.dR,reloadOrderAfterRating:u.Iv}),m.withInjectReducer)((0,x.wl)(Qi)),{t:Yi}=h.I18n,{fetchInfo:Ki}=h.FetchUtils,{t:Ji}=h.I18n,{fetchInfo:ea}=h.FetchUtils;function ta({dismissPopup:e,commentId:t,shopId:i,isSeller:s,orderId:r,userId:o,fromSource:l,callback:c}){const[m,h]=(0,a.useState)(null);return(0,a.useEffect)((()=>{(async()=>{try{const e=await ea(`/api/v2/item/get_rating${(0,d.Wc)({cmtid:t,shopid:i,is_seller:Number(s)})}`),{response:a,error:n}=e;n||a&&a.error?h({data:null,error:1}):h({data:null==a?void 0:a.data,error:0})}catch(e){h({data:null,error:1})}})()}),[t,i,s]),m?null!=m&&m.error?n().createElement(f.Z,{textSubmit:Ji("pr_order_purchase_label_ok"),onSubmit:()=>{e()},showCancelButton:!1},"Get Data Failed"):n().createElement(zi,{mode:Pi.EDIT_MODE,ratings:[null==m?void 0:m.data],userId:o,shopId:i,orderId:r,fromSource:l,rateSuccessCallback:c}):null}function ia({orderId:e,userId:t,shopId:i,showPopup:n,fromSource:s,callback:r}){n(a.createElement(zi,{mode:Pi.RATE_MODE,orderId:e,shopId:i,userId:t,fromSource:s,rateSuccessCallback:r}))}function aa({commentId:e,orderId:t,userId:i,shopId:n,isSeller:s,showPopup:r,dismissPopup:o,fromSource:l,callback:c}){r(a.createElement(ta,{dismissPopup:o,commentId:e,shopId:n,isSeller:s,orderId:t,userId:i,fromSource:l,callback:c}))}},5958:(e,t,i)=>{"use strict";i.d(t,{Sc:()=>L,QH:()=>Y,ny:()=>Q,_L:()=>X,Sz:()=>oe,aT:()=>re,U6:()=>ie,YQ:()=>ge,K6:()=>_e,kK:()=>he,EM:()=>pe,N7:()=>ue,dR:()=>K,y9:()=>q,Dj:()=>ce,nt:()=>J,H1:()=>z,I6:()=>W,Iv:()=>ne,YA:()=>ae,IY:()=>te,$O:()=>de,kB:()=>ee,_X:()=>le,wu:()=>se});var a=i(4941),n=i(9231);const s=(0,n.n)("EDIT_RATING"),r=(0,n.n)("FETCH_ONE_ITEM_RATING"),o=(0,n.n)("FETCH_ITEM_RATING"),l=(0,n.n)("FETCH_ONE_SHOP_RATING"),c=(0,n.n)("FETCH_SHOP_RATING"),d=(0,n.n)("FETCH_ONE_BUYER_RATING"),m=(0,n.n)("FETCH_BUYER_RATING"),h=(0,n.n)("GET_RATING_META"),u=(0,n.n)("RATE_PRODUCT"),p=((0,n.n)("UPLOAD_IMAGE"),(0,n.n)("REPLY_RATING"),(0,n.n)("LIKE_RATING")),_=(0,n.n)("UNLIKE_RATING"),g=(0,n.n)("REPORT_RATING"),E=(0,n.n)("FETCH_SHOP_RATING_SUMMARY"),f=(0,n.n)("REPLY_ITEM_RATING_V2"),y=(0,n.n)("REPLY_BUYER_RATING_V2"),C=(0,n.n)("CLEAN_RATING_CACHE"),v=(0,n.n)("FETCH_ORDER_ITEM_RATINGS"),w=(0,n.n)("FETCH_ORDER_BUYER_RATINGS"),R=(0,n.n)("LIKE_SHOP_RATING"),k=(0,n.n)("UNLIKE_SHOP_RATING"),M=(0,n.n)("FETCH_RATEABLE_LIST"),b=(0,n.n)("FETCH_MY_RATING_LIST"),S=(0,n.n)("UPDATE_RATEABLE_LIST"),I=(0,n.n)("UPDATE_MY_REVIEW");var O=i(6556);const L={CANT_EDIT:0,CAN_EDIT:1,EDITED_AND_CANT_EDIT:2},T=({shopId:e,itemId:t,flag:i,filter:a=0,type:n=0,tag:s=""})=>{const r={shop_id:e,item_id:t,flag:i,filter:a,type:n,tag:s};return(0,O.Wc)(r)},N=({shopId:e,filter:t=1,type:i=0})=>{const a={shop_id:e,filter:t,type:i};return(0,O.Wc)(a)},x=({userId:e,filter:t=1,type:i=0})=>{const a={user_id:e,filter:t,type:i};return(0,O.Wc)(a)},A=e=>(0,O.Wc)(e),D=e=>(0,O.Wc)(e);function q(e){return e.editable===L.CAN_EDIT}function B(){return B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(e[a]=i[a])}return e},B.apply(this,arguments)}const W=(0,a.Z)({[o.REQUESTED]:(e,t)=>{const{payload:i}=t,a=T(i.query);return B({},e,{queryLoadingState:B({},e.queryLoadingState,{[a]:!0})})},[o.SUCCESS]:(e,t)=>{const{query:{offset:i,limit:a},ratings:n,summary:s,hasMore:r,is_sip_item:o,show_local_review:l,downgradeSwitch:c,purchase_bar_abt:d}=t.payload,m=T(t.payload.query),h=e.itemRating[m],u=h?h.ratings:[],p=n.reduce(((e,t,a)=>(e[a+i]=t.cmtid,e)),[...u]),_=n.reduce(((e,t)=>(t.cmtid&&(e[t.cmtid]=t),e)),{});return B({},e,{itemRatingMap:B({},e.itemRatingMap,_),itemRating:B({},e.itemRating,{[m]:B({},e.itemRating[m],{ratings:p,hasMore:r,offset:i+a,downgradeSwitch:!!c})}),itemRatingSummary:s,is_sip_item:o,show_local_review:l,purchase_bar_abt:d,queryLoadingState:B({},e.queryLoadingState,{[m]:!1}),networkErrorCode:0})},[o.FAILED]:(e,t)=>{const{payload:i}=t,a=T(i.query);return B({},e,{queryLoadingState:B({},e.queryLoadingState,{[a]:!1}),networkErrorCode:i.error})},[C.REQUESTED]:e=>B({},e,{itemRatingMap:{},itemRating:{},shopRating:{},shopRatingMap:{},buyerRating:{},buyerRatingMap:{}}),[r.SUCCESS]:(e,t)=>{const{rating:i}=t.payload;return B({},e,{itemRatingMap:B({},e.itemRatingMap,{[i.cmtid]:i})})},[l.SUCCESS]:(e,t)=>{const{rating:i}=t.payload;return B({},e,{shopRatingMap:[i].reduce(((e,t)=>(t.cmtid&&(e[t.cmtid]=t),e)),e.shopRatingMap)})},[c.REQUESTED]:(e,t)=>{const{payload:i}=t,a=N(i.query);return B({},e,{shopRatingLoadingState:B({},e.shopRatingLoadingState,{[a]:!0}),networkErrorCode:0})},[c.SUCCESS]:(e,t)=>{const{query:{offset:i,limit:a},ratings:n,hasMore:s}=t.payload,r=N(t.payload.query),o=e.shopRating[r],l=o?o.ratings:[],c=n.reduce(((e,t,a)=>(e[a+i]=t.cmtid,e)),[...l]),d=n.reduce(((e,t)=>(t.cmtid&&(e[t.cmtid]=t),e)),{});return B({},e,{shopRatingMap:B({},e.shopRatingMap,d),shopRating:B({},e.shopRating,{[r]:B({},e.shopRating[r],{ratings:c,hasMore:s,offset:i+a})}),shopRatingLoadingState:B({},e.shopRatingLoadingState,{[r]:!1})})},[c.FAILED]:(e,t)=>{const{payload:i}=t,a=N(i.query);return B({},e,{shopRatingLoadingState:B({},e.shopRatingLoadingState,{[a]:!1}),networkErrorCode:t.payload.error})},[d.SUCCESS]:(e,t)=>{const{rating:i}=t.payload;return B({},e,{buyerRatingMap:[i].reduce(((e,t)=>(t.cmtid&&(e[t.cmtid]=t),e)),e.buyerRatingMap)})},[m.REQUESTED]:(e,t)=>{const{payload:i}=t,a=x(i.query);return B({},e,{buyerRatingLoadingState:B({},e.buyerRatingLoadingState,{[a]:!0}),networkErrorCode:0})},[m.SUCCESS]:(e,t)=>{const{query:{offset:i,limit:a},ratings:n,hasMore:s}=t.payload,r=x(t.payload.query),o=e.buyerRating[r],l=o?o.ratings:[],c=n.reduce(((e,t,a)=>(e[a+i]=t.cmtid,e)),[...l]),d=n.reduce(((e,t)=>(t.cmtid&&(e[t.cmtid]=t),e)),{});return B({},e,{buyerRatingMap:B({},e.buyerRatingMap,d),buyerRating:B({},e.buyerRating,{[r]:B({},e.buyerRating[r],{ratings:c,hasMore:s,offset:i+a})}),buyerRatingLoadingState:B({},e.buyerRatingLoadingState,{[r]:!1})})},[m.FAILED]:(e,t)=>{const{payload:i}=t,a=x(i.query);return B({},e,{buyerRatingLoadingState:B({},e.buyerRatingLoadingState,{[a]:!1}),networkErrorCode:i.error})},[h.SUCCESS]:(e,t)=>B({},e,{ratingMeta:t.payload}),[p.REQUESTED]:(e,t)=>{const i=e.itemRatingMap[t.ratingId];return B({},e,{itemRatingMap:B({},e.itemRatingMap,{[t.ratingId]:B({},i,{liked:!0,like_count:t.likeCount})})})},[p.FAILED]:(e,t)=>{const i=e.itemRatingMap[t.ratingId];return B({},e,{itemRatingMap:B({},e.itemRatingMap,{[t.ratingId]:B({},i,{liked:!1,like_count:t.likeCount})})})},[_.REQUESTED]:(e,t)=>{const i=e.itemRatingMap[t.ratingId];return B({},e,{itemRatingMap:B({},e.itemRatingMap,{[t.ratingId]:B({},i,{liked:!1,like_count:t.likeCount})})})},[_.FAILED]:(e,t)=>{const i=e.itemRatingMap[t.ratingId];return B({},e,{itemRatingMap:B({},e.itemRatingMap,{[t.ratingId]:B({},i,{liked:!1,like_count:t.likeCount})})})},[E.SUCCESS]:(e,t)=>B({},e,{shopRatingSummary:t.data}),[y.SUCCESS]:(e,t)=>B({},e,{ratingReplies:B({},e.ratingReplies,{[t.cmtId]:t.comment})}),[y.FAILED]:(e,t)=>B({},e,{ratingReplies:B({},e.ratingReplies,{[t.cmtId]:null})}),[f.SUCCESS]:(e,t)=>B({},e,{ratingReplies:B({},e.ratingReplies,{[t.cmtId]:t.comment})}),[f.FAILED]:(e,t)=>B({},e,{ratingReplies:B({},e.ratingReplies,{[t.cmtId]:null})}),[v.REQUESTED]:(e,t)=>{const i=A(t.payload.query);return B({},e,{orderItemRating:{[i]:{ratings:e.orderItemRating[i]&&e.orderItemRating[i].ratings||[],loading:!0,error:0}}})},[v.SUCCESS]:(e,t)=>{const i=A(t.payload.query);return B({},e,{itemRatingMap:t.payload.ratings.filter((e=>e.cmtid)).reduce(((e,t)=>(e[t.cmtid]=t,e)),e.itemRatingMap),orderItemRating:{[i]:{loading:!1,ratings:t.payload.ratings.filter((e=>e.cmtid)).map((e=>e.cmtid)),error:0,rateable:t.payload.rateable}}})},[v.FAILED]:(e,t)=>{const i=A(t.payload.query);return B({},e,{orderItemRating:{[i]:B({},e.orderItemRating[i],{loading:!1,error:t.payload.error})}})},[w.REQUESTED]:(e,t)=>{const i=D(t.payload.query);return B({},e,{orderBuyerRating:{[i]:{ratings:e.orderBuyerRating[i]&&e.orderBuyerRating[i].ratings||[],loading:!0,error:0}}})},[w.SUCCESS]:(e,t)=>{const i=D(t.payload.query);return B({},e,{buyerRatingMap:t.payload.ratings.filter((e=>e.cmtid)).reduce(((e,t)=>(e[t.cmtid]=t,e)),e.buyerRatingMap),orderBuyerRating:{[i]:{loading:!1,ratings:t.payload.ratings.filter((e=>e.cmtid)).map((e=>e.cmtid)),error:0}}})},[w.FAILED]:(e,t)=>{const i=D(t.payload.query);return B({},e,{orderBuyerRating:{[i]:B({},e.orderBuyerRating[i],{loading:!1,error:t.payload.error})}})},[R.REQUESTED]:(e,t)=>B({},e,{shopRatingMap:B({},e.shopRatingMap,{[t.ratingId]:B({},e.shopRatingMap[t.ratingId],{liked:!0,like_count:t.likeCount})})}),[R.FAILED]:(e,t)=>B({},e,{shopRatingMap:B({},e.shopRatingMap,{[t.ratingId]:B({},e.shopRatingMap[t.ratingId],{liked:!1,like_count:t.likeCount})})}),[k.REQUESTED]:(e,t)=>B({},e,{shopRatingMap:B({},e.shopRatingMap,{[t.ratingId]:B({},e.shopRatingMap[t.ratingId],{liked:!1,like_count:t.likeCount})})}),[k.FAILED]:(e,t)=>B({},e,{shopRatingMap:B({},e.shopRatingMap,{[t.ratingId]:B({},e.shopRatingMap[t.ratingId],{liked:!1,like_count:t.likeCount})})}),[M.REQUESTED]:(e,t)=>{const i=`${t.payload.query.userId}`,a=!!e.rateableListMap[i];return B({},e,{rateableListMap:B({},e.rateableListMap,{[i]:a?B({},e.rateableListMap[i],{loading:!0}):{is_end:!1,rate_list:[],offset:0,loading:!0,errorCode:0,preOffset:-1}})})},[M.SUCCESS]:(e,t)=>{const{userId:i,offset:a}=t.payload.query,n=`${i}`,s=e.rateableListMap[n].rate_list,r=e.rateableListMap[n].preOffset,{is_end:o=!1,rate_list:l=[],cursor:c=0}=t.payload.data||{},d=0===a?[...l||[]]:r!==a?[...s,...l||[]]:s;return B({},e,{rateableListMap:B({},e.rateableListMap,{[n]:B({},e.rateableListMap[n],{rate_list:d,is_end:o,offset:c,loading:!1,preOffset:a,errorCode:0})})})},[M.FAILED]:(e,t)=>{const{userId:i}=t.payload.query||{},a=`${i}`;return B({},e,{rateableListMap:B({},e.rateableListMap,{[a]:B({},e.rateableListMap[a],{loading:!1,errorCode:t.payload.error})})})},[b.REQUESTED]:(e,t)=>{const{userId:i}=t.payload.query,a=!!e.myRatingListMap[i];return B({},e,{myRatingListMap:B({},e.myRatingListMap,{[i]:a?B({},e.myRatingListMap[i],{loading:!0}):{is_end:!1,ratingList:[],ratingListMap:{},offset:0,loading:!0,errorCode:0}})})},[b.SUCCESS]:(e,t)=>{const{userId:i,offset:a,limit:n}=t.payload.query,s=e.myRatingListMap[i].ratingList,{is_end:r,rate_list:o}=t.payload.data||{},l=(o||[]).reduce(((e,t,i)=>(e[i+a]=t.cmtid,e)),0===a?[]:[...s]),c=(o||[]).reduce(((e,t)=>(t.cmtid&&(e[t.cmtid]=t),e)),{});return B({},e,{myRatingListMap:B({},e.myRatingListMap,{[i]:B({},e.myRatingListMap[i],{ratingList:l,ratingListMap:B({},e.myRatingListMap[i].ratingListMap,c),is_end:r,offset:a+n,loading:!1,errorCode:0})})})},[b.FAILED]:(e,t)=>{const{userId:i}=t.payload.query;return B({},e,{myRatingListMap:B({},e.myRatingListMap,{[i]:B({},e.myRatingListMap[i],{loading:!1,errorCode:t.payload.error})})})},[S.SUCCESS]:(e,t)=>{var i;const{orderId:a,userId:n}=t,s=(null==(i=e.rateableListMap[n])?void 0:i.rate_list)||[],r=s.findIndex((e=>e.order_id===a));if(r>=0){const t=[...s];return t.splice(r,1),B({},e,{rateableListMap:B({},e.rateableListMap,{[n]:B({},e.rateableListMap[n],{rate_list:t})})})}return e},[I.SUCCESS]:(e,t)=>{const{cmtid:i,updateData:a,userId:n}=t.data;return B({},e,{myRatingListMap:B({},e.myRatingListMap,{[n]:B({},e.myRatingListMap[n],{ratingListMap:B({},e.myRatingListMap[n].ratingListMap,{[i]:B({},e.myRatingListMap[n].ratingListMap[i],a)})})})})}},{shopRating:{},shopRatingMap:{},buyerRating:{},buyerRatingMap:{},itemRating:{},itemRatingMap:{},orderItemRating:{},orderBuyerRating:{},ratingReplies:{},ratingText:{},queryLoadingState:{},shopRatingLoadingState:{},buyerRatingLoadingState:{},networkErrorCode:0,ratingMeta:null,rateableListMap:{},myRatingListMap:{}});var U=i(2179),F=i(4674),$=i(6704);const{fetchInfo:j,formPost:P,jsonPost:V}=$.FetchUtils;function H(e,t,i){return V(Z,{cmtid:e,shopid:t,itemid:i,like:!0})}function G(e,t,i){return V(Z,{cmtid:e,shopid:t,itemid:i,like:!1})}const Z="/api/v2/like_item_rating";function X(e){return async(t,a)=>await(0,U.ZP)({apiCall:()=>(({shopId:e,itemId:t,type:a,filter:n,flag:s,limit:r,offset:o,tag:l})=>{const c="uat"===i.g.__ENV__||"test"===i.g.__ENV__?"v4":"v2";return j(`/api/${c}/item/get_ratings${(0,O.Wc)({shopid:e,itemid:t,type:a,filter:n,flag:s,limit:r,offset:o,tag_filter:l})}`)})(e),actions:[{type:o.REQUESTED,payload:()=>({query:e})},{type:o.SUCCESS,payload:(t,i,a)=>{var n;const s=a&&a.data?a.data.ratings?a.data.ratings:a.data.items?a.data.items:[]:[],r=a.data&&a.data.item_rating_summary,o=a.data&&a.data.is_sip_item,l=a.data&&a.data.show_local_review,c=!!a.data&&!!a.data.downgrade_switch;return{query:e,ratings:s,summary:r,is_sip_item:o,show_local_review:l,hasMore:s.length>=e.limit,downgradeSwitch:c,purchase_bar_abt:null==a||null==(n=a.data)?void 0:n.purchase_bar_abt}}},{type:o.FAILED,payload:(t,i,a)=>({query:e,error:a.error})}]},t,a)}function Q(e){return async(t,i)=>{await(0,U.ZP)({apiCall:()=>(({shopId:e,userId:t,offset:i,limit:a,filter:n,type:s})=>j(`/api/v2/buyer/get_ratings${(0,O.Wc)({shopid:e,userid:t,offset:i,limit:a,filter:n,type:s})}`))(e),actions:[{type:m.REQUESTED,payload:()=>({query:e})},{type:m.SUCCESS,payload:(t,i,a)=>{const n=a.data&&a.data.items?a.data.items:[];return{query:e,ratings:n,hasMore:n.length>=e.limit}}},{type:m.FAILED,payload:(t,i,a)=>({query:e,error:a.error})}]},t,i)}}function z(e,t,i,a,n=!1,s,r,o){return async(l,c)=>await(0,U.ZP)({apiCall:()=>function(e){return V("/api/v2/item/add_rating",e)}({shopid:e,orderid:t,objectid:i?1:0,seller_service:s,delivery_service:r,rate_items_data:a,is_media_gray_user:n,apply_coin_limits_validate:!0,api_version:o}),actions:[{type:u.REQUESTED},{type:u.SUCCESS,payload:(e,i,n)=>({orderId:t,data:a,seller_service:s,delivery_service:r,res:n})},{type:u.FAILED,payload:(e,i,n)=>({orderId:t,data:a,seller_service:s,delivery_service:r,error:n.error})}]},l,c)}function Y(e,t,i,a,n){return async(r,o)=>{const l={orderid:t,shopid:e,cmtid:i,rate_items_data:a,api_version:n};return await(0,U.ZP)({apiCall:()=>function(e){return V("/api/v2/item/edit_rating",e)}(l),actions:[{type:s.REQUESTED},{type:s.SUCCESS,payload:()=>({requestData:l})},{type:s.FAILED,payload:(e,t,a)=>({commentId:i,error:a.error})}]},r,o)}}function K(){return async(e,t)=>{await(0,U.ZP)({apiCall:()=>j("/api/v2/item/get_rating_meta"),actions:[{type:h.REQUESTED},{type:h.SUCCESS,payload:(e,t,i)=>i.data},{type:h.FAILED,payload:(e,t,i)=>({error:i.error})}]},e,t)}}function J(e,t,i,a){return async s=>{s((0,n.a)(p.REQUESTED,{ratingId:e,likeCount:a+1}));const r=await H(e,t,i);return r.error&&s((0,n.a)(p.FAILED,{ratingId:e,likeCount:a})),r}}function ee(e,t,i,a){return async s=>{const r=a>0?a-1:0;s((0,n.a)(_.REQUESTED,{ratingId:e,likeCount:r}));const o=await G(e,t,i);return o.error&&s((0,n.a)(_.FAILED,{ratingId:e,likeCount:a})),o}}function te(e,t,i,a){return async s=>{s((0,n.a)(g.REQUESTED,{ratingId:e}));const r=await function(e,t,i,a){return V("/api/v2/report_item_rating",{cmtid:e,shopid:t,itemid:i,reason:a})}(e,t,i,a);return r.error&&s((0,n.a)(g.FAILED,{ratingId:e})),r}}function ie(e){return async t=>{t((0,n.a)(E.REQUESTED,{userId:e}));const{error:i,response:a}=await(e=>j(`/api/v2/user/get_rating_summary${(0,O.Wc)({userid:e})}`))(e);i?t((0,n.a)(E.FAILED,{userId:e})):a&&a.data&&t((0,n.a)(E.SUCCESS,{data:a.data}))}}function ae(e,t,i,a){return async s=>{s((0,n.a)(y.REQUESTED));const{error:r}=await function(e,t,i,a){return V("/api/v2/reply_buyer_rating",{cmtid:e,orderid:t,shopid:i,comment:a})}(e,t,i,a);s(r?(0,n.a)(y.FAILED,{cmtId:e,orderId:t,shopId:i,comment:a,error:r}):(0,n.a)(y.SUCCESS,{cmtId:e,orderId:t,shopId:i,comment:a}))}}function ne(e,t){return(0,F.Q)(e)}function se(e,t){return i=>{i((0,n.a)(S.SUCCESS,{orderId:e,userId:t}))}}function re({userId:e,orderid:t=0,limit:i=10}){return async(a,n)=>await(0,U.ZP)({apiCall:()=>(({orderid:e=0,limit:t=10}={})=>j(`/api/v4/item/get_my_ratable_list${(0,O.Wc)({orderid:e,limit:t,apply_coin_limits_validate:!0})}`))({orderid:t,limit:i}),actions:[{type:M.REQUESTED,payload:()=>({query:{userId:e}})},{type:M.SUCCESS,payload:(i,a,n)=>({query:{userId:e,offset:t},data:n.data})},{type:M.FAILED,payload:(t,i,a)=>({query:{userId:e},error:a.error})}]},a,n)}function oe({userId:e,offset:t=0,limit:i=20}){return async(a,n)=>await(0,U.ZP)({apiCall:()=>(({offset:e=0,limit:t=20}={})=>j(`/api/v4/item/get_my_rating_list${(0,O.Wc)({offset:e,limit:t})}`))({offset:t,limit:i}),actions:[{type:b.REQUESTED,payload:()=>({query:{userId:e,offset:t,limit:i}})},{type:b.SUCCESS,payload:(a,n,s)=>({query:{userId:e,offset:t,limit:i},data:s.data})},{type:b.FAILED,payload:(a,n,s)=>({query:{userId:e,offset:t,limit:i},error:s.error})}]},a,n)}function le(e,t,i){return async a=>a((0,n.a)(I.SUCCESS,{data:{cmtid:e,updateData:t,userId:i}}))}function ce(e,t,i,a,s){return async r=>{r((0,n.a)(I.SUCCESS,{data:{cmtid:e,userId:s,updateData:{like_count:a+1,liked:!0}}}));const o=await H(e,t,i);return o.error&&r((0,n.a)(I.SUCCESS,{data:{cmtid:e,userId:s,updateData:{like_count:a,liked:!1}}})),o}}function de(e,t,i,a,s){return async r=>{const o=a>0?a-1:0;r((0,n.a)(I.SUCCESS,{data:{cmtid:e,userId:s,updateData:{like_count:o,liked:!1}}}));const l=await G(e,t,i);return l.error&&r((0,n.a)(I.SUCCESS,{data:{cmtid:e,userId:s,updateData:{like_count:a,liked:!0}}})),l}}var me=i(182);function he(e,t){const i=T(t);return e&&e.itemRating?e.itemRating[i]:null}function ue(e,t){if(!e)return null;const i=he(e,t),a=e.itemRatingMap;if(!e)return null;const{limit:n,offset:s}=t;return i&&i.ratings.slice(s,s+n).map((e=>a[e])).filter((e=>!!e))}function pe(e){return(0,me.Z)(e,["itemRatingSummary"],null)}function _e(e,t){if(!e)return null;const i=function(e,t){const i=x(t);return e&&e.buyerRating?e.buyerRating[i]:null}(e,t),a=e.buyerRatingMap;if(!e)return null;const{limit:n,offset:s}=t;return i&&i.ratings.slice(s,s+n).map((e=>a[e])).filter((e=>!!e))}function ge(e){return(0,me.Z)(e,["shopRatingSummary","buyer_rating_summary"],null)}},1875:(e,t,i)=>{var a={"./cl.png":8249,"./co.png":8546,"./pl.png":1599,"./sg.png":4635};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=1875},1400:(e,t,i)=>{var a={"./ar.png":3519,"./br.png":265,"./cl.png":8786,"./co.png":1216,"./es.png":9490,"./fr.png":2488,"./id.png":4334,"./in.png":8896,"./mx.png":6248,"./my.png":457,"./ph.png":3202,"./pl.png":2208,"./sg.png":9917,"./th.png":7361,"./tw.png":5991,"./vn.png":218};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=1400},5106:(e,t,i)=>{var a={"./ar.png":7951};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=5106},6062:(e,t,i)=>{var a={"./ar.png":3318,"./br.png":2976,"./cl.png":70,"./co.png":7526,"./es.png":3906,"./fr.png":6572,"./id.png":5669,"./in.png":9322,"./mx.png":9431,"./my.png":6330,"./ph.png":6755,"./pl.png":3213,"./sg.png":3289,"./th.png":6333,"./tw.png":4384,"./vn.png":7649};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=6062},9913:(e,t,i)=>{var a={"./ar.png":762,"./br.png":5317,"./cl.png":8979,"./co.png":8267,"./es.png":8456,"./fr.png":1308,"./id.png":5843,"./in.png":6612,"./mx.png":1443,"./my.png":4238,"./ph.png":8512,"./pl.png":7397,"./sg.png":9161,"./th.png":4041,"./tw.png":3579,"./vn.png":944};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=9913},8792:(e,t,i)=>{var a={"./popup_apponly@2x.png":6683,"./popup_mall_apponly@2x.png":7958};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=8792},2057:(e,t,i)=>{var a={"./popup_apponly_tw@2x.png":8588,"./popup_mall_apponly_tw@2x.png":6323};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=2057},4259:(e,t,i)=>{var a={"./popup_apponly@2x.png":1477,"./popup_mall_apponly@2x.png":1106};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=4259},807:(e,t,i)=>{var a={"./popup_apponly_tw@2x.png":8763,"./popup_mall_apponly_tw@2x.png":9044};function n(e){var t=s(e);return i(t)}function s(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=s,e.exports=n,n.id=807},5234:()=>{},4365:(e,t,i)=>{"use strict";e.exports=i.microfeI(3)},843:(e,t,i)=>{"use strict";e.exports=i.microfeI(1)},7705:(e,t,i)=>{"use strict";e.exports=i.microfeI(2)},9168:(e,t,i)=>{"use strict";e.exports=i.microfeI(0)},7944:(e,t,i)=>{"use strict";e.exports=i.microfeI(4)}}]);